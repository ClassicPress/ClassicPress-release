document.addEventListener("DOMContentLoaded",(function(){var e,t=document.getElementById("widget-list"),n=document.querySelectorAll(".widgets-sortables"),i=document.querySelectorAll(".widgets-holder-wrap"),r=document.querySelectorAll(".widget"),o=document.querySelector(".widgets-chooser");function d(e){var t;e.hasAttribute("open")?(g(),o.style.display="block",o.removeAttribute("inert"),e.parentNode.classList.add("widget-in-question"),e.append(o),document.getElementById("widgets-left").classList.add("chooser"),(t=e.querySelectorAll(".widgets-chooser-button")).forEach((function(n){n.addEventListener("click",(function(){e.querySelector(".widgets-chooser-selected").classList.remove("widgets-chooser-selected"),t.forEach((function(e){e.setAttribute("aria-pressed","false")})),n.setAttribute("aria-pressed","true"),n.closest("li").classList.add("widgets-chooser-selected")}))}))):(document.getElementById("wpbody-content").append(o),o.style.display="none",document.getElementById("widgets-left").classList.remove("chooser"),g(),e.querySelector("summary").focus())}function a(e,t){var n=document.createElement("details");n.id="sortable-ghost",n.className="widget-top",n.innerHTML='<summary class="widget-title"><h3>'+t.querySelector("h3").textContent+"</h3></summary>",n.style.position="absolute",n.style.top="-1000px",n.style.width=t.getBoundingClientRect().width+"px",document.body.appendChild(n),e.setDragImage(n,30,20)}function l(e){e.item.querySelector("details").hasAttribute("open")&&e.item.querySelector("details").removeAttribute("open")}function s(t){var n,i,r,o,d,a,l,s=t.item;function g(){s.classList.add("widget-dirty"),l.disabled=!1,l.value=wp.i18n.__("Save")}s.className.includes("deleting")?(c(s,1,0,1),s.remove()):(s.removeAttribute("style"),s.querySelector(".widget-inside").removeAttribute("inert"),(n=s.querySelector("input.add_new").value)&&("multi"===n?(s.innerHTML=s.innerHTML.replace(/<[^<>]+>/g,(function(t){return t.replace(/__i__|%i%/g,e)})),s.id=s.id.replace("__i__",e),s.querySelector("input.multi_number").value=e):"single"===n&&(s.id="new-"+s.id,"li#"+s.id),c(s,0,0,1),s.querySelector("input.add_new").value="",document.dispatchEvent(new CustomEvent("widget-added",{detail:{widget:s}})),(l=s.querySelector(".widget-control-save")).disabled=!0,l.value=wp.i18n.__("Saved"),s.className.includes("widget-dirty")||(s.addEventListener("input",g),s.addEventListener("change",g))),r=s.closest("details"),i=s.parentNode,r.hasAttribute("open")||(r.setAttribute("open","open"),(o=r.querySelectorAll(".widget")).length>1&&(d=o[0],a=s[0],d.id&&a.id&&d.id!==a.id&&d.before(s))),n?s.querySelector("details").setAttribute("open","open"):u(i.id)),t.from.id.indexOf("orphaned_widgets")>-1&&!t.from.querySelector(".widget").length&&(t.from.closest("details").removeAttribute("open"),t.from.remove())}function c(e,t,n,i){var r,o,d,a=e.closest("ul.widgets-sortables").id,l=e.querySelector("form");e.querySelector("input.add_new").value&&!l.checkValidity||(r=new URLSearchParams(new FormData(l)),e.querySelector(".spinner").classList.add("is-active"),r.append("action","save-widget"),r.append("savewidgets",document.getElementById("_wpnonce_widgets").value),r.append("sidebar",a),t&&r.append("delete_widget",1),(o=new XMLHttpRequest).open("POST",ajaxurl,!0),o.setRequestHeader("Accept","text/html"),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE&&200===o.status){if(d=e.querySelector("input.widget-id").value,t)e.querySelector("input.widget_number").value||document.getElementById("#available-widgets").querySelectorAll("input.widget-id").forEach((function(e){e.value===d&&(e.closest("li.widget").style.display="block")})),n?(i=0,e.removeAttribute("open"),e.remove(),u(a)):e.remove();else{if(o.response&&o.response.length>2){e.querySelector(".widget-content").innerHTML=o.response;var r=e.querySelector('input[id*="-title"]').value||"";r&&(r=": "+r.replace(/<[^<>]+>/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;")),e.querySelector(".in-widget-title").innerHTML=r,e.querySelector(".widget-control-save").disabled=!0,e.querySelector(".widget-control-save").value=wp.i18n.__("Saved"),e.classList.remove("widget-dirty"),document.dispatchEvent(new CustomEvent("widget-updated",{detail:{widget:e}}))}document.querySelectorAll(".spinner").forEach((function(e){e.classList.remove("is-active")}))}i&&u(a)}},o.send(r))}function u(e){var t=new URLSearchParams({action:"widgets-order",savewidgets:document.getElementById("_wpnonce_widgets").value,sidebars:[]});e&&document.querySelectorAll(".spinner").forEach((function(e){e.classList.remove("is-active")})),n.forEach((function(e){var n=[];e.querySelectorAll(".widget").forEach((function(e){n.push(e.id)})),t.append("sidebars["+e.id+"]",n.join(","))})),fetch(ajaxurl,{method:"POST",body:t,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(){document.querySelectorAll(".spinner").forEach((function(e){e.classList.remove("is-active")}))}))["catch"]((function(e){console.log(e)}))}function g(){document.getElementById("widgets-left").classList.remove("chooser"),null!=document.querySelector(".widget-in-question")&&document.querySelectorAll(".widget-in-question").forEach((function(e){e.classList.remove("widget-in-question")}))}document.querySelector("#widgets-right details").setAttribute("open","open"),document.querySelector(".inactive-sidebar .sidebar-name").parentElement.setAttribute("open","open"),document.querySelector(".inactive-sidebar .sidebar-name").addEventListener("click",(function(e){e.target.parentElement.nextElementSibling.classList.toggle("hidden"),e.target.closest(".widget-holder").nextElementSibling.classList.toggle("hidden")})),document.querySelector("#widgets-left .sidebar-name").addEventListener("click",(function(){document.dispatchEvent(new CustomEvent("wp-pin-menu"))})),document.querySelectorAll("#widgets-right summary").forEach((function(e){e.addEventListener("click",(function(){document.dispatchEvent(new CustomEvent("wp-pin-menu"))}))})),window.addEventListener("beforeunload",(function(e){var t,n=document.querySelectorAll(".widget-dirty");n.length>0&&(e.preventDefault(),n.forEach((function(e,n){var i=e.querySelector("details");i.hasAttribute("open")||i.setAttribute("open","open"),0===n&&(null==(t=e.querySelector("input")?e.querySelector("input"):e.querySelector("textarea"))&&(t=e.querySelector("summary")),t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView(),setTimeout((function(){t.focus()}),0))})))})),document.querySelectorAll("#widgets-right .widgets-holder-wrap").forEach((function(e,t){var n=document.createElement("button"),i=e.querySelector(".sidebar-name").dataset.addTo,r=e.querySelector("summary.sidebar-name").textContent||"",d=document.createElement("li"),a=o.querySelector(".widgets-chooser-sidebars"),l=e.querySelector(".widgets-sortables").id;n.type="button",n.className="widgets-chooser-button",n.setAttribute("aria-pressed",!1),n.setAttribute("aria-label",i),n.innerText=r.toString().trim(),d.append(n),0===t&&(d.classList.add("widgets-chooser-selected"),n.setAttribute("aria-pressed","true")),a.append(d),d.dataset.sidebarId=l})),document.addEventListener("click",(function(t){var n,i,r=document.getElementById("inactive-widgets-control-remove");t.target===r?(document.querySelector(".remove-inactive-widgets").querySelector(".spinner").classList.add("is-active"),n=new URLSearchParams({action:"delete-inactive-widgets",removeinactivewidgets:document.getElementById("_wpnonce_remove_inactive_widgets").value}),(i=new XMLHttpRequest).open("POST",ajaxurl,!0),i.setRequestHeader("Accept","text/html"),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&200===i.status&&(document.getElementById("wp_inactive_widgets").querySelectorAll("li.widget").forEach((function(e){e.remove()})),document.querySelectorAll(".spinner").forEach((function(e){e.classList.remove("is-active")})))},i.send(n),r.disabled=!0):null==t.target.closest("ul")?r.disabled=!0:"widget-list"===t.target.closest("ul").id?t.target.className.includes("widgets-chooser-add")?(!function(t){var n,i,r,o=t.querySelector(".widgets-chooser-selected").dataset.sidebarId,d=document.getElementById(o),a=d.getBoundingClientRect(),l=130,s=!1;n=document.getElementById("available-widgets").querySelector(".widget-in-question").cloneNode(!0),i=n.id,r=n.querySelector("input.add_new").value,n.querySelector(".widgets-chooser").remove(),"multi"===r?(n.innerHTML=n.innerHTML.replace(/<[^<>]+>/g,(function(t){return t.replace(/__i__|%i%/g,e)})),n.id=i.replace("__i__",e),document.getElementById(i).querySelector("input.multi_number").value=e):"single"===r&&(n.id="new-"+i,document.getElementById(i).style.display="none");d.parentNode.setAttribute("open","open"),d.append(n),c(n,0,0,1),n.querySelector("input.add_new").value="",document.dispatchEvent(new CustomEvent("widget-added",{detail:{widget:n}})),a.top<l&&(s=!0);a.top>window.innerHeight&&(s=!0);s&&window.scrollTo({top:window.scrollY+a.top-l,behavior:"smooth"})}(o),t.target.closest(".widget-top").removeAttribute("open")):t.target.className.includes("widgets-chooser-cancel")&&t.target.closest(".widget-top").removeAttribute("open"):t.target.className.includes("widget-control-save")?(c(t.target.closest("li.widget"),0,1,0),t.preventDefault()):t.target.className.includes("widget-control-remove")?("wp_inactive_widgets"===t.target.closest("ul").id&&([...document.querySelectorAll("#wp_inactive_widgets .widget")].at(1)===undefined?r.disabled=!0:r.disabled=!1),c(t.target.closest("li.widget"),1,1,0)):t.target.className.includes("widget-control-close")&&(t.target.closest("details").removeAttribute("open"),t.target.closest("details").querySelector("summary").focus())})),r.forEach((function(e){var t;function n(){e.classList.add("widget-dirty"),t.disabled=!1,t.value=wp.i18n.__("Save")}"widget-list"!==e.closest("ul").id&&((t=e.querySelector(".widget-control-save")).disabled=!0,t.value=wp.i18n.__("Saved"),e.className.includes("widget-dirty")||(e.addEventListener("input",n),e.addEventListener("change",n))),e.addEventListener("keyup",(function(e){e.target.closest(".widget-top").hasAttribute("open")&&"Escape"===e.key&&(e.target.closest(".widget-top").removeAttribute("open"),document.querySelector(".chooser").classList.remove("chooser"))}))})),document.querySelector("body").className.includes("widgets-php")&&document.addEventListener("click",(function(e){var n=e.target.closest("details");t.contains(e.target)&&n.className.includes("widget-top")&&n.addEventListener("toggle",(function(){d(n)}))})),Sortable.create(t,{group:{name:"widget-list",pull:"clone",put:!1},sort:!1,setData:a,forceFallback:!!navigator.vendor.match(/apple/i),onChoose:function(t){var n;t.item.className.includes("widget")&&((n=t.item.querySelector("input.multi_number")).value=e=parseInt(n.value,10)+1)},onClone:function(e){var t=e.clone.querySelector("details");t.hasAttribute("open")&&t.removeAttribute("open"),d(t)}}),n.forEach((function(e){e.addEventListener("dragover",(function(t){t.preventDefault(),e.setAttribute("data-dragover",!0)})),e.addEventListener("dragleave",(function(){e.removeAttribute("data-dragover")})),e.querySelectorAll(".widget").forEach((function(e){var t=e.querySelector('input[id*="-title"]').value||"";t&&(t=": "+t.replace(/<[^<>]+>/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;")),e.querySelector(".in-widget-title").innerHTML=t,null!=e.querySelector("p.widget-error")&&e.querySelector("details").setAttribute("open","open")})),Sortable.create(document.getElementById(e.id),{group:{name:"active-widgets",put:["widget-list","active-widgets","inactive"]},handle:".widget",filter:"input, select, textarea, label, button, fieldset, legend, datalist, output, option, optgroup",preventOnFilter:!1,setData:a,forceFallback:!!navigator.vendor.match(/apple/i),onStart:l,onChange:s})})),Sortable.create(document.getElementById("wp_inactive_widgets"),{group:{name:"inactive",put:["widget-list","active-widgets"]},handle:".widget",filter:"input, select, textarea, label, button, fieldset, legend, datalist, output, option, optgroup",preventOnFilter:!1,setData:a,forceFallback:!!navigator.vendor.match(/apple/i),onStart:l,onChange:s,onAdd:function(){document.getElementById("inactive-widgets-control-remove").disabled=!1}}),i.forEach((function(e){var t=e.querySelector("details"),n="open";e.addEventListener("dragover",(function(e){e.preventDefault(),t.hasAttribute("open")||(n="closed",t.setAttribute("open","open"))})),e.addEventListener("dragleave",(function(){setTimeout((function(){t.hasAttribute("open")&&"closed"===n&&!e.querySelector(".widgets-sortables").hasAttribute("data-dragover")&&t.removeAttribute("open")}),1e3)}))})),document.addEventListener("dragover",(function(e){function t(e){var t=document.scrollingElement.scrollTop;window.scrollTo({top:t+e})}e.clientY<50?t(-15):e.clientY>window.innerHeight-50&&t(15)}))}));