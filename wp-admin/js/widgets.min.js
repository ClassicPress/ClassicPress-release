!function(e){var t=e(document);window.wpWidgets={hoveredSidebar:null,dirtyWidgets:{},init:function(){var i,d,n=this,s=e(".widgets-chooser"),r=s.find(".widgets-chooser-sidebars"),a=e("ul.widgets-sortables"),o=e(".widgets-holder-wrap"),l=!("undefined"==typeof isRtl||!isRtl);document.querySelector("#widgets-right details").setAttribute("open","open"),document.querySelector(".inactive-sidebar .sidebar-name").parentElement.setAttribute("open","open"),document.querySelector(".inactive-sidebar .sidebar-name").addEventListener("click",(function(e){e.target.parentElement.nextElementSibling.classList.toggle("hidden"),e.target.closest(".widget-holder").nextElementSibling.classList.toggle("hidden")})),e("#widgets-left .sidebar-name").on("click",(function(){t.triggerHandler("wp-pin-menu")})),e("#widgets-right summary").on("click",(function(){t.triggerHandler("wp-pin-menu")})),e(window).on("beforeunload.widgets",(function(t){var i,d=[];if(e.each(n.dirtyWidgets,(function(e,t){t&&d.push(e)})),0!==d.length)return(i=e("#widgets-right").find(".widget").filter((function(){return-1!==d.indexOf(e(this).prop("id").replace(/^widget-\d+_/,""))}))).each((function(){e(this)[0].hasAttribute("open")||e(this).children("details").attr("open","open")})),i.first().each((function(){this.scrollIntoViewIfNeeded?this.scrollIntoViewIfNeeded():this.scrollIntoView(),e(this).find(".widget-inside :tabbable:first").trigger("focus")})),t.returnValue=wp.i18n.__("The changes you made will be lost if you navigate away from this page."),t.returnValue})),e(document.body).on("click.widgets-toggle",(function(t){var i,d,s,r,a,o,c=e(t.target),g={};!c.parents(".widget-top").length||c.parents(".widget-inside").length||c.parents("#available-widgets").length?c.hasClass("widget-control-save")?(wpWidgets.save(c.closest("li.widget"),0,1,0),t.preventDefault()):c.hasClass("widget-control-remove")?wpWidgets.save(c.closest("li.widget"),1,1,0):c.hasClass("widget-control-close")?(i=c.closest("li.widget")).children("details").removeAttr("open").children("summary").focus():"inactive-widgets-control-remove"===c.attr("id")&&(wpWidgets.removeInactiveWidgets(),t.preventDefault()):(d=(i=c.closest("li.widget")).find(".widget-inside"),s=parseInt(i.find("input.widget-width").val(),10),r=i.parent().width(),o=d.find(".widget-id").val(),i.data("dirty-state-initialized")||((a=d.find(".widget-control-save")).prop("disabled",!0).val(wp.i18n.__("Saved")),d.on("input change",(function(){n.dirtyWidgets[o]=!0,i.addClass("widget-dirty"),a.prop("disabled",!1).val(wp.i18n.__("Save"))})),i.data("dirty-state-initialized",!0)),i.children("details")[0].hasAttribute("open")||s>250&&s+30>r&&i.closest("ul.widgets-sortables").length&&(g[i.closest("div.widget-liquid-right").length?l?"margin-right":"margin-left":l?"margin-left":"margin-right"]=r-(s+30)+"px",i.css(g)))})),a.children(".widget").each((function(){var t=e(this);wpWidgets.appendTitle(this),t.find("p.widget-error").length&&t.find(".widget-action").trigger("click").attr("aria-expanded","true")})),e("#widget-list").find(".widget").draggable({connectToSortable:"ul.widgets-sortables",handle:"> .widget-top > .widget-title",distance:2,helper:"clone",zIndex:101,containment:"#wpwrap",refreshPositions:!0,start:function(t,i){var s=e(this).find(".widgets-chooser");i.helper.find("div.widget-description").hide(),d=this.id,s.length&&(e("#wpbody-content").append(s.hide()),i.helper.find(".widgets-chooser").remove(),n.clearWidgetSelection())},stop:function(){i&&e(i).hide(),i=""}}),a.droppable({tolerance:"intersect",over:function(){e(this).sortable("refresh")}}),o.droppable({tolerance:"intersect",greedy:!0,over:function(t){var i=e(t.target).children("details");wpWidgets.hoveredSidebar&&!i.children("ul").is(wpWidgets.hoveredSidebar)&&i.removeAttr("open"),i.attr("open")||(wpWidgets.hoveredSidebar=i.children("ul"),i.attr("open","open"))},out:function(e){setTimeout((function(){e.target.querySelector("ul").classList.contains("ui-droppable-hover")||e.target.querySelector("details").removeAttribute("open")}),0)}}),a.sortable({placeholder:"widget-placeholder",items:"> .widget",handle:"> .widget-top > .widget-title",cursor:"move",distance:2,containment:"#wpwrap",tolerance:"pointer",refreshPositions:!0,start:function(t,i){var d,n=e(this),s=n.closest(".widgets-holder-wrap"),r=i.item.children("details");r[0].hasAttribute("open")&&(r.removeAttr("open"),e(this).sortable("refreshPositions")),s.find("details")[0].hasAttribute("open")&&(d=i.item.hasClass("ui-draggable")?n.height():1+n.height(),n.css("min-height",d+"px"))},stop:function(n,s){var r,a,o,l,c,g,p=s.item,w=d;if(wpWidgets.hoveredSidebar=null,p.hasClass("deleting"))return wpWidgets.save(p,1,0,1),void p.remove();r=p.find("input.add_new").val(),a=p.find("input.multi_number").val(),p.attr("style","").removeClass("ui-draggable").find(".widget-inside").removeAttr("inert"),d="",r&&("multi"===r?(p.html(p.html().replace(/<[^<>]+>/g,(function(e){return e.replace(/__i__|%i%/g,a)}))),p.attr("id",w.replace("__i__",a)),a++,e("li#"+w).find("input.multi_number").val(a)):"single"===r&&(p.attr("id","new-"+w),i="li#"+w),wpWidgets.save(p,0,0,1),p.find("input.add_new").val(""),t.trigger("widget-added",[p])),(o=p.parent()).parent()[0].hasAttribute("open")||(o.parent().attr("open","open"),(l=o.children(".widget")).length>1&&(c=l.get(0),g=p.get(0),c.id&&g.id&&c.id!==g.id&&e(c).before(p))),r?p.children("details").attr("open","open"):wpWidgets.saveOrder(o.attr("id"))},activate:function(){e(this).parent().addClass("widget-hover")},deactivate:function(){e(this).css("min-height","").parent().removeClass("widget-hover")},receive:function(t,i){var d=e(i.sender);this.id.indexOf("orphaned_widgets")>-1?d.sortable("cancel"):d.attr("id").indexOf("orphaned_widgets")>-1&&!d.children(".widget").length&&d.parents(".orphan-sidebar").slideUp(400,(function(){e(this).remove()}))}}).sortable("option","connectWith","ul.widgets-sortables"),e("#available-widgets").droppable({tolerance:"pointer",accept:function(t){return"widget-list"!==e(t).parent().attr("id")},drop:function(t,i){i.draggable.addClass("deleting"),e("#removing-widget").hide().children("span").empty()},over:function(t,i){i.draggable.addClass("deleting"),e("div.widget-placeholder").hide(),i.draggable.hasClass("ui-sortable-helper")&&e("#removing-widget").show().children("span").html(i.draggable.find("summary.widget-title").html())},out:function(t,i){i.draggable.removeClass("deleting"),e("div.widget-placeholder").show(),e("#removing-widget").hide().children("span").empty()}}),e("#widgets-right .widgets-holder-wrap").each((function(t,i){var d=e(i),n=d.find("summary.sidebar-name").text()||"",s=d.find(".sidebar-name").data("add-to"),a=d.find(".widgets-sortables").attr("id"),o=e("<li>"),l=e("<button>",{type:"button","aria-pressed":"false","class":"widgets-chooser-button","aria-label":s}).text(n.toString().trim());o.append(l),0===t&&(o.addClass("widgets-chooser-selected"),l.attr("aria-pressed","true")),r.append(o),o.data("sidebarId",a)}));var c=document.querySelectorAll("#available-widgets .widget .widget-top"),g=r.find(".widgets-chooser-button");document.querySelector("body").classList.contains("widgets-php")&&c.forEach((function(t){t.addEventListener("click",(function(t){t.target.closest("details").hasAttribute("open")?document.querySelector(".chooser").classList.remove("chooser"):(n.clearWidgetSelection(),document.getElementById("widgets-left").classList.add("chooser"),g.on("click.widgets-chooser",(function(){r.find(".widgets-chooser-selected").removeClass("widgets-chooser-selected"),g.attr("aria-pressed","false"),e(this).attr("aria-pressed","true").closest("li").addClass("widgets-chooser-selected")})),s[0].style.display="block",t.target.closest("li").classList.add("widget-in-question"),t.target.closest(".widget-top").append(s[0]),t.target.focus())}))})),document.querySelectorAll(".widgets-chooser-actions").forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.contains("button-primary")&&n.addWidget(s),e.target.closest(".widget-top").removeAttribute("open"),setTimeout((function(){document.querySelector(".chooser").classList.remove("chooser")}),0)}))})),document.querySelectorAll(".widget.open").forEach((function(e){e.addEventListener("keyup",(function(e){"Escape"===e.key&&(e.target.closest(".widget-top").removeAttribute("open"),document.querySelector(".chooser").classList.remove("chooser"))}))}))},saveOrder:function(t){var i={action:"widgets-order",savewidgets:e("#_wpnonce_widgets").val(),sidebars:[]};t&&e("#"+t).find(".spinner:first").addClass("is-active"),e("ul.widgets-sortables").each((function(){e(this).sortable&&(i["sidebars["+e(this).attr("id")+"]"]=e(this).sortable("toArray").join(","))})),e.post(ajaxurl,i,(function(){e("#inactive-widgets-control-remove").prop("disabled",!e("#wp_inactive_widgets .widget").length),e(".spinner").removeClass("is-active")}))},save:function(i,d,n,s){var r,a,o=this,l=i.closest("ul.widgets-sortables").attr("id"),c=i.find("form"),g=i.find("input.add_new").val();(d||g||!c.prop("checkValidity")||c[0].checkValidity())&&(r=c.serialize(),i=e(i),e(".spinner",i).addClass("is-active"),a={action:"save-widget",savewidgets:e("#_wpnonce_widgets").val(),sidebar:l},d&&(a.delete_widget=1),r+="&"+e.param(a),e.post(ajaxurl,r,(function(r){var a=e("input.widget-id",i).val();d?(e("input.widget_number",i).val()||e("#available-widgets").find("input.widget-id").each((function(){e(this).val()===a&&e(this).closest("li.widget").show()})),n?(s=0,i.slideUp("fast",(function(){e(this).remove(),wpWidgets.saveOrder(),delete o.dirtyWidgets[a]}))):(i.remove(),delete o.dirtyWidgets[a],"wp_inactive_widgets"===l&&e("#inactive-widgets-control-remove").prop("disabled",!e("#wp_inactive_widgets .widget").length))):(e(".spinner").removeClass("is-active"),r&&r.length>2&&(e("div.widget-content",i).html(r),wpWidgets.appendTitle(i),i.find(".widget-control-save").prop("disabled",!0).val(wp.i18n.__("Saved")),i.removeClass("widget-dirty"),delete o.dirtyWidgets[a],t.trigger("widget-updated",[i]),"wp_inactive_widgets"===l&&e("#inactive-widgets-control-remove").prop("disabled",!e("#wp_inactive_widgets .widget").length))),s&&wpWidgets.saveOrder()})))},removeInactiveWidgets:function(){var t,i,d=e(".remove-inactive-widgets"),n=this;e(".spinner",d).addClass("is-active"),t={action:"delete-inactive-widgets",removeinactivewidgets:e("#_wpnonce_remove_inactive_widgets").val()},i=e.param(t),e.post(ajaxurl,i,(function(){e("#wp_inactive_widgets .widget").each((function(){var t=e(this);delete n.dirtyWidgets[t.find("input.widget-id").val()],t.remove()})),e("#inactive-widgets-control-remove").prop("disabled",!0),e(".spinner",d).removeClass("is-active")}))},appendTitle:function(t){var i=e('input[id*="-title"]',t).val()||"";i&&(i=": "+i.replace(/<[^<>]+>/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;")),e(t).children(".widget-top").children(".widget-title").children().children(".in-widget-title").html(i)},addWidget:function(i){var d,n,s,r,a,o,l,c=i.find(".widgets-chooser-selected").data("sidebarId"),g=e("#"+c);n=(d=e("#available-widgets").find(".widget-in-question").clone()).attr("id"),s=d.find("input.add_new").val(),r=d.find("input.multi_number").val(),d.find(".widgets-chooser").remove(),"multi"===s?(d.html(d.html().replace(/<[^<>]+>/g,(function(e){return e.replace(/__i__|%i%/g,r)}))),d.attr("id",n.replace("__i__",r)),r++,e("#"+n).find("input.multi_number").val(r)):"single"===s&&(d.attr("id","new-"+n),e("#"+n).hide()),g.append(d),g.sortable("refresh"),wpWidgets.save(d,0,0,1),d.find("input.add_new").val(""),d.find(".widgets-chooser").removeAttr("inert"),t.trigger("widget-added",[d]),o=(a=e(window).scrollTop())+e(window).height(),(l=g.offset()).bottom=l.top+g.outerHeight(),(a>l.bottom||o<l.top)&&e("html, body").animate({scrollTop:l.top-130},200),window.setTimeout((function(){window.wp.a11y.speak(wp.i18n.__("Widget has been added to the selected sidebar"),"assertive")}),250)},clearWidgetSelection:function(){e("#widgets-left").removeClass("chooser"),e(".widget-in-question").removeClass("widget-in-question")}},e((function(){wpWidgets.init()}))}(jQuery),wpWidgets.l10n=wpWidgets.l10n||{save:"",saved:"",saveAlert:"",widgetAdded:""},wpWidgets.l10n=window.wp.deprecateL10nObject("wpWidgets.l10n",wpWidgets.l10n,"5.5.0");