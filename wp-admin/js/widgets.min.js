document.addEventListener("DOMContentLoaded",(function(){var e,t,n=document.getElementById("widget-list"),i=document.querySelectorAll(".widgets-sortables"),r=document.querySelectorAll(".widgets-holder-wrap"),o=document.querySelectorAll(".widget"),d=document.querySelector(".widgets-chooser");function l(e){var t;e.hasAttribute("open")?(m(),d.style.display="block",d.removeAttribute("inert"),e.parentNode.classList.add("widget-in-question"),e.append(d),document.getElementById("widgets-left").classList.add("chooser"),(t=e.querySelectorAll(".widgets-chooser-button")).forEach((function(n){n.addEventListener("click",(function(){e.querySelector(".widgets-chooser-selected").classList.remove("widgets-chooser-selected"),t.forEach((function(e){e.setAttribute("aria-pressed","false")})),n.setAttribute("aria-pressed","true"),n.closest("li").classList.add("widgets-chooser-selected")}))}))):(document.getElementById("wpbody-content").append(d),d.style.display="none",document.getElementById("widgets-left").classList.remove("chooser"),m(),e.querySelector("summary").focus())}function a(e,t){var n=document.createElement("details");n.id="sortable-ghost",n.className="widget-top",n.innerHTML='<summary class="widget-title"><h3>'+t.querySelector("h3").textContent+"</h3></summary>",n.style.position="absolute",n.style.top="-1000px",n.style.width=t.getBoundingClientRect().width+"px",document.body.appendChild(n),e.setDragImage(n,30,20)}function s(e){e.item.querySelector("details").hasAttribute("open")&&e.item.querySelector("details").removeAttribute("open")}function c(t){var n,i,r,o,d,l,a,s=t.item;function c(){s.classList.add("widget-dirty"),a.disabled=!1,a.value=wp.i18n.__("Save")}s.className.includes("deleting")?(u(s,1,0,1),s.remove()):(s.removeAttribute("style"),s.querySelector(".widget-inside").removeAttribute("inert"),(n=s.querySelector("input.add_new").value)&&("multi"===n?(s.innerHTML=s.innerHTML.replace(/<[^<>]+>/g,(function(t){return t.replace(/__i__|%i%/g,e)})),s.id=s.id.replace("__i__",e),s.querySelector("input.multi_number").value=e):"single"===n&&(s.id="new-"+s.id,"li#"+s.id),u(s,0,0,1),s.querySelector("input.add_new").value="",document.dispatchEvent(new CustomEvent("widget-added",{detail:{widget:s}})),(a=s.querySelector(".widget-control-save")).disabled=!0,a.value=wp.i18n.__("Saved"),s.className.includes("widget-dirty")||(s.addEventListener("input",c),s.addEventListener("change",c))),r=s.closest("details"),i=s.parentNode,r.hasAttribute("open")||(r.setAttribute("open","open"),(o=r.querySelectorAll(".widget")).length>1&&(d=o[0],l=s[0],d.id&&l.id&&d.id!==l.id&&d.before(s))),n?s.querySelector("details").setAttribute("open","open"):g(i.id)),t.from.id.indexOf("orphaned_widgets")>-1&&!t.from.querySelector(".widget").length&&(t.from.closest("details").removeAttribute("open"),t.from.remove())}function u(e,n,i,r){var o,d=e.closest("ul.widgets-sortables").id,l=e.querySelector("form"),a=e.querySelector("input.add_new").value;if(Number.isInteger(t)&&t+50>Date.now())return!1;t=Date.now(),a&&!l.checkValidity||(o=new URLSearchParams(new FormData(l)),e.querySelector(".spinner").classList.add("is-active"),o.append("action","save-widget"),o.append("savewidgets",document.getElementById("_wpnonce_widgets").value),o.append("sidebar",d),n&&o.append("delete_widget",1),fetch(ajaxurl,{method:"POST",headers:{Accept:"text/html","Content-Type":"application/x-www-form-urlencoded"},body:o}).then((function(e){if(e.ok)return e.text();throw new Error(e.status)})).then((function(t){var o=e.querySelector("input.widget-id").value;if(n)e.querySelector("input.widget_number").value||document.getElementById("#available-widgets").querySelectorAll("input.widget-id").forEach((function(e){e.value===o&&(e.closest("li.widget").style.display="block")})),i?(r=0,e.removeAttribute("open"),e.remove(),g(d)):e.remove();else{if(t&&t.length>2){e.querySelector(".widget-content").innerHTML=t;let n=e.querySelector('input[id*="-title"]').value||"";n&&(n=": "+n.replace(/<[^<>]+>/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;")),e.querySelector(".in-widget-title").innerHTML=n,e.querySelector(".widget-control-save").disabled=!0,e.querySelector(".widget-control-save").value=wp.i18n.__("Saved"),e.classList.remove("widget-dirty"),document.dispatchEvent(new CustomEvent("widget-updated",{detail:{widget:e}}))}document.querySelectorAll(".spinner").forEach((function(e){e.classList.remove("is-active")}))}r&&g(d)}))["catch"]((function(e){console.error("Error:",e)})))}function g(e){var t=new URLSearchParams({action:"widgets-order",savewidgets:document.getElementById("_wpnonce_widgets").value,sidebars:[]});e&&document.querySelectorAll(".spinner").forEach((function(e){e.classList.remove("is-active")})),i.forEach((function(e){var n=[];e.querySelectorAll(".widget").forEach((function(e){n.push(e.id)})),t.append("sidebars["+e.id+"]",n.join(","))})),fetch(ajaxurl,{method:"POST",body:t,credentials:"same-origin"}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(){document.querySelectorAll(".spinner").forEach((function(e){e.classList.remove("is-active")}))}))["catch"]((function(e){console.log(e)}))}function m(){document.getElementById("widgets-left").classList.remove("chooser"),null!=document.querySelector(".widget-in-question")&&document.querySelectorAll(".widget-in-question").forEach((function(e){e.classList.remove("widget-in-question")}))}document.querySelector("#widgets-right details").setAttribute("open","open"),document.querySelector(".inactive-sidebar .sidebar-name").parentElement.setAttribute("open","open"),document.querySelector(".inactive-sidebar .sidebar-name").addEventListener("click",(function(e){e.target.parentElement.nextElementSibling.classList.toggle("hidden"),e.target.closest(".widget-holder").nextElementSibling.classList.toggle("hidden")})),document.querySelector("#widgets-left .sidebar-name").addEventListener("click",(function(){document.dispatchEvent(new CustomEvent("wp-pin-menu"))})),document.querySelectorAll("#widgets-right summary").forEach((function(e){e.addEventListener("click",(function(){document.dispatchEvent(new CustomEvent("wp-pin-menu"))}))})),window.addEventListener("beforeunload",(function(e){var t,n=document.querySelectorAll(".widget-dirty");n.length>0&&(e.preventDefault(),n.forEach((function(e,n){var i=e.querySelector("details");i.hasAttribute("open")||i.setAttribute("open","open"),0===n&&(null==(t=e.querySelector("input")?e.querySelector("input"):e.querySelector("textarea"))&&(t=e.querySelector("summary")),t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView(),setTimeout((function(){t.focus()}),0))})))})),document.querySelectorAll("#widgets-right .widgets-holder-wrap").forEach((function(e,t){var n=document.createElement("button"),i=e.querySelector(".sidebar-name").dataset.addTo,r=e.querySelector("summary.sidebar-name").textContent||"",o=document.createElement("li"),l=d.querySelector(".widgets-chooser-sidebars"),a=e.querySelector(".widgets-sortables").id;n.type="button",n.className="widgets-chooser-button",n.setAttribute("aria-pressed",!1),n.setAttribute("aria-label",i),n.innerText=r.toString().trim(),o.append(n),0===t&&(o.classList.add("widgets-chooser-selected"),n.setAttribute("aria-pressed","true")),l.append(o),o.dataset.sidebarId=a})),document.addEventListener("click",(function(t){var n,i=document.getElementById("inactive-widgets-control-remove");t.target===i?(n=new URLSearchParams({action:"delete-inactive-widgets",removeinactivewidgets:document.getElementById("_wpnonce_remove_inactive_widgets").value}),document.querySelector(".remove-inactive-widgets").querySelector(".spinner").classList.add("is-active"),fetch(ajaxurl,{method:"POST",headers:{Accept:"text/html","Content-Type":"application/x-www-form-urlencoded"},body:n}).then((function(e){if(e.ok)return e.text();throw new Error(e.status)})).then((function(){document.getElementById("wp_inactive_widgets").querySelectorAll("li.widget").forEach((function(e){e.remove()})),document.querySelectorAll(".spinner").forEach((function(e){e.classList.remove("is-active")}))}))["catch"]((function(e){console.error("Error:",e)})),i.disabled=!0):null==t.target.closest("ul")?i.disabled=!0:"INPUT"!==t.target.tagName&&"BUTTON"!==t.target.tagName||("widget-list"===t.target.closest("ul").id?t.target.className.includes("widgets-chooser-add")?(!function(t){var n,i,r,o=t.querySelector(".widgets-chooser-selected").dataset.sidebarId,d=document.getElementById(o),l=d.getBoundingClientRect(),a=130,s=!1;n=document.getElementById("available-widgets").querySelector(".widget-in-question").cloneNode(!0),i=n.id,r=n.querySelector("input.add_new").value,n.querySelector(".widgets-chooser").remove(),"multi"===r?(n.innerHTML=n.innerHTML.replace(/<[^<>]+>/g,(function(t){return t.replace(/__i__|%i%/g,e)})),n.id=i.replace("__i__",e),document.getElementById(i).querySelector("input.multi_number").value=e):"single"===r&&(n.id="new-"+i,document.getElementById(i).style.display="none");d.parentNode.setAttribute("open","open"),d.append(n),u(n,0,0,1),n.querySelector("input.add_new").value="",document.dispatchEvent(new CustomEvent("widget-added",{detail:{widget:n}})),l.top<a&&(s=!0);l.top>window.innerHeight&&(s=!0);s&&window.scrollTo({top:window.scrollY+l.top-a,behavior:"smooth"})}(d),t.target.closest(".widget-top").removeAttribute("open")):t.target.className.includes("widgets-chooser-cancel")&&t.target.closest(".widget-top").removeAttribute("open"):t.target.className.includes("widget-control-save")?(u(t.target.closest("li.widget"),0,1,0),t.preventDefault()):t.target.className.includes("widget-control-remove")?("wp_inactive_widgets"===t.target.closest("ul").id&&([...document.querySelectorAll("#wp_inactive_widgets .widget")].at(1)===undefined?i.disabled=!0:i.disabled=!1),u(t.target.closest("li.widget"),1,1,0)):t.target.className.includes("widget-control-close")&&(t.target.closest("details").removeAttribute("open"),t.target.closest("details").querySelector("summary").focus()))})),o.forEach((function(e){var t;function n(){e.classList.add("widget-dirty"),t.disabled=!1,t.value=wp.i18n.__("Save")}"widget-list"!==e.closest("ul").id&&((t=e.querySelector(".widget-control-save")).disabled=!0,t.value=wp.i18n.__("Saved"),e.className.includes("widget-dirty")||(e.addEventListener("input",n),e.addEventListener("change",n))),e.addEventListener("keyup",(function(e){e.target.closest(".widget-top").hasAttribute("open")&&"Escape"===e.key&&(e.target.closest(".widget-top").removeAttribute("open"),null!=document.querySelector(".chooser")&&document.querySelector(".chooser").classList.remove("chooser"))}))})),document.querySelector("body").className.includes("widgets-php")&&document.addEventListener("click",(function(e){var t=e.target.closest("details");n.contains(e.target)&&t.className.includes("widget-top")&&t.addEventListener("toggle",(function(){l(t)}))})),Sortable.create(n,{group:{name:"widget-list",pull:"clone",put:!1},sort:!1,setData:a,onChoose:function(t){var n;t.item.className.includes("widget")&&((n=t.item.querySelector("input.multi_number")).value=e=parseInt(n.value,10)+1)},onClone:function(e){var t=e.clone.querySelector("details");t.hasAttribute("open")&&t.removeAttribute("open"),l(t)}}),i.forEach((function(e){e.addEventListener("dragover",(function(t){t.preventDefault(),e.setAttribute("data-dragover",!0)})),e.addEventListener("dragleave",(function(){e.removeAttribute("data-dragover")})),e.querySelectorAll(".widget").forEach((function(e){var t,n=e.querySelector('input[id*="-title"]');n&&(t=n.value||""),t&&(t=": "+t.replace(/<[^<>]+>/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.querySelector(".in-widget-title").innerHTML=t),null!=e.querySelector("p.widget-error")&&e.querySelector("details").setAttribute("open","open")})),Sortable.create(document.getElementById(e.id),{group:{name:"active-widgets",put:["widget-list","active-widgets","inactive"]},handle:".widget",filter:"input, select, textarea, label, button, fieldset, legend, datalist, output, option, optgroup",preventOnFilter:!1,setData:a,onStart:s,onChange:c})})),Sortable.create(document.getElementById("wp_inactive_widgets"),{group:{name:"inactive",put:["widget-list","active-widgets"]},handle:".widget",filter:"input, select, textarea, label, button, fieldset, legend, datalist, output, option, optgroup",preventOnFilter:!1,setData:a,onStart:s,onChange:c,onAdd:function(){document.getElementById("inactive-widgets-control-remove").disabled=!1}}),r.forEach((function(e){var t=e.querySelector("details"),n="open";e.addEventListener("dragover",(function(e){e.preventDefault(),t.hasAttribute("open")||(n="closed",t.setAttribute("open","open"))})),e.addEventListener("dragleave",(function(){setTimeout((function(){t.hasAttribute("open")&&"closed"===n&&!e.querySelector(".widgets-sortables").hasAttribute("data-dragover")&&t.removeAttribute("open")}),1e3)}))})),document.addEventListener("dragover",(function(e){function t(e){var t=document.scrollingElement.scrollTop;window.scrollTo({top:t+e})}e.clientY<50?t(-15):e.clientY>window.innerHeight-50&&t(15)}))}));