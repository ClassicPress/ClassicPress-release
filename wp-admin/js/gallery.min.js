document.addEventListener("DOMContentLoaded",(function(){"use strict";var e,t,n,l,o,i,d=!1;function r(e){"none"===e.style.display?e.style.display="":e.style.display="none"}t=function(){e=Sortable.create(document.getElementById("#media-items"),{group:"items",sort:!0,placeholder:"sorthelper",handle:"div.filename",dataIdAttr:"data-id",forceFallback:!!navigator.vendor.match(/apple/i),fallbackTolerance:2,onEnd:function(){var t=e.toArray(),n=t.length;t.forEach((function(e,t){var l=d?n-t:1+t;document.getElementById(e+" .menu_order input").value=l}))}})},n=function(){var e=document.querySelectorAll(".menu_order_input"),t=e.length;e.forEach((function(e,n){var l=d?t-n:1+n;document.getElementById(e+" .menu_order input").value=l}))},l=function(e){e=e||0,document.querySelectorAll(".menu_order_input").forEach((function(t){("0"===t.value||e)&&(t.value="")}))},document.getElementById("asc").addEventListener("click",(function(e){e.preventDefault(),d=!1,n()})),document.getElementById("desc").addEventListener("click",(function(e){e.preventDefault(),d=!0,n()})),document.getElementById("clear").addEventListener("click",(function(e){e.preventDefault(),l(1)})),document.getElementById("showall").addEventListener("click",(function(e){e.preventDefault(),r(document.querySelector("#sort-buttons span a")),document.querySelector("a.describe-toggle-on").style.display="none",document.querySelector("a.describe-toggle-off").style.display="",document.querySelector("table.slidetoggle").style.display="",document.querySelector("img.pinkynail").style.display="none"})),document.getElementById("hideall").addEventListener("click",(function(e){e.preventDefault(),r(document.querySelector("#sort-buttons span a")),document.querySelector("a.describe-toggle-on").style.display="",document.querySelector("a.describe-toggle-off").style.display="none",document.querySelector("table.slidetoggle").style.display="none",document.querySelector("img.pinkynail").style.display=""})),t(),l(),document.querySelectorAll("#media-items > *").length>1&&(o=wpgallery.getWin(),document.getElementById("save-all").style.display="",document.getElementById("gallery-settings").style.display="","undefined"!=typeof o.tinyMCE&&o.tinyMCE.activeEditor&&((i=o.tinyMCE.activeEditor).offsetWidth||i.offsetHeight||i.getClientRects().length)?(wpgallery.mcemode=!0,wpgallery.init()):document.getElementById("insert-gallery").style.display="")})),window.addEventListener("beforeunload",(function(){window.tinymce=window.tinyMCE=window.wpgallery=null})),window.tinymce=null,window.wpgallery={mcemode:!1,editor:{},dom:{},is_update:!1,el:{},I:function(e){return document.getElementById(e)},init:function(){var e,t,n,l,o=this,i=o.getWin();if(o.mcemode){for(e=(""+document.location.search).replace(/^\?/,"").split("&"),t={},n=0;n<e.length;n++)l=e[n].split("="),t[unescape(l[0])]=unescape(l[1]);t.mce_rdomain&&(document.domain=t.mce_rdomain),window.tinymce=i.tinymce,window.tinyMCE=i.tinyMCE,o.editor=tinymce.EditorManager.activeEditor,o.setup()}},getWin:function(){return window.dialogArguments||opener||parent||top},setup:function(){var e,t,n,l,o,i,d=this,r=d.editor;if(d.mcemode){if(d.el=r.selection.getNode(),"IMG"!==d.el.nodeName||!r.dom.hasClass(d.el,"wpGallery")){if(!(t=r.dom.select("img.wpGallery"))||!t[0])return"1"===getUserSetting("galfile")&&(d.I("linkto-file").checked="checked"),"1"===getUserSetting("galdesc")&&(d.I("order-desc").checked="checked"),getUserSetting("galcols")&&(d.I("columns").value=getUserSetting("galcols")),getUserSetting("galord")&&(d.I("orderby").value=getUserSetting("galord")),void jQuery("#insert-gallery").show();d.el=t[0]}e=r.dom.getAttrib(d.el,"title"),(e=r.dom.decode(e))?(jQuery("#update-gallery").show(),d.is_update=!0,n=e.match(/columns=['"]([0-9]+)['"]/),l=e.match(/link=['"]([^'"]+)['"]/i),o=e.match(/order=['"]([^'"]+)['"]/i),i=e.match(/orderby=['"]([^'"]+)['"]/i),l&&l[1]&&(d.I("linkto-file").checked="checked"),o&&o[1]&&(d.I("order-desc").checked="checked"),n&&n[1]&&(d.I("columns").value=""+n[1]),i&&i[1]&&(d.I("orderby").value=i[1])):jQuery("#insert-gallery").show()}},update:function(){var e,t=this,n=t.editor,l="";if(!t.mcemode||!t.is_update)return e="[gallery"+t.getSettings()+"]",void t.getWin().send_to_editor(e);"IMG"===t.el.nodeName&&(l=(l=n.dom.decode(n.dom.getAttrib(t.el,"title"))).replace(/\s*(order|link|columns|orderby)=['"]([^'"]+)['"]/gi,""),l+=t.getSettings(),n.dom.setAttrib(t.el,"title",l),t.getWin().tb_remove())},getSettings:function(){var e=this.I,t="";return e("linkto-file").checked&&(t+=' link="file"',setUserSetting("galfile","1")),e("order-desc").checked&&(t+=' order="DESC"',setUserSetting("galdesc","1")),3!==e("columns").value&&(t+=' columns="'+e("columns").value+'"',setUserSetting("galcols",e("columns").value)),"menu_order"!==e("orderby").value&&(t+=' orderby="'+e("orderby").value+'"',setUserSetting("galord",e("orderby").value)),t}};