jQuery(document).ready((function(e){var t,i,n,l,o=!1;t=function(){e("#media-items").sortable({items:"div.media-item",placeholder:"sorthelper",axis:"y",distance:2,handle:"div.filename",stop:function(){var t=e("#media-items").sortable("toArray"),i=t.length;e.each(t,(function(t,n){var l=o?i-t:1+t;e("#"+n+" .menu_order input").val(l)}))}})},i=function(){var t=e(".menu_order_input"),i=t.length;t.each((function(t){var n=o?i-t:1+t;e(this).val(n)}))},n=function(t){t=t||0,e(".menu_order_input").each((function(){("0"===this.value||t)&&(this.value="")}))},e("#asc").click((function(e){e.preventDefault(),o=!1,i()})),e("#desc").click((function(e){e.preventDefault(),o=!0,i()})),e("#clear").click((function(e){e.preventDefault(),n(1)})),e("#showall").click((function(t){t.preventDefault(),e("#sort-buttons span a").toggle(),e("a.describe-toggle-on").hide(),e("a.describe-toggle-off, table.slidetoggle").show(),e("img.pinkynail").toggle(!1)})),e("#hideall").click((function(t){t.preventDefault(),e("#sort-buttons span a").toggle(),e("a.describe-toggle-on").show(),e("a.describe-toggle-off, table.slidetoggle").hide(),e("img.pinkynail").toggle(!0)})),t(),n(),e("#media-items>*").length>1&&(l=wpgallery.getWin(),e("#save-all, #gallery-settings").show(),"undefined"!=typeof l.tinyMCE&&l.tinyMCE.activeEditor&&!l.tinyMCE.activeEditor.isHidden()?(wpgallery.mcemode=!0,wpgallery.init()):e("#insert-gallery").show())})),jQuery(window).unload((function(){tinymce=tinyMCE=wpgallery=null}));var tinyMCE,wpgallery,tinymce=null;wpgallery={mcemode:!1,editor:{},dom:{},is_update:!1,el:{},I:function(e){return document.getElementById(e)},init:function(){var e,t,i,n,l=this,o=l.getWin();if(l.mcemode){for(e=(""+document.location.search).replace(/^\?/,"").split("&"),t={},i=0;i<e.length;i++)n=e[i].split("="),t[unescape(n[0])]=unescape(n[1]);t.mce_rdomain&&(document.domain=t.mce_rdomain),tinymce=o.tinymce,tinyMCE=o.tinyMCE,l.editor=tinymce.EditorManager.activeEditor,l.setup()}},getWin:function(){return window.dialogArguments||opener||parent||top},setup:function(){var e,t,i,n,l,o,r=this,a=r.editor;if(r.mcemode){if(r.el=a.selection.getNode(),"IMG"!==r.el.nodeName||!a.dom.hasClass(r.el,"wpGallery")){if(!(t=a.dom.select("img.wpGallery"))||!t[0])return"1"===getUserSetting("galfile")&&(r.I("linkto-file").checked="checked"),"1"===getUserSetting("galdesc")&&(r.I("order-desc").checked="checked"),getUserSetting("galcols")&&(r.I("columns").value=getUserSetting("galcols")),getUserSetting("galord")&&(r.I("orderby").value=getUserSetting("galord")),void jQuery("#insert-gallery").show();r.el=t[0]}e=a.dom.getAttrib(r.el,"title"),(e=a.dom.decode(e))?(jQuery("#update-gallery").show(),r.is_update=!0,i=e.match(/columns=['"]([0-9]+)['"]/),n=e.match(/link=['"]([^'"]+)['"]/i),l=e.match(/order=['"]([^'"]+)['"]/i),o=e.match(/orderby=['"]([^'"]+)['"]/i),n&&n[1]&&(r.I("linkto-file").checked="checked"),l&&l[1]&&(r.I("order-desc").checked="checked"),i&&i[1]&&(r.I("columns").value=""+i[1]),o&&o[1]&&(r.I("orderby").value=o[1])):jQuery("#insert-gallery").show()}},update:function(){var e,t=this,i=t.editor,n="";if(!t.mcemode||!t.is_update)return e="[gallery"+t.getSettings()+"]",void t.getWin().send_to_editor(e);"IMG"===t.el.nodeName&&(n=(n=i.dom.decode(i.dom.getAttrib(t.el,"title"))).replace(/\s*(order|link|columns|orderby)=['"]([^'"]+)['"]/gi,""),n+=t.getSettings(),i.dom.setAttrib(t.el,"title",n),t.getWin().tb_remove())},getSettings:function(){var e=this.I,t="";return e("linkto-file").checked&&(t+=' link="file"',setUserSetting("galfile","1")),e("order-desc").checked&&(t+=' order="DESC"',setUserSetting("galdesc","1")),3!==e("columns").value&&(t+=' columns="'+e("columns").value+'"',setUserSetting("galcols",e("columns").value)),"menu_order"!==e("orderby").value&&(t+=' orderby="'+e("orderby").value+'"',setUserSetting("galord",e("orderby").value)),t}};