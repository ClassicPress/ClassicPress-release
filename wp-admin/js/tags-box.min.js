var tagBox,array_unique_noempty;!function(t){var e=window.tagsSuggestL10n&&window.tagsSuggestL10n.tagDelimiter||",";array_unique_noempty=function(e){var a=[];return t.each(e,(function(e,s){(s=t.trim(s))&&-1===t.inArray(s,a)&&a.push(s)})),a},tagBox={clean:function(t){return","!==e&&(t=t.replace(new RegExp(e,"g"),",")),t=t.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,""),","!==e&&(t=t.replace(/,/g,e)),t},parseTags:function(a){var s=a.id.split("-check-num-")[1],n=t(a).closest(".tagsdiv"),i=n.find(".the-tags"),c=i.val().split(e),o=[];return delete c[s],t.each(c,(function(e,a){(a=t.trim(a))&&o.push(a)})),i.val(this.clean(o.join(e))),this.quickClicks(n),!1},quickClicks:function(a){var s,n,i=t(".the-tags",a),c=t(".tagchecklist",a),o=t(a).attr("id");i.length&&(n=i.prop("disabled"),s=i.val().split(e),c.empty(),t.each(s,(function(e,a){var s,i;(a=t.trim(a))&&(s=t("<li />").text(a),n||((i=t('<button type="button" id="'+o+"-check-num-"+e+'" class="ntdelbutton"><span class="remove-tag-icon" aria-hidden="true"></span><span class="screen-reader-text">'+window.tagsSuggestL10n.removeTerm+" "+s.html()+"</span></button>")).on("click keypress",(function(e){"click"!==e.type&&13!==e.keyCode&&32!==e.keyCode||(13!==e.keyCode&&32!==e.keyCode||t(this).closest(".tagsdiv").find("input.newtag").focus(),tagBox.userAction="remove",tagBox.parseTags(this))})),s.prepend("&nbsp;").prepend(i)),c.append(s))})),tagBox.screenReadersMessage())},flushTags:function(a,s,n){var i,c,o,r=t(".the-tags",a),u=t("input.newtag",a);return void 0===(o=(s=s||!1)?t(s).text():u.val())||""===o||(c=(i=r.val())?i+e+o:o,c=this.clean(c),c=array_unique_noempty(c.split(e)).join(e),r.val(c),this.quickClicks(a),s||u.val(""),void 0===n&&u.focus()),!1},get:function(e){var a=e.substr(e.indexOf("-")+1);t.post(ajaxurl,{action:"get-tagcloud",tax:a},(function(s,n){0!==s&&"success"==n&&(s=t('<div id="tagcloud-'+a+'" class="the-tagcloud">'+s+"</div>"),t("a",s).click((function(){return tagBox.userAction="add",tagBox.flushTags(t("#"+a),this),!1})),t("#"+e).after(s))}))},userAction:"",screenReadersMessage:function(){var t;switch(this.userAction){case"remove":t=window.tagsSuggestL10n.termRemoved;break;case"add":t=window.tagsSuggestL10n.termAdded;break;default:return}window.wp.a11y.speak(t,"assertive")},init:function(){var e=t("div.ajaxtag");t(".tagsdiv").each((function(){tagBox.quickClicks(this)})),t(".tagadd",e).click((function(){tagBox.userAction="add",tagBox.flushTags(t(this).closest(".tagsdiv"))})),t("input.newtag",e).keypress((function(e){13==e.which&&(tagBox.userAction="add",tagBox.flushTags(t(this).closest(".tagsdiv")),e.preventDefault(),e.stopPropagation())})).keypress((function(t){13==t.which&&(t.preventDefault(),t.stopPropagation())})).each((function(e,a){t(a).wpTagsSuggest()})),t("#post").submit((function(){t("div.tagsdiv").each((function(){tagBox.flushTags(this,!1,1)}))})),t(".tagcloud-link").click((function(){tagBox.get(t(this).attr("id")),t(this).attr("aria-expanded","true").unbind().click((function(){t(this).attr("aria-expanded","false"===t(this).attr("aria-expanded")?"true":"false").siblings(".the-tagcloud").toggle()}))}))}}}(jQuery);