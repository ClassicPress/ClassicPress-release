jQuery((function(e){var t,s,a,i=wp.i18n.__,n=wp.i18n._n,o=wp.i18n.sprintf,l=new ClipboardJS(".site-health-copy-buttons .copy-button"),r=e(".health-check-body.health-check-status-tab").length,h=e(".health-check-body.health-check-debug-tab").length,c=e("#health-check-accordion-block-wp-paths-sizes"),u=e("#adminmenu .site-health-counter"),d=e("#adminmenu .site-health-counter .count");function p(t){var s,a,i=wp.template("health-check-issue"),l=e("#health-check-issues-"+t.status);if(!function(e){var t,s,a,i,n={test:"string",label:"string",description:"string"},o=!0;if("object"!=typeof e)return!1;for(t in n)if("object"==typeof(s=n[t]))for(a in s)i=s[a],"undefined"!=typeof e[t]&&"undefined"!=typeof e[t][a]&&i===typeof e[t][a]||(o=!1);else"undefined"!=typeof e[t]&&s===typeof e[t]||(o=!1);return o}(t))return!1;SiteHealth.site_status.issues[t.status]++,a=SiteHealth.site_status.issues[t.status],"undefined"==typeof t.test&&(t.test=t.status+a),"critical"===t.status?s=o(n("%s critical issue","%s critical issues",a),'<span class="issue-count">'+a+"</span>"):"recommended"===t.status?s=o(n("%s recommended improvement","%s recommended improvements",a),'<span class="issue-count">'+a+"</span>"):"good"===t.status&&(s=o(n("%s item with no issues detected","%s items with no issues detected",a),'<span class="issue-count">'+a+"</span>")),s&&e(".site-health-issue-count-title",l).html(s),d.text(SiteHealth.site_status.issues.critical),0<parseInt(SiteHealth.site_status.issues.critical,0)?(e("#health-check-issues-critical").removeClass("hidden"),u.removeClass("count-0")):u.addClass("count-0"),0<parseInt(SiteHealth.site_status.issues.recommended,0)&&e("#health-check-issues-recommended").removeClass("hidden"),e(".issues","#health-check-issues-"+t.status).append(i(t))}function f(){var t,s,a=e(".site-health-progress"),n=a.closest(".site-health-progress-wrapper"),o=e(".site-health-progress-label",n),l=e(".site-health-progress svg #bar"),h=parseInt(SiteHealth.site_status.issues.good,0)+parseInt(SiteHealth.site_status.issues.recommended,0)+1.5*parseInt(SiteHealth.site_status.issues.critical,0),c=.5*parseInt(SiteHealth.site_status.issues.recommended,0)+1.5*parseInt(SiteHealth.site_status.issues.critical,0),u=100-Math.ceil(c/h*100);0!==h?(n.removeClass("loading"),t=l.attr("r"),0>u&&(u=0),100<u&&(u=100),s=(100-u)/100*(Math.PI*(2*t))+"px",l.css({strokeDashoffset:s}),80<=u&&0===parseInt(SiteHealth.site_status.issues.critical,0)?(n.addClass("green").removeClass("orange"),o.text(i("Good")),wp.a11y.speak(i("All site health tests have finished running. Your site is looking good, and the results are now available on the page."))):(n.addClass("orange").removeClass("green"),o.text(i("Should be improved")),wp.a11y.speak(i("All site health tests have finished running. There are items that should be addressed, and the results are now available on the page."))),r&&(e.post(ajaxurl,{action:"health-check-site-status-result",_wpnonce:SiteHealth.nonce.site_status_result,counts:SiteHealth.site_status.issues}),100===u&&(e(".site-status-all-clear").removeClass("hide"),e(".site-status-has-issues").addClass("hide")))):a.addClass("hidden")}function g(e,t){var s;s={status:"recommended",label:i("A test is unavailable"),badge:{color:"red",label:i("Unavailable")},description:"<p>"+e+"</p><p>"+t+"</p>",actions:""},p(wp.hooks.applyFilters("site_status_test_result",s))}l.on("success",(function(s){var a=e(s.trigger),n=e(".success",a.closest("div"));s.clearSelection(),a.trigger("focus"),clearTimeout(t),n.removeClass("hidden"),t=setTimeout((function(){n.addClass("hidden")}),3e3),wp.a11y.speak(i("Site information has been copied to your clipboard."))})),e(".health-check-accordion").on("click",".health-check-accordion-trigger",(function(){"true"===e(this).attr("aria-expanded")?(e(this).attr("aria-expanded","false"),e("#"+e(this).attr("aria-controls")).attr("hidden",!0)):(e(this).attr("aria-expanded","true"),e("#"+e(this).attr("aria-controls")).attr("hidden",!1))})),e(".site-health-view-passed").on("click",(function(){var t=e("#health-check-issues-good");t.toggleClass("hidden"),e(this).attr("aria-expanded",!t.hasClass("hidden"))})),"undefined"!=typeof SiteHealth&&(0===SiteHealth.site_status.direct.length&&0===SiteHealth.site_status.async.length?f():SiteHealth.site_status.issues={good:0,recommended:0,critical:0},0<SiteHealth.site_status.direct.length&&e.each(SiteHealth.site_status.direct,(function(){p(this)})),0<SiteHealth.site_status.async.length?function m(){var t=!0;1<=SiteHealth.site_status.async.length&&e.each(SiteHealth.site_status.async,(function(){var s={action:"health-check-"+this.test.replace("_","-"),_wpnonce:SiteHealth.nonce.site_status};return!!this.completed||(t=!1,this.completed=!0,"undefined"!=typeof this.has_rest&&this.has_rest?wp.apiRequest({url:wp.url.addQueryArgs(this.test,{_locale:"user"}),headers:this.headers}).done((function(e){p(wp.hooks.applyFilters("site_status_test_result",e))})).fail((function(e){var t;t="undefined"!=typeof e.responseJSON&&"undefined"!=typeof e.responseJSON.message?e.responseJSON.message:i("No details available"),g(this.url,t)})).always((function(){m()})):e.post(ajaxurl,s).done((function(e){p(wp.hooks.applyFilters("site_status_test_result",e.data))})).fail((function(e){var t;t="undefined"!=typeof e.responseJSON&&"undefined"!=typeof e.responseJSON.message?e.responseJSON.message:i("No details available"),g(this.url,t)})).always((function(){m()})),!1)})),t&&f()}():f()),h&&(c.length?(s=(new Date).getTime(),a=window.setTimeout((function(){wp.a11y.speak(i("Please wait..."))}),3e3),wp.apiRequest({path:"/wp-site-health/v1/directory-sizes"}).done((function(t){var s,a,i;s=t||{},a=e("button.button.copy-button"),i=a.attr("data-clipboard-text"),e.each(s,(function(e,t){var s=t.debug||t.size;void 0!==s&&(i=i.replace(e+": loading...",e+": "+s))})),a.attr("data-clipboard-text",i),c.find("td[class]").each((function(t,a){var i=e(a),n=i.attr("class");s.hasOwnProperty(n)&&s[n].size&&i.text(s[n].size)}))})).always((function(){var t=(new Date).getTime()-s;e(".health-check-wp-paths-sizes.spinner").css("visibility","hidden"),f(),t>3e3?(t=t>6e3?0:6500-t,window.setTimeout((function(){wp.a11y.speak(i("All site health tests have finished running."))}),t)):window.clearTimeout(a),e(document).trigger("site-health-info-dirsizes-done")}))):f()),e(".health-check-offscreen-nav-wrapper").on("click",(function(){e(this).toggleClass("visible")}))}));