!function(t){var e,a=t("#choose-from-library-button"),i=t("#site-icon-preview"),s=t("#browser-icon-preview"),r=t("#app-icon-preview"),n=t("#site_icon_hidden_field"),l=t("#js-remove-site-icon");function o(t){var e,a,i=t.get("width"),s=t.get("height"),r=512,n=512,l=r/n,o=r,c=n;return i/s>l?r=(n=s)*l:n=(r=i)/l,{aspectRatio:r+":"+n,handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:i,imageHeight:s,minWidth:o>r?r:o,minHeight:c>n?n:c,x1:e=(i-r)/2,y1:a=(s-n)/2,x2:r+e,y2:n+a}}function c(t){var e,n;t.alt?(e=wp.i18n.sprintf(wp.i18n.__("App icon preview: Current image: %s"),t.alt),n=wp.i18n.sprintf(wp.i18n.__("Browser icon preview: Current image: %s"),t.alt)):(e=wp.i18n.sprintf(wp.i18n.__("App icon preview: The current image has no alternative text. The file name is: %s"),t.filename),n=wp.i18n.sprintf(wp.i18n.__("Browser icon preview: The current image has no alternative text. The file name is: %s"),t.filename)),r.attr({src:t.url,alt:e}),s.attr({src:t.url,alt:n}),i.removeClass("hidden"),l.removeClass("hidden"),"1"!==a.attr("data-state")&&a.attr({"class":a.attr("data-alt-classes"),"data-alt-classes":a.attr("class"),"data-state":"1"}),a.text(a.attr("data-update-text"))}a.on("click",(function(){var a=t(this);(e=wp.media({button:{text:a.data("update"),close:!1},states:[new wp.media.controller.Library({title:a.data("choose-text"),library:wp.media.query({type:"image"}),date:!1,suggestedWidth:a.data("size"),suggestedHeight:a.data("size")}),new wp.media.controller.SiteIconCropper({control:{params:{width:a.data("size"),height:a.data("size")}},imgSelectOptions:o})]})).on("cropped",(function(t){n.val(t.id),c(t),e.close(),e=null})),e.on("select",(function(){var t=e.state().get("selection").first();t.attributes.height===a.data("size")&&a.data("size")===t.attributes.width?(c(t.attributes),e.close(),n.val(t.id)):e.setState("cropper")})),e.open()})),l.on("click",(function(){n.val("false"),t(this).toggleClass("hidden"),i.toggleClass("hidden"),s.attr({src:"",alt:""}),r.attr({src:"",alt:""}),a.attr({"class":a.attr("data-alt-classes"),"data-alt-classes":a.attr("class"),"data-state":""}).text(a.attr("data-choose-text")).trigger("focus")}))}(jQuery);