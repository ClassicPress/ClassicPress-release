!function(e,t){if(e&&e.customize){var i,n=e.customize;n.Widgets=n.Widgets||{},n.Widgets.savedWidgetIds={},n.Widgets.data=_wpCustomizeWidgetsSettings||{},i=n.Widgets.data.l10n,n.Widgets.WidgetModel=Backbone.Model.extend({id:null,temp_id:null,classname:null,control_tpl:null,description:null,is_disabled:null,is_multi:null,multi_number:null,name:null,id_base:null,transport:null,params:[],width:null,height:null,search_matched:!0}),n.Widgets.WidgetCollection=Backbone.Collection.extend({model:n.Widgets.WidgetModel,doSearch:function(e){this.terms!==e&&(this.terms=e,this.terms.length>0&&this.search(this.terms),""===this.terms&&this.each((function(e){e.set("search_matched",!0)})))},search:function(e){var t,i;e=(e=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")).replace(/ /g,")(?=.*"),t=new RegExp("^(?=.*"+e+").+","i"),this.each((function(e){i=[e.get("name"),e.get("description")].join(" "),e.set("search_matched",t.test(i))}))}}),n.Widgets.availableWidgets=new n.Widgets.WidgetCollection(n.Widgets.data.availableWidgets),n.Widgets.SidebarModel=Backbone.Model.extend({after_title:null,after_widget:null,before_title:null,before_widget:null,"class":null,description:null,id:null,name:null,is_rendered:!1}),n.Widgets.SidebarCollection=Backbone.Collection.extend({model:n.Widgets.SidebarModel}),n.Widgets.registeredSidebars=new n.Widgets.SidebarCollection(n.Widgets.data.registeredSidebars),n.Widgets.AvailableWidgetsPanelView=e.Backbone.View.extend({el:"#available-widgets",events:{"input #widgets-search":"search","focus .widget-tpl":"focus","click .widget-tpl":"_submit","keypress .widget-tpl":"_submit",keydown:"keyboardAccessible"},selected:null,currentSidebarControl:null,$search:null,$clearResults:null,searchMatchesCount:null,initialize:function(){var e=this;this.search=document.getElementById("widgets-search"),this.clearResults=document.querySelector(".clear-results"),_.bindAll(this,"close"),this.listenTo(this.collection,"change",this.updateList),this.updateList(),this.searchMatchesCount=this.collection.length,t("#customize-controls, #available-widgets .customize-section-title").on("click keydown",(function(i){var n=t(i.target).is(".add-new-widget, .add-new-widget *");t("body").hasClass("adding-widget")&&!n&&e.close()})),this.clearResults.addEventListener("click",(function(){e.search.value="",e.search.focus(),e.search.dispatchEvent(new Event("input"))})),n.previewer.bind("url",this.close)},search:_.debounce((function(e){var t;this.collection.doSearch(e.target.value),this.updateSearchMatchesCount(),this.announceSearchMatches(),this.selected&&!this.selected.is(":visible")&&(this.selected.removeClass("selected"),this.selected=null),this.selected&&!e.target.value&&(this.selected.removeClass("selected"),this.selected=null),!this.selected&&e.target.value&&(t=this.$el.find("> .widget-tpl:visible:first")).length&&this.select(t),""!==e.target.value?this.$clearResults.addClass("is-visible"):""===e.target.value&&this.$clearResults.removeClass("is-visible"),this.searchMatchesCount?this.$el.removeClass("no-widgets-found"):this.$el.addClass("no-widgets-found")}),500),updateSearchMatchesCount:function(){this.searchMatchesCount=this.collection.where({search_matched:!0}).length},announceSearchMatches:function(){var t=i.widgetsFound.replace("%d",this.searchMatchesCount);this.searchMatchesCount||(t=i.noWidgetsFound),e.a11y.speak(t)},updateList:function(){this.collection.each((function(e){var i=t("#widget-tpl-"+e.id);i.toggle(e.get("search_matched")&&!e.get("is_disabled")),e.get("is_disabled")&&i.is(this.selected)&&(this.selected=null)}))},select:function(e){this.selected=t(e),this.selected.siblings(".widget-tpl").removeClass("selected"),this.selected.addClass("selected")},focus:function(e){this.select(t(e.currentTarget))},_submit:function(e){"keypress"===e.type&&"Enter"!==e.key&&" "!==e.key||this.submit(t(e.currentTarget))},submit:function(e){var i,n,s;e||(e=this.selected),e&&this.currentSidebarControl&&(this.select(e),i=t(this.selected).data("widget-id"),(n=this.collection.findWhere({id:i}))&&((s=this.currentSidebarControl.addWidget(n.get("id_base")))&&s.focus(),this.close()))},open:function(e){this.currentSidebarControl=e,_(this.currentSidebarControl.getWidgetFormControls()).each((function(e){e.params.is_wide&&e.collapseForm()})),n.section.has("publish_settings")&&n.section("publish_settings").collapse(),document.body.classList.add("adding-widget"),this.el.querySelector(".selected")&&this.el.querySelector(".selected").removeClass("selected"),this.collection.doSearch(""),n.settings.browser.mobile||this.search.focus()},close:function(e){(e=e||{}).returnFocus&&this.currentSidebarControl&&this.currentSidebarControl.container[0].querySelector(".add-new-widget").focus(),this.currentSidebarControl=null,this.selected=null,document.body.classList.remove("adding-widget"),this.search.value="",this.search.dispatchEvent(new Event("input"))},keyboardAccessible:function(e){var i="Enter"===e.key,n="Escape"===e.key,s="ArrowDown"===e.key,d="ArrowUp"===e.key,a="Tab"===e.key,o="Shift"===e.key,r=null,l=this.$el.find("> .widget-tpl:visible:first"),c=this.$el.find("> .widget-tpl:visible:last"),g=t(e.target).is(this.$search),u=t(e.target).is(".widget-tpl:visible:last");if(s||d)return s?g?r=l:this.selected&&0!==this.selected.nextAll(".widget-tpl:visible").length&&(r=this.selected.nextAll(".widget-tpl:visible:first")):d&&(g?r=c:this.selected&&0!==this.selected.prevAll(".widget-tpl:visible").length&&(r=this.selected.prevAll(".widget-tpl:visible:first"))),this.select(r),void(r?r[0].focus():this.search.focus());i&&!this.search.value||(i?this.submit():n&&this.close({returnFocus:!0}),this.currentSidebarControl&&a&&(o&&g||!o&&u)&&(this.currentSidebarControl.container.find(".add-new-widget").focus(),e.preventDefault()))}}),n.Widgets.formSyncHandlers={rss:function(e){var t=e.detail.widget,i=e.detail.form,n=t.querySelector(".widget-error"),s=document.querySelector("<div>"+i+"</div>").querySelector(".widget-error");n.length&&s.length?n.replaceWith(s):n.length?n.remove():s.length&&t.querySelector(".widget-content").prepend(s)}},n.Widgets.WidgetControl=n.Control.extend({defaultExpandedArguments:{duration:"fast",completeCallback:t.noop},initialize:function(e,i){var s=this;s.widgetControlEmbedded=!1,s.widgetContentEmbedded=!1,s.expanded=new n.Value(!1),s.expandedArgumentsQueue=[],s.expanded.bind((function(e){var i=s.expandedArgumentsQueue.shift();i=t.extend({},s.defaultExpandedArguments,i),s.onChangeExpanded(e,i)})),s.altNotice=!0,n.Control.prototype.initialize.call(s,e,i)},ready:function(){var e=this;e.section()?n.section(e.section(),(function(t){function i(n){n&&(e.embedWidgetControl(),t.expanded.unbind(i))}t.expanded()?i(!0):t.expanded.bind(i)})):e.embedWidgetControl(),e.embedWidgetContent()},embedWidgetControl:function(){var e,i=this;i.widgetControlEmbedded||(i.widgetControlEmbedded=!0,e=t(i.params.widget_control),i.container.append(e),i._setupModel(),i._setupWideWidget(),i._setupControlToggle(),i._setupWidgetTitle(),i._setupReorderUI(),i._setupHighlightEffects(),i._setupUpdateUI(),i._setupRemoveUI())},embedWidgetContent:function(){var e,t=this;t.embedWidgetControl(),t.widgetContentEmbedded||(t.widgetContentEmbedded=!0,t.notifications.container=t.getNotificationsContainerElement(),t.notifications.render(),null!=(e=t.params.widget_content)&&t.container[0].querySelector(".widget-content").insertAdjacentHTML("beforeend",e),document.dispatchEvent(new CustomEvent("widget-added",{detail:{widget:t.container[0].querySelector(".widget")}})))},_setupModel:function(){var e,t=this;e=function(){n.Widgets.savedWidgetIds[t.params.widget_id]=!0},n.bind("ready",e),n.bind("saved",e),this._updateCount=0,this.isWidgetUpdating=!1,this.liveUpdateMode=!0,this.setting.bind((function(e,i){_(i).isEqual(e)||t.isWidgetUpdating||t.updateWidget({instance:e})}))},_setupWideWidget:function(){var e,i,s,d,a,o=this;!this.params.is_wide||t(window).width()<=640||(e=this.container.find(".widget-inside"),i=e.find("> .form"),s=t(".wp-full-overlay-sidebar-content:first"),this.container.addClass("wide-widget-control"),this.container.find(".form:first").css({"max-width":this.params.width,"min-height":this.params.height}),a=function(){var n,s=o.container.offset().top,d=t(window).height(),a=i.outerHeight();e.css("max-height",d),n=Math.max(0,Math.min(Math.max(s,0),d-a)),e.css("top",n)},d=t("#customize-theme-controls"),this.container.on("expand",(function(){a(),s.on("scroll",a),t(window).on("resize",a),d.on("expanded collapsed",a)})),this.container.on("collapsed",(function(){s.off("scroll",a),t(window).off("resize",a),d.off("expanded collapsed",a)})),n.each((function(e){0===e.id.indexOf("sidebars_widgets[")&&e.bind((function(){o.container.hasClass("expanded")&&a()}))})))},_setupControlToggle:function(){var e;(e=this.container[0].querySelector(".widget-control-close")).addEventListener("click",(function(){e.closest("details").removeAttribute("open"),e.closest("details").querySelector("summary").focus()}))},_setupWidgetTitle:function(){var e,t=this;e=function(){var e=t.setting().title,i=t.container.find(".in-widget-title");e?i.text(": "+e):i.text("")},this.setting.bind(e),e()},_setupReorderUI:function(){var s,d,a,o,r=this;s=function(e){e.siblings(".selected").removeClass("selected"),e.addClass("selected");var t=e.data("id")===r.params.sidebar_id;r.container.find(".move-widget-btn").prop("disabled",t)},r.container[0].querySelector("summary").insertAdjacentHTML("beforeend",n.Widgets.data.tpl.widgetReorderNav),o=_.template(n.Widgets.data.tpl.moveWidgetArea),d=t(o({sidebars:_(n.Widgets.registeredSidebars.toArray()).pluck("attributes")})),this.container.find(".widget-top").after(d),(a=function(){var e,i=d.find("li"),a=0;e=i.filter((function(){return t(this).data("id")===r.params.sidebar_id})),i.each((function(){var i,d,o=t(this);i=o.data("id"),d=n.Widgets.registeredSidebars.get(i).get("is_rendered"),o.toggle(d),d&&(a+=1),o.hasClass("selected")&&!d&&s(e)})),a>1?r.container.find(".move-widget").show():r.container.find(".move-widget").hide()})(),n.Widgets.registeredSidebars.on("change:is_rendered",a),this.container.find(".widget-reorder-nav").find(".move-widget, .move-widget-down, .move-widget-up").each((function(){t(this).prepend(r.container.find(".widget-title").text()+": ")})).on("click keypress",(function(n){if(n.preventDefault(),"keypress"!==n.type||"Enter"===n.key||" "===n.key)if(this.focus(),t(this).is(".move-widget"))r.toggleWidgetMoveArea();else{var s=t(this).is(".move-widget-down"),d=t(this).is(".move-widget-up"),a=r.getWidgetSidebarPosition();if(d&&0===a||s&&a===r.getSidebarWidgetsControl().setting().length-1)return;d?(r.moveUp(),e.a11y.speak(i.widgetMovedUp)):(r.moveDown(),e.a11y.speak(i.widgetMovedDown)),this.focus()}})),this.container.find(".widget-area-select").on("click keypress","li",(function(e){"keypress"===e.type&&"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),s(t(this)))})),this.container.find(".move-widget-btn").click((function(){r.getSidebarWidgetsControl().toggleReordering(!1);var e,t,i,s,d,a=r.params.sidebar_id,o=r.container.find(".widget-area-select li.selected").data("id");e=n("sidebars_widgets["+a+"]"),t=n("sidebars_widgets["+o+"]"),i=Array.prototype.slice.call(e()),s=Array.prototype.slice.call(t()),d=r.getWidgetSidebarPosition(),i.splice(d,1),s.push(r.params.widget_id),e(i),t(s),r.focus()}))},_setupHighlightEffects:function(){var e=this;this.container.on("mouseenter click",(function(){e.setting.previewer.send("highlight-widget",e.params.widget_id)})),this.setting.bind((function(){e.setting.previewer.send("highlight-widget",e.params.widget_id)}))},_setupUpdateUI:function(){var e,t,s,d=this;(e=this.container[0].querySelector(".widget-control-save")).value=i.saveBtnLabel,e.setAttribute("title",i.saveBtnTooltip),e.classList.remove("button-primary"),e.addEventListener("click",(function(e){e.preventDefault(),d.updateWidget({disable_form:!0})})),t=_.debounce((function(){d.updateWidget()}),250),this.container[0].querySelectorAll(".widget").forEach((function(e){function i(e){d.liveUpdateMode&&"change"===e.type&&t()}e.addEventListener("keydown",(function(e){"Enter"===e.key?(e.preventDefault(),d.updateWidget({ignoreActiveElement:!0})):t()})),e.addEventListener("change",i),e.addEventListener("input",i),e.addEventListener("propertychange",i),(s=n.Widgets.formSyncHandlers[d.params.widget_id_base])&&document.addEventListener("widget-synced",(function(t){e===t.detail.widget&&s.apply(document,arguments)}))})),this.setting.previewer.channel.bind("synced",(function(){d.container.removeClass("previewer-loading")})),n.previewer.bind("widget-updated",(function(e){e===d.params.widget_id&&d.container.removeClass("previewer-loading")}))},onChangeActive:function(e,t){this.container.toggleClass("widget-rendered",e),t.completeCallback&&t.completeCallback()},_setupRemoveUI:function(){var e,t,s=this;(e=this.container.find(".widget-control-remove")).on("click",(function(){var e;e=s.container.next().is(".customize-control-widget_form")?s.container.next().find(".widget-action:first"):s.container.prev().is(".customize-control-widget_form")?s.container.prev().find(".widget-action:first"):s.container.next(".customize-control-sidebar_widgets").find(".add-new-widget:first"),s.container.slideUp((function(){var t,i,d=n.Widgets.getSidebarWidgetControlContainingWidget(s.params.widget_id);d&&(t=d.setting().slice(),-1!==(i=_.indexOf(t,s.params.widget_id))&&(t.splice(i,1),d.setting(t),e.focus()))}))})),t=function(){e.text(i.removeBtnLabel),e.attr("title",i.removeBtnTooltip)},this.params.is_new?n.bind("saved",t):t()},_getInputs:function(e){return t(e).find(":input[name]")},_getInputsSignature:function(e){return _(e).map((function(e){var i=t(e);return(i.is(":checkbox, :radio")?[i.attr("id"),i.attr("name"),i.prop("value")]:[i.attr("id"),i.attr("name")]).join(",")})).join(";")},_getInputState:function(e){return(e=t(e)).is(":radio, :checkbox")?e.prop("checked"):e.is("select[multiple]")?e.find("option:selected").map((function(){return t(this).val()})).get():e.val()},_setInputState:function(e,i){(e=t(e)).is(":radio, :checkbox")?e.prop("checked",i):e.is("select[multiple]")?(i=Array.isArray(i)?_.map(i,(function(e){return String(e)})):[],e.find("option").each((function(){t(this).prop("selected",-1!==_.indexOf(i,String(this.value)))}))):e.val(i)},getSidebarWidgetsControl:function(){var e,t;if(e="sidebars_widgets["+this.params.sidebar_id+"]",t=n.control(e))return t},updateWidget:function(s){var d,a,o,r,l,c,g,u,h,p,f,m=this;m.embedWidgetContent(),d=(s=t.extend({instance:null,complete:null,ignoreActiveElement:!1},s)).instance,a=s.complete,this._updateCount+=1,l=this._updateCount,o=this.container[0].querySelector(".widget"),(r=o.querySelector(".widget-content")).querySelector(".widget-error")&&r.querySelector(".widget-error").remove(),this.container[0].classList.add("widget-form-loading"),this.container[0].classList.add("previewer-loading"),(h=n.state("processing"))(h()+1),this.liveUpdateMode||this.container[0].classList.add("widget-form-disabled"),(c={}).action="update-widget",c.wp_customize="on",c.nonce=n.settings.nonce["update-widget"],c.customize_theme=n.settings.theme.stylesheet,c.customized=e.customize.previewer.query().customized,g=t.param(c),(u=this._getInputs(r)).each((function(){t(this).data("state"+l,m._getInputState(this))})),g+=d?"&"+t.param({sanitized_widget_setting:JSON.stringify(d)}):"&"+u.serialize(),g+="&"+t(r).find("~ :input").serialize(),this._previousUpdateRequest&&this._previousUpdateRequest.abort(),p=t.post(e.ajax.settings.url,g),this._previousUpdateRequest=p,p.done((function(e){var d,c,g,h,p=!1;if("0"===e)return n.previewer.preview.iframe.hide(),void n.previewer.login().done((function(){m.updateWidget(s),n.previewer.preview.iframe.show()}));"-1"!==e?e.success?(c=t("<div>"+e.data.form+"</div>"),g=m._getInputs(c),(h=m._getInputsSignature(u)===m._getInputsSignature(g))&&!m.liveUpdateMode&&(m.liveUpdateMode=!0,m.container.removeClass("widget-form-disabled"),m.container.find('input[name="savewidget"]').hide()),h&&m.liveUpdateMode?(u.each((function(e){var i,n,d=t(this),a=t(g[e]);i=d.data("state"+l),n=m._getInputState(a),d.data("sanitized",n),!_.isEqual(i,n)&&(s.ignoreActiveElement||!d.is(document.activeElement))&&m._setInputState(d,n)})),document.dispatchEvent(new CustomEvent("widget-synced",{detail:{widget:o,form:e.data.form}}))):m.liveUpdateMode?(m.liveUpdateMode=!1,m.container[0].querySelector('input[name="savewidget"]').style.display="",p=!0):(r.innerHTML=e.data.form,m.container[0].classList.remove("widget-form-disabled"),document.dispatchEvent(new CustomEvent("widget-updated",{detail:{widget:o}}))),(f=!p&&!_(m.setting()).isEqual(e.data.instance))?(m.isWidgetUpdating=!0,m.setting(e.data.instance),m.isWidgetUpdating=!1):m.container[0].classList.remove("previewer-loading"),a&&a.call(m,null,{noChange:!f,ajaxFinished:!0})):(d=i.error,e.data&&e.data.message&&(d=e.data.message),a?a.call(m,d):r.prepend('<p class="widget-error"><strong>'+d+"</strong></p>")):n.previewer.cheatin()})),p.fail((function(e,t){a&&a.call(m,t)})),p.always((function(){m.container.removeClass("widget-form-loading"),u.each((function(){t(this).removeData("state"+l)})),h(h()-1)}))},expandControlSection:function(){n.Control.prototype.expand.call(this)},_toggleExpanded:n.Section.prototype._toggleExpanded,expand:n.Section.prototype.expand,expandForm:function(){this.expand()},collapse:n.Section.prototype.collapse,collapseForm:function(){this.collapse()},toggleForm:function(e){void 0===e&&(e=!this.expanded()),this.expanded(e)},onChangeExpanded:function(e,t){var i,s,d,a,o,r=this;r.embedWidgetControl(),e&&r.embedWidgetContent(),t.unchanged?e&&n.Control.prototype.expand.call(r,{completeCallback:t.completeCallback}):(i=this.container[0].querySelector("div.widget"),(s=i.querySelector("details")).closest("ul").querySelectorAll("details").forEach((function(e){e.removeAttribute("open")})),o=function(){t.completeCallback&&(a=d,d=function(){a(),t.completeCallback()}),s.setAttribute("open","open"),r.container[0].dispatchEvent(new CustomEvent("expand")),r.container[0].classList.add("expanding")},s.hasAttribute("open")?(t.completeCallback&&(a=d,d=function(){a(),t.completeCallback()}),r.container[0].dispatchEvent(new CustomEvent("collapse")),i.removeAttribute("open")):n.section.has(r.section())?n.section(r.section()).expand({completeCallback:o}):o())},getWidgetSidebarPosition:function(){var e,t;if(e=this.getSidebarWidgetsControl().setting(),-1!==(t=_.indexOf(e,this.params.widget_id)))return t},moveUp:function(){this._moveWidgetByOne(-1)},moveDown:function(){this._moveWidgetByOne(1)},_moveWidgetByOne:function(e){var t,i,n,s;t=this.getWidgetSidebarPosition(),i=this.getSidebarWidgetsControl().setting,s=(n=Array.prototype.slice.call(i()))[t+e],n[t+e]=this.params.widget_id,n[t]=s,i(n)},toggleWidgetMoveArea:function(e){var i,n=this;i=this.container.find(".move-widget-area"),void 0===e&&(e=!i.hasClass("active")),e&&(i.find(".selected").removeClass("selected"),i.find("li").filter((function(){return t(this).data("id")===n.params.sidebar_id})).addClass("selected"),this.container.find(".move-widget-btn").prop("disabled",!0)),i.toggleClass("active",e)},highlightSectionAndControl:function(){var e;e=this.container.is(":hidden")?this.container.closest(".control-section"):this.container,t(".highlighted").removeClass("highlighted"),e.addClass("highlighted"),setTimeout((function(){e.removeClass("highlighted")}),500)}}),n.Widgets.WidgetsPanel=n.Panel.extend({ready:function(){var e=this;n.Panel.prototype.ready.call(e),e.deferred.embedded.done((function(){var s,d,a,o,r;s=e.container.find(".panel-meta"),d=t("<div></div>",{"class":"no-widget-areas-rendered-notice"}),s.append(d),o=function(){return _.filter(e.sections(),(function(e){return"sidebar"===e.params.type&&e.active()})).length},r=function(){var e=o();return 0===e||e!==n.Widgets.data.registeredSidebars.length},(a=function(){var e,s,a,r=o();d.empty(),r!==(a=n.Widgets.data.registeredSidebars.length)&&(0!==r?(s=a-r,e=i.someAreasShown[s]):e=i.noAreasShown,e&&d.append(t("<p></p>",{text:e})),d.append(t("<p></p>",{text:i.navigatePreview})))})(),d.toggle(r()),n.previewer.deferred.active.done((function(){d.toggle(r())})),n.bind("pane-contents-reflowed",(function(){var e="resolved"===n.previewer.deferred.active.state()?"fast":0;a(),r()?d.slideDown(e):d.slideUp(e)}))}))},isContextuallyActive:function(){return this.active()}}),n.Widgets.SidebarSection=n.Section.extend({ready:function(){var e,t=this;n.Section.prototype.ready.call(this),e=n.Widgets.registeredSidebars.get(t.params.sidebarId),t.active.bind((function(t){e.set("is_rendered",t)})),e.set("is_rendered",t.active())}}),n.Widgets.SidebarControl=n.Control.extend({ready:function(){this.$controlSection=this.container.closest(".control-section"),this.$sectionContent=this.container.closest(".accordion-section-content"),this._setupModel(),this._setupSortable(),this._setupAddition(),this._applyCardinalOrderClassNames()},_setupModel:function(){var e=this;this.setting.bind((function(i,d){var a,o,r;o=_(d).difference(i),i=_(i).filter((function(e){var t=s(e);return!!n.Widgets.availableWidgets.findWhere({id_base:t.id_base})})),(a=_(i).map((function(t){var i=n.Widgets.getWidgetFormControlForWidget(t);return i||(i=e.addWidget(t)),i}))).sort((function(e,t){return _.indexOf(i,e.params.widget_id)-_.indexOf(i,t.params.widget_id)})),r=0,_(a).each((function(t){t.priority(r),t.section(e.section()),r+=1})),e.priority(r),e._applyCardinalOrderClassNames(),_(a).each((function(t){t.params.sidebar_id=e.params.sidebar_id})),_(o).each((function(i){setTimeout((function(){var d,a,o,r,l,c=!1;n.each((function(t){if(t.id!==e.setting.id&&0===t.id.indexOf("sidebars_widgets[")&&"sidebars_widgets[wp_inactive_widgets]"!==t.id){var n=t();-1!==_.indexOf(n,i)&&(c=!0)}})),c||(a=(d=n.Widgets.getWidgetFormControlForWidget(i))&&t.contains(document,d.container[0])&&!t.contains(e.$sectionContent[0],d.container[0]),d&&!a&&(n.control.remove(d.id),d.container.remove()),n.Widgets.savedWidgetIds[i]&&((o=n.value("sidebars_widgets[wp_inactive_widgets]")().slice()).push(i),n.value("sidebars_widgets[wp_inactive_widgets]")(_(o).unique())),r=s(i).id_base,(l=n.Widgets.availableWidgets.findWhere({id_base:r}))&&!l.get("is_multi")&&l.set("is_disabled",!1))}))}))}))},_setupSortable:function(){var e=this;this.isReordering=!1,document.querySelectorAll(".customize-control-sidebar_widgets").forEach((function(e){e.classList.add("no-drag")})),Sortable.create(e.$sectionContent[0],{group:"widgets",handle:".customize-control-widget_form",filter:".no-drag, input, select, textarea, label, button, fieldset, legend, datalist, output, option, optgroup",preventOnFilter:!1,setData:function(e,t){var i=document.createElement("details");i.id="sortable-ghost",i.className="widget-top",i.innerHTML='<summary class="widget-title"><h3>'+t.querySelector("h3").textContent+"</h3></summary>",i.style.position="absolute",i.style.top="-1000px",i.style.width=t.getBoundingClientRect().width+"px",document.body.appendChild(i),e.setDragImage(i,30,20)},forceFallback:!!navigator.vendor.match(/apple/i),onStart:function(e){e.item.querySelector("details").hasAttribute("open")&&e.item.querySelector("details").removeAttribute("open")},onMove:function(e){if(e.related.className.includes("no-drag"))return!1},onEnd:function(){var t,i=[];e.$sectionContent[0].querySelectorAll(".customize-control-widget_form").forEach((function(e){i.push(e.id)})),t=i.map((function(e){return document.getElementById(e).querySelector('input[name="widget-id"]').value})),e.setting(t)}}),this.container[0].querySelector(".reorder-toggle").addEventListener("click",(function(){e.toggleReordering(!e.isReordering)}))},_setupAddition:function(){var e=this;this.container.find(".add-new-widget").on("click",(function(){var i=t(this);e.$sectionContent.hasClass("reordering")||(t("body").hasClass("adding-widget")?(i.attr("aria-expanded","false"),n.Widgets.availableWidgetsPanel.close()):(i.attr("aria-expanded","true"),n.Widgets.availableWidgetsPanel.open(e)))}))},_applyCardinalOrderClassNames:function(){var e=[];_.each(this.setting(),(function(t){var i=n.Widgets.getWidgetFormControlForWidget(t);i&&e.push(i)})),0===e.length||1===n.Widgets.registeredSidebars.length&&e.length<=1?this.container.find(".reorder-toggle").hide():(this.container.find(".reorder-toggle").show(),t(e).each((function(){t(this.container).removeClass("first-widget").removeClass("last-widget").find(".move-widget-down, .move-widget-up").prop("tabIndex",0)})),_.first(e).container.addClass("first-widget").find(".move-widget-up").prop("tabIndex",-1),_.last(e).container.addClass("last-widget").find(".move-widget-down").prop("tabIndex",-1))},toggleReordering:function(t){var n=this.$sectionContent.find(".add-new-widget"),s=this.container.find(".reorder-toggle");(t=Boolean(t))!==this.$sectionContent.hasClass("reordering")&&(this.isReordering=t,this.$sectionContent.toggleClass("reordering",t),t?(_(this.getWidgetFormControls()).each((function(e){e.collapse()})),n.attr({tabindex:"-1","aria-hidden":"true"}),s.attr("aria-label",i.reorderLabelOff),e.a11y.speak(i.reorderModeOn)):(n.removeAttr("tabindex aria-hidden"),s.attr("aria-label",i.reorderLabelOn),e.a11y.speak(i.reorderModeOff)))},getWidgetFormControls:function(){var e=[];return _(this.setting()).each((function(t){var i=function(e){var t,i=s(e);t="widget_"+i.id_base,i.number&&(t+="["+i.number+"]");return t}(t),d=n.control(i);d&&e.push(d)})),e},addWidget:function(e){var i,d,a,o,r,l,c,g,u,h=this,p="widget_form",f=s(e),m=f.number,v=f.id_base,w=n.Widgets.availableWidgets.findWhere({id_base:v});return!!w&&(!(m&&!w.get("is_multi"))&&(w.get("is_multi")&&!m&&(w.set("multi_number",w.get("multi_number")+1),m=w.get("multi_number")),i=t("#widget-tpl-"+w.get("id")).html().trim(),w.get("is_multi")?i=i.replace(/<[^<>]+>/g,(function(e){return e.replace(/__i__|%i%/g,m)})):w.set("is_disabled",!0),d=t(i),(a=t("<li/>").addClass("customize-control").addClass("customize-control-"+p).append(d)).find("> .widget-icon").remove(),w.get("is_multi")&&(a.find('input[name="widget_number"]').val(m),a.find('input[name="multi_number"]').val(m)),e=a.find('[name="widget-id"]').val(),a.hide(),r="widget_"+w.get("id_base"),w.get("is_multi")&&(r+="["+m+"]"),a.attr("id","customize-control-"+r.replace(/\]/g,"").replace(/\[/g,"-")),(l=n.has(r))||(u={transport:n.Widgets.data.selectiveRefreshableWidgets[w.get("id_base")]?"postMessage":"refresh",previewer:this.setting.previewer},n.create(r,r,"",u).set({})),o=n.controlConstructor[p],c=new o(r,{settings:{"default":r},content:a,sidebar_id:h.params.sidebar_id,widget_id:e,widget_id_base:w.get("id_base"),type:p,is_new:!l,width:w.get("width"),height:w.get("height"),is_wide:w.get("is_wide")}),n.control.add(c),n.each((function(t){if(t.id!==h.setting.id&&0===t.id.indexOf("sidebars_widgets[")){var i=t().slice(),n=_.indexOf(i,e);-1!==n&&(i.splice(n),t(i))}})),g=this.setting().slice(),-1===_.indexOf(g,e)&&(g.push(e),this.setting(g)),a.slideDown((function(){l&&c.updateWidget({instance:c.setting()})})),c))}}),t.extend(n.panelConstructor,{widgets:n.Widgets.WidgetsPanel}),t.extend(n.sectionConstructor,{sidebar:n.Widgets.SidebarSection}),t.extend(n.controlConstructor,{widget_form:n.Widgets.WidgetControl,sidebar_widgets:n.Widgets.SidebarControl}),n.bind("ready",(function(){n.Widgets.availableWidgetsPanel=new n.Widgets.AvailableWidgetsPanelView({collection:n.Widgets.availableWidgets}),n.previewer.bind("highlight-widget-control",n.Widgets.highlightWidgetFormControl),n.previewer.bind("focus-widget-control",n.Widgets.focusWidgetFormControl)})),n.Widgets.highlightWidgetFormControl=function(e){var t=n.Widgets.getWidgetFormControlForWidget(e);t&&t.highlightSectionAndControl()},n.Widgets.focusWidgetFormControl=function(e){var t=n.Widgets.getWidgetFormControlForWidget(e);t&&t.focus()},n.Widgets.getSidebarWidgetControlContainingWidget=function(e){var t=null;return n.control.each((function(i){"sidebar_widgets"===i.params.type&&-1!==_.indexOf(i.setting(),e)&&(t=i)})),t},n.Widgets.getWidgetFormControlForWidget=function(e){var t=null;return n.control.each((function(i){"widget_form"===i.params.type&&i.params.widget_id===e&&(t=i)})),t},document.addEventListener("widget-added",(function(e){var t,i,d,a,o=e.detail.widget;"nav_menu"===(t=s(o.querySelector(".widget-inside > .form > .widget-id").value)).id_base&&(i=n.control("widget_nav_menu["+String(t.number)+"]"))&&(d=o.querySelector('select[name*="nav_menu"]'),a=o.querySelector(".edit-selected-nav-menu > button"),0!==d.length&&0!==a.length&&(d.addEventListener("change",(function(){n.section.querySelector("nav_menu["+d.value+"]")?a.parentNode.style.display="":a.parentNode.style.display="none"})),a.addEventListener("click",(function(){var e=n.section("nav_menu["+d.value+"]");e&&function(e,t){function i(n){n||(e.expanded.unbind(i),t.focus())}e.focus(),e.expanded.bind(i)}(e,i)}))))}))}function s(e){var t,i={number:null,id_base:null};return(t=e.match(/^(.+)-(\d+)$/))?(i.id_base=t[1],i.number=parseInt(t[2],10)):i.id_base=e,i}}(window.wp,jQuery);