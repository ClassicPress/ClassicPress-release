window.wp||(window.wp={}),wp.themePluginEditor=function(e){"use strict";var t,i,o=wp.i18n.__,s=wp.i18n._n,n=wp.i18n.sprintf;(t={codeEditor:{},instance:null,noticeElements:{},dirty:!1,lintErrors:[]}).init=function(i,s){t.form=i,s&&e.extend(t,s),t.noticeTemplate=wp.template("wp-file-editor-notice"),t.noticesContainer=t.form.find(".editor-notices"),t.submitButton=t.form.find(":input[name=submit]"),t.spinner=t.form.find(".submit .spinner"),t.form.on("submit",t.submit),t.textarea=t.form.find("#newcontent"),t.textarea.on("change",t.onChange),t.warning=e(".file-editor-warning"),t.docsLookUpButton=t.form.find("#docs-lookup"),t.docsLookUpList=t.form.find("#docs-list"),t.warning.length>0&&t.showWarning(),!1!==t.codeEditor&&_.defer((function(){t.initCodeEditor()})),e(t.initFileBrowser),e(window).on("beforeunload",(function(){return t.dirty?o("The changes you made will be lost if you navigate away from this page."):undefined})),t.docsLookUpList.on("change",(function(){""===e(this).val()?t.docsLookUpButton.prop("disabled",!0):t.docsLookUpButton.prop("disabled",!1)}))},t.showWarning=function(){var i=t.warning.find(".file-editor-warning-message").text();e("#wpwrap").attr("aria-hidden","true"),e(document.body).addClass("modal-open").append(t.warning.detach()),t.warning.removeClass("hidden").find(".file-editor-warning-go-back").trigger("focus"),t.warningTabbables=t.warning.find("a, button"),t.warningTabbables.on("keydown",t.constrainTabbing),t.warning.on("click",".file-editor-warning-dismiss",t.dismissWarning),setTimeout((function(){wp.a11y.speak(wp.sanitize.stripTags(i.replace(/\s+/g," ")),"assertive")}),1e3)},t.constrainTabbing=function(e){var i,o;9===e.which&&(i=t.warningTabbables.first()[0],(o=t.warningTabbables.last()[0])!==e.target||e.shiftKey?i===e.target&&e.shiftKey&&(o.focus(),e.preventDefault()):(i.focus(),e.preventDefault()))},t.dismissWarning=function(){wp.ajax.post("dismiss-wp-pointer",{pointer:t.themeOrPlugin+"_editor_notice"}),t.warning.remove(),e("#wpwrap").removeAttr("aria-hidden"),e("body").removeClass("modal-open")},t.onChange=function(){t.dirty=!0,t.removeNotice("file_saved")},t.submit=function(i){var s,n={};i.preventDefault(),e.each(t.form.serializeArray(),(function(){n[this.name]=this.value})),t.instance&&(n.newcontent=t.instance.codemirror.getValue()),t.isSaving||(t.lintErrors.length?t.instance.codemirror.setCursor(t.lintErrors[0].from.line):(t.isSaving=!0,t.textarea.prop("readonly",!0),t.instance&&t.instance.codemirror.setOption("readOnly",!0),t.spinner.addClass("is-active"),s=wp.ajax.post("edit-theme-plugin-file",n),t.lastSaveNoticeCode&&t.removeNotice(t.lastSaveNoticeCode),s.done((function(e){t.lastSaveNoticeCode="file_saved",t.addNotice({code:t.lastSaveNoticeCode,type:"success",message:e.message,dismissible:!0}),t.dirty=!1})),s.fail((function(i){var s=e.extend({code:"save_error",message:o("Something went wrong. Your change may not have been saved. Please try again. There is also a chance that you may need to manually fix and upload the file over FTP.")},i,{type:"error",dismissible:!0});t.lastSaveNoticeCode=s.code,t.addNotice(s)})),s.always((function(){t.spinner.removeClass("is-active"),t.isSaving=!1,t.textarea.prop("readonly",!1),t.instance&&t.instance.codemirror.setOption("readOnly",!1)}))))},t.addNotice=function(i){var o;if(!i.code)throw new Error("Missing code.");return t.removeNotice(i.code),(o=e(t.noticeTemplate(i))).hide(),o.find(".notice-dismiss").on("click",(function(){t.removeNotice(i.code),i.onDismiss&&i.onDismiss(i)})),wp.a11y.speak(i.message),t.noticesContainer.append(o),o.slideDown("fast"),t.noticeElements[i.code]=o,o},t.removeNotice=function(i){return!!t.noticeElements[i]&&(t.noticeElements[i].slideUp("fast",(function(){e(this).remove()})),delete t.noticeElements[i],!0)},t.initCodeEditor=function(){var i,o;(i=e.extend({},t.codeEditor)).onTabPrevious=function(){e("#templateside").find(":tabbable").last().trigger("focus")},i.onTabNext=function(){e("#template").find(":tabbable:not(.CodeMirror-code)").first().trigger("focus")},i.onChangeLintingErrors=function(e){t.lintErrors=e,0===e.length&&t.submitButton.toggleClass("disabled",!1)},i.onUpdateErrorNotice=function(e){t.submitButton.toggleClass("disabled",e.length>0),0!==e.length?t.addNotice({code:"lint_errors",type:"error",message:n(s("There is %s error which must be fixed before you can update this file.","There are %s errors which must be fixed before you can update this file.",e.length),String(e.length)),dismissible:!1}).find("input[type=checkbox]").on("click",(function(){i.onChangeLintingErrors([]),t.removeNotice("lint_errors")})):t.removeNotice("lint_errors")},(o=wp.codeEditor.initialize(e("#newcontent"),i)).codemirror.on("change",t.onChange),e(o.codemirror.display.lineDiv).attr({role:"textbox","aria-multiline":"true","aria-labelledby":"theme-plugin-editor-label","aria-describedby":"editor-keyboard-trap-help-1 editor-keyboard-trap-help-2 editor-keyboard-trap-help-3 editor-keyboard-trap-help-4"}),e("#theme-plugin-editor-label").on("click",(function(){o.codemirror.focus()})),t.instance=o},t.initFileBrowser=function(){var t=e("#templateside");t.find('[role="group"]').parent().attr("aria-expanded",!1),t.find(".notice").parents("[aria-expanded]").attr("aria-expanded",!0),t.find('[role="tree"]').each((function(){new i(this).init()})),t.find(".current-file:first").each((function(){this.scrollIntoViewIfNeeded?this.scrollIntoViewIfNeeded():this.scrollIntoView(!1)}))};
/**
	 * Creates a new TreeitemLink.
	 *
	 * @since 4.9.0
	 * @class
	 * @private
	 * @see {@link https://www.w3.org/TR/wai-aria-practices-1.1/examples/treeview/treeview-2/treeview-2b.html|W3C Treeview Example}
	 * @license W3C-20150513
	 */
var r=function(){var e=function(e,t,i){if("object"==typeof e){e.tabIndex=-1,this.tree=t,this.groupTreeitem=i,this.domNode=e,this.label=e.textContent.trim(),this.stopDefaultClick=!1,e.getAttribute("aria-label")&&(this.label=e.getAttribute("aria-label").trim()),this.isExpandable=!1,this.isVisible=!1,this.inGroup=!1,i&&(this.inGroup=!0);for(var o=e.firstElementChild;o;){if("ul"==o.tagName.toLowerCase()){o.setAttribute("role","group"),this.isExpandable=!0;break}o=o.nextElementSibling}this.keyCode=Object.freeze({RETURN:13,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40})}};return e.prototype.init=function(){this.domNode.tabIndex=-1,this.domNode.getAttribute("role")||this.domNode.setAttribute("role","treeitem"),this.domNode.addEventListener("keydown",this.handleKeydown.bind(this)),this.domNode.addEventListener("click",this.handleClick.bind(this)),this.domNode.addEventListener("focus",this.handleFocus.bind(this)),this.domNode.addEventListener("blur",this.handleBlur.bind(this)),this.isExpandable?(this.domNode.firstElementChild.addEventListener("mouseover",this.handleMouseOver.bind(this)),this.domNode.firstElementChild.addEventListener("mouseout",this.handleMouseOut.bind(this))):(this.domNode.addEventListener("mouseover",this.handleMouseOver.bind(this)),this.domNode.addEventListener("mouseout",this.handleMouseOut.bind(this)))},e.prototype.isExpanded=function(){return!!this.isExpandable&&"true"===this.domNode.getAttribute("aria-expanded")},e.prototype.handleKeydown=function(e){e.currentTarget;var t=!1,i=e.key;function o(e){return 1===e.length&&e.match(/\S/)}function s(e){"*"==i?(e.tree.expandAllSiblingItems(e),t=!0):o(i)&&(e.tree.setFocusByFirstCharacter(e,i),t=!0)}if(this.stopDefaultClick=!1,!(e.altKey||e.ctrlKey||e.metaKey)){if(e.shift)e.keyCode==this.keyCode.SPACE||e.keyCode==this.keyCode.RETURN?(e.stopPropagation(),this.stopDefaultClick=!0):o(i)&&s(this);else switch(e.keyCode){case this.keyCode.SPACE:case this.keyCode.RETURN:this.isExpandable?(this.isExpanded()?this.tree.collapseTreeitem(this):this.tree.expandTreeitem(this),t=!0):(e.stopPropagation(),this.stopDefaultClick=!0);break;case this.keyCode.UP:this.tree.setFocusToPreviousItem(this),t=!0;break;case this.keyCode.DOWN:this.tree.setFocusToNextItem(this),t=!0;break;case this.keyCode.RIGHT:this.isExpandable&&(this.isExpanded()?this.tree.setFocusToNextItem(this):this.tree.expandTreeitem(this)),t=!0;break;case this.keyCode.LEFT:this.isExpandable&&this.isExpanded()?(this.tree.collapseTreeitem(this),t=!0):this.inGroup&&(this.tree.setFocusToParentItem(this),t=!0);break;case this.keyCode.HOME:this.tree.setFocusToFirstItem(),t=!0;break;case this.keyCode.END:this.tree.setFocusToLastItem(),t=!0;break;default:o(i)&&s(this)}t&&(e.stopPropagation(),e.preventDefault())}},e.prototype.handleClick=function(e){e.target!==this.domNode&&e.target!==this.domNode.firstElementChild||this.isExpandable&&(this.isExpanded()?this.tree.collapseTreeitem(this):this.tree.expandTreeitem(this),e.stopPropagation())},e.prototype.handleFocus=function(e){var t=this.domNode;this.isExpandable&&(t=t.firstElementChild),t.classList.add("focus")},e.prototype.handleBlur=function(e){var t=this.domNode;this.isExpandable&&(t=t.firstElementChild),t.classList.remove("focus")},e.prototype.handleMouseOver=function(e){e.currentTarget.classList.add("hover")},e.prototype.handleMouseOut=function(e){e.currentTarget.classList.remove("hover")},e}();
/**
	 * Creates a new TreeLinks.
	 *
	 * @since 4.9.0
	 * @class
	 * @private
	 * @see {@link https://www.w3.org/TR/wai-aria-practices-1.1/examples/treeview/treeview-2/treeview-2b.html|W3C Treeview Example}
	 * @license W3C-20150513
	 */return i=function(){var e=function(e){"object"==typeof e&&(this.domNode=e,this.treeitems=[],this.firstChars=[],this.firstTreeitem=null,this.lastTreeitem=null)};return e.prototype.init=function(){this.domNode.getAttribute("role")||this.domNode.setAttribute("role","tree"),function e(t,i,o){for(var s=t.firstElementChild,n=o;s;)("li"===s.tagName.toLowerCase()&&"span"===s.firstElementChild.tagName.toLowerCase()||"a"===s.tagName.toLowerCase())&&((n=new r(s,i,o)).init(),i.treeitems.push(n),i.firstChars.push(n.label.substring(0,1).toLowerCase())),s.firstElementChild&&e(s,i,n),s=s.nextElementSibling}(this.domNode,this,!1),this.updateVisibleTreeitems(),this.firstTreeitem.domNode.tabIndex=0},e.prototype.setFocusToItem=function(e){for(var t=0;t<this.treeitems.length;t++){var i=this.treeitems[t];i===e?(i.domNode.tabIndex=0,i.domNode.focus()):i.domNode.tabIndex=-1}},e.prototype.setFocusToNextItem=function(e){for(var t=!1,i=this.treeitems.length-1;i>=0;i--){var o=this.treeitems[i];if(o===e)break;o.isVisible&&(t=o)}t&&this.setFocusToItem(t)},e.prototype.setFocusToPreviousItem=function(e){for(var t=!1,i=0;i<this.treeitems.length;i++){var o=this.treeitems[i];if(o===e)break;o.isVisible&&(t=o)}t&&this.setFocusToItem(t)},e.prototype.setFocusToParentItem=function(e){e.groupTreeitem&&this.setFocusToItem(e.groupTreeitem)},e.prototype.setFocusToFirstItem=function(){this.setFocusToItem(this.firstTreeitem)},e.prototype.setFocusToLastItem=function(){this.setFocusToItem(this.lastTreeitem)},e.prototype.expandTreeitem=function(e){e.isExpandable&&(e.domNode.setAttribute("aria-expanded",!0),this.updateVisibleTreeitems())},e.prototype.expandAllSiblingItems=function(e){for(var t=0;t<this.treeitems.length;t++){var i=this.treeitems[t];i.groupTreeitem===e.groupTreeitem&&i.isExpandable&&this.expandTreeitem(i)}},e.prototype.collapseTreeitem=function(e){var t=!1;(t=e.isExpanded()?e:e.groupTreeitem)&&(t.domNode.setAttribute("aria-expanded",!1),this.updateVisibleTreeitems(),this.setFocusToItem(t))},e.prototype.updateVisibleTreeitems=function(){this.firstTreeitem=this.treeitems[0];for(var e=0;e<this.treeitems.length;e++){var t=this.treeitems[e],i=t.domNode.parentNode;for(t.isVisible=!0;i&&i!==this.domNode;)"false"==i.getAttribute("aria-expanded")&&(t.isVisible=!1),i=i.parentNode;t.isVisible&&(this.lastTreeitem=t)}},e.prototype.setFocusByFirstCharacter=function(e,t){var i,o;t=t.toLowerCase(),(i=this.treeitems.indexOf(e)+1)===this.treeitems.length&&(i=0),-1===(o=this.getIndexFirstChars(i,t))&&(o=this.getIndexFirstChars(0,t)),o>-1&&this.setFocusToItem(this.treeitems[o])},e.prototype.getIndexFirstChars=function(e,t){for(var i=e;i<this.firstChars.length;i++)if(this.treeitems[i].isVisible&&t===this.firstChars[i])return i;return-1},e}(),t}(jQuery),wp.themePluginEditor.l10n=wp.themePluginEditor.l10n||{saveAlert:"",saveError:"",lintError:{alternative:"wp.i18n",func:function(){return{singular:"",plural:""}}}},wp.themePluginEditor.l10n=window.wp.deprecateL10nObject("wp.themePluginEditor.l10n",wp.themePluginEditor.l10n,"5.5.0");