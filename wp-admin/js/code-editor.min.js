"undefined"==typeof window.wp&&(window.wp={}),"undefined"==typeof window.wp.codeEditor&&(window.wp.codeEditor={}),function(t,n){"use strict";n.codeEditor.defaultSettings={codemirror:{},csslint:{},htmlhint:{},jshint:{},onTabNext:function(){},onTabPrevious:function(){},onChangeLintingErrors:function(){},onUpdateErrorNotice:function(){}},n.codeEditor.initialize=function(e,o){var i,r,s,a;return i=t("string"==typeof e?"#"+e:e),(s=t.extend({},n.codeEditor.defaultSettings,o)).codemirror=t.extend({},s.codemirror),function(n,e){var o=[],i=[];function r(){e.onUpdateErrorNotice&&!_.isEqual(o,i)&&(e.onUpdateErrorNotice(o,n),i=o)}function s(){var s,a=n.getOption("lint");return!!a&&(!0===a?a={}:_.isObject(a)&&(a=t.extend({},a)),a.options||(a.options={}),"javascript"===e.codemirror.mode&&e.jshint&&t.extend(a.options,e.jshint),"css"===e.codemirror.mode&&e.csslint&&t.extend(a.options,e.csslint),"htmlmixed"===e.codemirror.mode&&e.htmlhint&&(a.options.rules=t.extend({},e.htmlhint),e.jshint&&(a.options.rules.jshint=e.jshint),e.csslint&&(a.options.rules.csslint=e.csslint)),a.onUpdateLinting=(s=a.onUpdateLinting,function(t,a,d){var c=_.filter(t,(function(t){return"error"===t.severity}));s&&s.apply(t,a,d),_.isEqual(c,o)||(o=c,e.onChangeLintingErrors&&e.onChangeLintingErrors(c,t,a,d),(!n.state.focused||0===o.length||i.length>0)&&r())}),a)}n.setOption("lint",s()),n.on("optionChange",(function(t,e){var i,a,d="CodeMirror-lint-markers";"lint"===e&&(a=n.getOption("gutters")||[],!0===(i=n.getOption("lint"))?(_.contains(a,d)||n.setOption("gutters",[d].concat(a)),n.setOption("lint",s())):i||n.setOption("gutters",_.without(a,d)),n.getOption("lint")?n.performLint():(o=[],r()))})),n.on("blur",r),n.on("startCompletion",(function(){n.off("blur",r)})),n.on("endCompletion",(function(){n.on("blur",r),_.delay((function(){n.state.focused||r()}),500)})),t(document.body).on("mousedown",(function(e){!n.state.focused||t.contains(n.display.wrapper,e.target)||t(e.target).hasClass("CodeMirror-hint")||r()}))}(r=n.CodeMirror.fromTextArea(i[0],s.codemirror),s),a={settings:s,codemirror:r},r.showHint&&r.on("keyup",(function(t,e){var o,i,s,a,d=/^[a-zA-Z]$/.test(e.key);r.state.completionActive&&d||"string"!==(a=r.getTokenAt(r.getCursor())).type&&"comment"!==a.type&&(s=n.CodeMirror.innerMode(r.getMode(),a.state).mode.name,i=r.doc.getLine(r.doc.getCursor().line).substr(0,r.doc.getCursor().ch),"html"===s||"xml"===s?o="<"===e.key||"/"===e.key&&"tag"===a.type||d&&"tag"===a.type||d&&"attribute"===a.type||"="===a.string&&a.state.htmlState&&a.state.htmlState.tagName:"css"===s?o=d||":"===e.key||" "===e.key&&/:\s+$/.test(i):"javascript"===s?o=d||"."===e.key:"clike"===s&&"application/x-httpd-php"===r.options.mode&&(o="keyword"===a.type||"variable"===a.type),o&&r.showHint({completeSingle:!1}))})),function(n,e){var o=t(n.getTextArea());n.on("blur",(function(){o.data("next-tab-blurs",!1)})),n.on("keydown",(function(t,i){27!==i.keyCode?9===i.keyCode&&o.data("next-tab-blurs")&&(i.shiftKey?e.onTabPrevious(n,i):e.onTabNext(n,i),o.data("next-tab-blurs",!1),i.preventDefault()):o.data("next-tab-blurs",!0)}))}(r,o),a}}(window.jQuery,window.wp);