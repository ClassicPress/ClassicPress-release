"undefined"==typeof window.wp&&(window.wp={}),"undefined"==typeof window.wp.codeEditor&&(window.wp.codeEditor={}),function(t,e){"use strict";e.codeEditor.defaultSettings={codemirror:{},csslint:{},htmlhint:{},jshint:{},onTabNext:function(){},onTabPrevious:function(){},onChangeLintingErrors:function(){},onUpdateErrorNotice:function(){}},e.codeEditor.initialize=function(n,o){var i,r,s,a;return i=t("string"==typeof n?"#"+n:n),(s=t.extend({},e.codeEditor.defaultSettings,o)).codemirror=t.extend({},s.codemirror),function(e,n){var o=[],i=[];function r(){n.onUpdateErrorNotice&&!_.isEqual(o,i)&&(n.onUpdateErrorNotice(o,e),i=o)}function s(){var s,a=e.getOption("lint");return!!a&&(!0===a?a={}:_.isObject(a)&&(a=t.extend({},a)),a.options||(a.options={}),"javascript"===n.codemirror.mode&&n.jshint&&t.extend(a.options,n.jshint),"css"===n.codemirror.mode&&n.csslint&&t.extend(a.options,n.csslint),"htmlmixed"===n.codemirror.mode&&n.htmlhint&&(a.options.rules=t.extend({},n.htmlhint),n.jshint&&(a.options.rules.jshint=n.jshint),n.csslint&&(a.options.rules.csslint=n.csslint)),a.onUpdateLinting=(s=a.onUpdateLinting,function(t,a,d){var c=_.filter(t,(function(t){return"error"===t.severity}));s&&s.apply(t,a,d),_.isEqual(c,o)||(o=c,n.onChangeLintingErrors&&n.onChangeLintingErrors(c,t,a,d),(!e.state.focused||0===o.length||i.length>0)&&r())}),a)}e.setOption("lint",s()),e.on("optionChange",(function(t,n){var i,a,d="CodeMirror-lint-markers";"lint"===n&&(a=e.getOption("gutters")||[],!0===(i=e.getOption("lint"))?(_.contains(a,d)||e.setOption("gutters",[d].concat(a)),e.setOption("lint",s())):i||e.setOption("gutters",_.without(a,d)),e.getOption("lint")?e.performLint():(o=[],r()))})),e.on("blur",r),e.on("startCompletion",(function(){e.off("blur",r)})),e.on("endCompletion",(function(){e.on("blur",r),_.delay((function(){e.state.focused||r()}),500)})),t(document.body).on("mousedown",(function(n){!e.state.focused||t.contains(e.display.wrapper,n.target)||t(n.target).hasClass("CodeMirror-hint")||r()}))}(r=e.CodeMirror.fromTextArea(i[0],s.codemirror),s),a={settings:s,codemirror:r},r.showHint&&r.on("keyup",(function(t,n){var o,i,s,a,d=/^[a-zA-Z]$/.test(n.key);r.state.completionActive&&d||"string"!==(a=r.getTokenAt(r.getCursor())).type&&"comment"!==a.type&&(s=e.CodeMirror.innerMode(r.getMode(),a.state).mode.name,i=r.doc.getLine(r.doc.getCursor().line).substr(0,r.doc.getCursor().ch),"html"===s||"xml"===s?o="<"===n.key||"/"===n.key&&"tag"===a.type||d&&"tag"===a.type||d&&"attribute"===a.type||"="===a.string&&a.state.htmlState&&a.state.htmlState.tagName:"css"===s?o=d||":"===n.key||" "===n.key&&/:\s+$/.test(i):"javascript"===s?o=d||"."===n.key:"clike"===s&&"php"===r.options.mode&&(o="keyword"===a.type||"variable"===a.type),o&&r.showHint({completeSingle:!1}))})),function(e,n){var o=t(e.getTextArea());e.on("blur",(function(){o.data("next-tab-blurs",!1)})),e.on("keydown",(function(t,i){27!==i.keyCode?9===i.keyCode&&o.data("next-tab-blurs")&&(i.shiftKey?n.onTabPrevious(e,i):n.onTabNext(e,i),o.data("next-tab-blurs",!1),i.preventDefault()):o.data("next-tab-blurs",!0)}))}(r,o),a}}(window.jQuery,window.wp);