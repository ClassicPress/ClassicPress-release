!function(e,t){"use strict";var i,a;i=e.MediaWidgetModel.extend({}),a=e.MediaWidgetControl.extend({events:_.extend({},e.MediaWidgetControl.prototype.events,{"click .media-widget-preview.populated":"editMedia"}),renderPreview:function(){var e,t,i,a,o=this;(o.model.get("attachment_id")||o.model.get("url"))&&(e=o.$el.find(".media-widget-preview"),t=wp.template("wp-media-widget-image-preview"),e.html(t(o.previewTemplateProps.toJSON())),e.addClass("populated"),o.$el.find(".link").is(document.activeElement)||(i=o.$el.find(".media-widget-fields"),a=wp.template("wp-media-widget-image-fields"),i.html(a(o.previewTemplateProps.toJSON()))))},editMedia:function(){var e,i,a,o,d=this;"none"===(o=d.mapModelToMediaFrameProps(d.model.toJSON())).link&&(o.linkUrl=""),(e=wp.media({frame:"image",state:"image-details",metadata:o})).$el.addClass("media-widget"),i=function(){var t,i;i=(t=e.state().attributes.image.toJSON()).link,t.link=t.linkUrl,d.selectedAttachment.set(t),d.displaySettings.set("link",i),d.model.set(_.extend(d.mapMediaToModelProps(t),{error:!1}))},e.state("image-details").on("update",i),e.state("replace-image").on("replace",i),a=wp.media.model.Attachment.prototype.sync,wp.media.model.Attachment.prototype.sync=function(){return t.Deferred().rejectWith(this).promise()},e.on("close",(function(){e.detach(),wp.media.model.Attachment.prototype.sync=a})),e.open()},getEmbedResetProps:function(){return _.extend(e.MediaWidgetControl.prototype.getEmbedResetProps.call(this),{size:"full",width:0,height:0})},getModelPropsFromMediaFrame:function(t){return _.omit(e.MediaWidgetControl.prototype.getModelPropsFromMediaFrame.call(this,t),"image_title")},mapModelToPreviewTemplateProps:function(){var t,i,a=this;return i=a.model.get("url"),(t=e.MediaWidgetControl.prototype.mapModelToPreviewTemplateProps.call(a)).currentFilename=i?i.replace(/\?.*$/,"").replace(/^.+\//,""):"",t.link_url=a.model.get("link_url"),t}}),e.controlConstructors.media_image=a,e.modelConstructors.media_image=i}(wp.mediaWidgets,jQuery);