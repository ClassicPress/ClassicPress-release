!function(e){var o=e(document),s=wp.i18n.__;window.postboxes={handle_click:function(){var s,t=e(this),a=t.closest(".postbox"),r=a.attr("id");"dashboard_browser_nag"!==r&&(a.toggleClass("closed"),s=!a.hasClass("closed"),t.hasClass("handlediv")?t.attr("aria-expanded",s):t.closest(".postbox").find("button.handlediv").attr("aria-expanded",s),"press-this"!==postboxes.page&&postboxes.save_state(postboxes.page),r&&(a.hasClass("closed")||"function"!=typeof postboxes.pbshow?a.hasClass("closed")&&"function"==typeof postboxes.pbhide&&postboxes.pbhide(r):postboxes.pbshow(r)),o.trigger("postbox-toggled",a))},handleOrder:function(){var o,t=e(this),a=t.closest(".postbox"),r=a.attr("id"),i=a.closest(".meta-box-sortables").find(".postbox:visible"),n=i.length,d=i.index(a);if("dashboard_browser_nag"!==r){if("true"===t.attr("aria-disabled"))return o=t.hasClass("handle-order-higher")?s("The box is on the first position"):s("The box is on the last position"),void wp.a11y.speak(o);if(t.hasClass("handle-order-higher")){if(0===d)return void postboxes.handleOrderBetweenSortables("previous",t,a);a.prevAll(".postbox:visible").eq(0).before(a),t.trigger("focus"),postboxes.updateOrderButtonsProperties(),postboxes.save_order(postboxes.page)}if(t.hasClass("handle-order-lower")){if(d+1===n)return void postboxes.handleOrderBetweenSortables("next",t,a);a.nextAll(".postbox:visible").eq(0).after(a),t.trigger("focus"),postboxes.updateOrderButtonsProperties(),postboxes.save_order(postboxes.page)}}},handleOrderBetweenSortables:function(o,s,t){var a,r,i=s.closest(".meta-box-sortables").attr("id"),n=[];e(".meta-box-sortables:visible").each((function(){n.push(e(this).attr("id"))})),1!==n.length&&(a=e.inArray(i,n),r=t.detach(),"previous"===o&&e(r).appendTo("#"+n[a-1]),"next"===o&&e(r).prependTo("#"+n[a+1]),postboxes._mark_area(),s.focus(),postboxes.updateOrderButtonsProperties(),postboxes.save_order(postboxes.page))},updateOrderButtonsProperties:function(){var o=e(".meta-box-sortables:visible:first").attr("id"),s=e(".meta-box-sortables:visible:last").attr("id"),t=e(".postbox:visible:first"),a=e(".postbox:visible:last"),r=t.attr("id"),i=a.attr("id"),n=t.closest(".meta-box-sortables").attr("id"),d=a.closest(".meta-box-sortables").attr("id"),b=e(".handle-order-higher"),l=e(".handle-order-lower");b.attr("aria-disabled","false").removeClass("hidden"),l.attr("aria-disabled","false").removeClass("hidden"),o===s&&r===i&&(b.addClass("hidden"),l.addClass("hidden")),o===n&&e(t).find(".handle-order-higher").attr("aria-disabled","true"),s===d&&e(".postbox:visible .handle-order-lower").last().attr("aria-disabled","true")},add_postbox_toggles:function(s,t){var a=e(".postbox .hndle, .postbox .handlediv"),r=e(".postbox .handle-order-higher, .postbox .handle-order-lower");this.page=s,this.init(s,t),a.on("click.postboxes",this.handle_click),r.on("click.postboxes",this.handleOrder),e(".postbox .hndle a").on("click",(function(e){e.stopPropagation()})),e(".postbox a.dismiss").on("click.postboxes",(function(o){var s=e(this).parents(".postbox").attr("id")+"-hide";o.preventDefault(),e("#"+s).prop("checked",!1).triggerHandler("click")})),e(".hide-postbox-tog").on("click.postboxes",(function(){var t=e(this),a=t.val(),r=e("#"+a);t.prop("checked")?(r.show(),"function"==typeof postboxes.pbshow&&postboxes.pbshow(a)):(r.hide(),"function"==typeof postboxes.pbhide&&postboxes.pbhide(a)),postboxes.save_state(s),postboxes._mark_area(),o.trigger("postbox-toggled",r)})),e('.columns-prefs input[type="radio"]').on("click.postboxes",(function(){var o=parseInt(e(this).val(),10);o&&(postboxes._pb_edit(o),postboxes.save_order(s))}))},init:function(s,t){var a=e(document.body).hasClass("mobile"),r=e(".postbox .handlediv");e.extend(this,t||{}),e(".meta-box-sortables").sortable({placeholder:"sortable-placeholder",connectWith:".meta-box-sortables",items:".postbox",handle:".hndle",cursor:"move",delay:a?200:0,distance:2,tolerance:"pointer",forcePlaceholderSize:!0,helper:function(e,o){return o.clone().find(":input").attr("name",(function(e,o){return"sort_"+parseInt(1e5*Math.random(),10).toString()+"_"+o})).end()},opacity:.65,start:function(){e("body").addClass("is-dragging-metaboxes"),e(".meta-box-sortables").sortable("refreshPositions")},stop:function(){var o=e(this);e("body").removeClass("is-dragging-metaboxes"),o.find("#dashboard_browser_nag").is(":visible")&&"dashboard_browser_nag"!=this.firstChild.id?o.sortable("cancel"):(postboxes.updateOrderButtonsProperties(),postboxes.save_order(s))},receive:function(s,t){"dashboard_browser_nag"==t.item[0].id&&e(t.sender).sortable("cancel"),postboxes._mark_area(),o.trigger("postbox-moved",t.item)}}),a&&(e(document.body).on("orientationchange.postboxes",(function(){postboxes._pb_change()})),this._pb_change()),this._mark_area(),this.updateOrderButtonsProperties(),o.on("postbox-toggled",this.updateOrderButtonsProperties),r.each((function(){var o=e(this);o.attr("aria-expanded",!o.closest(".postbox").hasClass("closed"))}))},save_state:function(o){var s,t;"nav-menus"!==o&&setTimeout((function(){s=e(".postbox").filter(":not([open])").map((function(){return this.id})).get().join(","),t=e(".postbox").filter(":hidden").map((function(){return this.id})).get().join(","),e.post(ajaxurl,{action:"closed-postboxes",closed:s,hidden:t,closedpostboxesnonce:jQuery("#closedpostboxesnonce").val(),page:o})}),0)},save_order:function(o){var t,a=e(".columns-prefs input:checked").val()||0;t={action:"meta-box-order",_ajax_nonce:e("#meta-box-order-nonce").val(),page_columns:a,page:o},e(".meta-box-sortables").each((function(){t["order["+this.id.split("-")[0]+"]"]=e(this).sortable("toArray").join(",")})),e.post(ajaxurl,t,(function(e){e.success&&wp.a11y.speak(s("The boxes order has been saved."))}))},_mark_area:function(){var o=e("div.postbox:visible").length,s=e("#dashboard-widgets .meta-box-sortables:visible, #post-body .meta-box-sortables:visible"),t=!0;s.each((function(){var s=e(this);1==o||s.children(".postbox:visible").length?(s.removeClass("empty-container"),t=!1):s.addClass("empty-container")})),postboxes.updateEmptySortablesText(s,t)},updateEmptySortablesText:function(o,t){var a=e("#dashboard-widgets").length,r=s(t?"Add boxes from the Screen Options menu":"Drag boxes here");a&&o.each((function(){e(this).hasClass("empty-container")&&e(this).attr("data-emptyString",r)}))},_pb_edit:function(o){var s=e(".metabox-holder").get(0);s&&(s.className=s.className.replace(/columns-\d+/,"columns-"+o)),e(document).trigger("postboxes-columnchange")},_pb_change:function(){var o=e('label.columns-prefs-1 input[type="radio"]');switch(window.orientation){case 90:case-90:o.length&&o.is(":checked")||this._pb_edit(2);break;case 0:case 180:e("#poststuff").length?this._pb_edit(1):o.length&&o.is(":checked")||this._pb_edit(2)}},pbshow:!1,pbhide:!1}}(jQuery);