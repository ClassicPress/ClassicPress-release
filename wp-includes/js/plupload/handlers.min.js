var uploader,uploader_init,topWin=window.dialogArguments||opener||parent||top;function fileQueued(e){jQuery(".media-blank").remove();var r=jQuery("#media-items").children(),a=post_id||0;1==r.length&&r.removeClass("open").find(".slidetoggle").slideUp(200),jQuery('<div class="media-item">').attr("id","media-item-"+e.id).addClass("child-of-"+a).append('<div class="progress"><div class="percent">0%</div><div class="bar"></div></div>',jQuery('<div class="filename original">').text(" "+e.name)).appendTo(jQuery("#media-items")),jQuery("#insert-gallery").prop("disabled",!0)}function uploadStart(){try{"undefined"!=typeof topWin.tb_remove&&topWin.jQuery("#TB_overlay").unbind("click",topWin.tb_remove)}catch(e){}return!0}function uploadProgress(e,r){var a=jQuery("#media-item-"+r.id);jQuery(".bar",a).width(200*r.loaded/r.size),jQuery(".percent",a).html(r.percent+"%")}function fileUploading(e,r){var a=104857600;parseInt(e.settings.max_file_size,10)>a&&r.size>a&&setTimeout((function(){r.status<3&&0===r.loaded&&(wpFileError(r,pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>")),e.stop(),e.removeFile(r),e.start())}),1e4)}function updateMediaForm(){var e=jQuery("#media-items").children();1==e.length?(e.addClass("open").find(".slidetoggle").show(),jQuery(".insert-gallery").hide()):e.length>1&&(e.removeClass("open"),jQuery(".insert-gallery").show()),e.not(".media-blank").length>0?jQuery(".savebutton").show():jQuery(".savebutton").hide()}function uploadSuccess(e,r){var a=jQuery("#media-item-"+e.id);(r=r.replace(/^<pre>(\d+)<\/pre>$/,"$1")).match(/media-upload-error|error-div/)?a.html(r):(jQuery(".percent",a).html(pluploadL10n.crunching),prepareMediaItem(e,r),updateMediaForm(),post_id&&a.hasClass("child-of-"+post_id)&&jQuery("#attachments-count").text(1*jQuery("#attachments-count").text()+1))}function setResize(e){e?window.resize_width&&window.resize_height?uploader.settings.resize={enabled:!0,width:window.resize_width,height:window.resize_height,quality:100}:uploader.settings.multipart_params.image_resize=!0:delete uploader.settings.multipart_params.image_resize}function prepareMediaItem(e,r){var a="undefined"==typeof shortform?1:2,i=jQuery("#media-item-"+e.id);2==a&&shortform>2&&(a=shortform);try{"undefined"!=typeof topWin.tb_remove&&topWin.jQuery("#TB_overlay").click(topWin.tb_remove)}catch(t){}isNaN(r)||!r?(i.append(r),prepareMediaItemInit(e)):i.load("async-upload.php",{attachment_id:r,fetch:a},(function(){prepareMediaItemInit(e),updateMediaForm()}))}function prepareMediaItemInit(e){var r=jQuery("#media-item-"+e.id);jQuery(".thumbnail",r).clone().attr("class","pinkynail toggle").prependTo(r),jQuery(".filename.original",r).replaceWith(jQuery(".filename.new",r)),jQuery("a.delete",r).click((function(){return jQuery.ajax({url:ajaxurl,type:"post",success:deleteSuccess,error:deleteError,id:e.id,data:{id:this.id.replace(/[^0-9]/g,""),action:"trash-post",_ajax_nonce:this.href.replace(/^.*wpnonce=/,"")}}),!1})),jQuery("a.undo",r).click((function(){return jQuery.ajax({url:ajaxurl,type:"post",id:e.id,data:{id:this.id.replace(/[^0-9]/g,""),action:"untrash-post",_ajax_nonce:this.href.replace(/^.*wpnonce=/,"")},success:function(){var r,a=jQuery("#media-item-"+e.id);(r=jQuery("#type-of-"+e.id).val())&&jQuery("#"+r+"-counter").text(jQuery("#"+r+"-counter").text()-0+1),post_id&&a.hasClass("child-of-"+post_id)&&jQuery("#attachments-count").text(jQuery("#attachments-count").text()-0+1),jQuery(".filename .trashnotice",a).remove(),jQuery(".filename .title",a).css("font-weight","normal"),jQuery("a.undo",a).addClass("hidden"),jQuery(".menu_order_input",a).show(),a.css({backgroundColor:"#ceb"}).animate({backgroundColor:"#fff"},{queue:!1,duration:500,complete:function(){jQuery(this).css({backgroundColor:""})}}).removeClass("undo")}}),!1})),jQuery("#media-item-"+e.id+".startopen").removeClass("startopen").addClass("open").find("slidetoggle").fadeIn()}function wpQueueError(e){jQuery("#media-upload-error").show().html('<div class="error"><p>'+e+"</p></div>")}function wpFileError(e,r){itemAjaxError(e.id,r)}function itemAjaxError(e,r){var a=jQuery("#media-item-"+e),i=a.find(".filename").text();a.data("last-err")!=e&&a.html('<div class="error-div"><a class="dismiss" href="#">'+pluploadL10n.dismiss+"</a><strong>"+pluploadL10n.error_uploading.replace("%s",jQuery.trim(i))+"</strong> "+r+"</div>").data("last-err",e)}function deleteSuccess(e){var r,a,i;return"-1"==e?itemAjaxError(this.id,"You do not have permission. Has your session expired?"):"0"==e?itemAjaxError(this.id,"Could not be deleted. Has it been deleted already?"):(a=this.id,i=jQuery("#media-item-"+a),(r=jQuery("#type-of-"+a).val())&&jQuery("#"+r+"-counter").text(jQuery("#"+r+"-counter").text()-1),post_id&&i.hasClass("child-of-"+post_id)&&jQuery("#attachments-count").text(jQuery("#attachments-count").text()-1),1==jQuery("form.type-form #media-items").children().length&&jQuery(".hidden","#media-items").length>0&&(jQuery(".toggle").toggle(),jQuery(".slidetoggle").slideUp(200).siblings().removeClass("hidden")),jQuery(".toggle",i).toggle(),jQuery(".slidetoggle",i).slideUp(200).siblings().removeClass("hidden"),i.css({backgroundColor:"#faa"}).animate({backgroundColor:"#f4f4f4"},{queue:!1,duration:500}).addClass("undo"),jQuery(".filename:empty",i).remove(),jQuery(".filename .title",i).css("font-weight","bold"),jQuery(".filename",i).append('<span class="trashnotice"> '+pluploadL10n.deleted+" </span>").siblings("a.toggle").hide(),jQuery(".filename",i).append(jQuery("a.undo",i).removeClass("hidden")),void jQuery(".menu_order_input",i).hide())}function deleteError(){}function uploadComplete(){jQuery("#insert-gallery").prop("disabled",!1)}function switchUploader(e){e?(deleteUserSetting("uploader"),jQuery(".media-upload-form").removeClass("html-uploader"),"object"==typeof uploader&&uploader.refresh()):(setUserSetting("uploader","1"),jQuery(".media-upload-form").addClass("html-uploader"))}function uploadError(e,r,a,i){var t=104857600;switch(r){case plupload.FAILED:wpFileError(e,pluploadL10n.upload_failed);break;case plupload.FILE_EXTENSION_ERROR:wpFileExtensionError(i,e,pluploadL10n.invalid_filetype);break;case plupload.FILE_SIZE_ERROR:uploadSizeError(i,e);break;case plupload.IMAGE_FORMAT_ERROR:wpFileError(e,pluploadL10n.not_an_image);break;case plupload.IMAGE_MEMORY_ERROR:wpFileError(e,pluploadL10n.image_memory_exceeded);break;case plupload.IMAGE_DIMENSIONS_ERROR:wpFileError(e,pluploadL10n.image_dimensions_exceeded);break;case plupload.GENERIC_ERROR:wpQueueError(pluploadL10n.upload_failed);break;case plupload.IO_ERROR:parseInt(i.settings.filters.max_file_size,10)>t&&e.size>t?wpFileError(e,pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>")):wpQueueError(pluploadL10n.io_error);break;case plupload.HTTP_ERROR:wpQueueError(pluploadL10n.http_error);break;case plupload.INIT_ERROR:jQuery(".media-upload-form").addClass("html-uploader");break;case plupload.SECURITY_ERROR:wpQueueError(pluploadL10n.security_error);break;default:wpFileError(e,pluploadL10n.default_error)}}function uploadSizeError(e,r){var a,i;a=pluploadL10n.file_exceeds_size_limit.replace("%s",r.name),i=jQuery("<div />").attr({id:"media-item-"+r.id,"class":"media-item error"}).append(jQuery("<p />").text(a)),jQuery("#media-items").append(i),e.removeFile(r)}function wpFileExtensionError(e,r,a){jQuery("#media-items").append('<div id="media-item-'+r.id+'" class="media-item error"><p>'+a+"</p></div>"),e.removeFile(r)}jQuery(document).ready((function(e){e(".media-upload-form").bind("click.uploader",(function(r){var a,i,t=e(r.target);t.is('input[type="radio"]')?(a=t.closest("tr")).hasClass("align")?setUserSetting("align",t.val()):a.hasClass("image-size")&&setUserSetting("imgsize",t.val()):t.is("button.button")?(i=(i=r.target.className||"").match(/url([^ '"]+)/))&&i[1]&&(setUserSetting("urlbutton",i[1]),t.siblings(".urlfield").val(t.data("link-url"))):t.is("a.dismiss")?t.parents(".media-item").fadeOut(200,(function(){e(this).remove()})):t.is(".upload-flash-bypass a")||t.is("a.uploader-html")?(e("#media-items, p.submit, span.big-file-warning").css("display","none"),switchUploader(0),r.preventDefault()):t.is(".upload-html-bypass a")?(e("#media-items, p.submit, span.big-file-warning").css("display",""),switchUploader(1),r.preventDefault()):t.is("a.describe-toggle-on")?(t.parent().addClass("open"),t.siblings(".slidetoggle").fadeIn(250,(function(){var r,a,i=e(window).scrollTop(),t=e(window).height(),o=e(this).offset().top,d=e(this).height();t&&o&&d&&(r=o+d)>(a=i+t)&&(r-a<o-i?window.scrollBy(0,r-a+10):window.scrollBy(0,o-i-40))})),r.preventDefault()):t.is("a.describe-toggle-off")&&(t.siblings(".slidetoggle").fadeOut(250,(function(){t.parent().removeClass("open")})),r.preventDefault())})),uploader_init=function(){-1!=navigator.userAgent.indexOf("Trident/")||-1!=navigator.userAgent.indexOf("MSIE ")||"flash"!==plupload.predictRuntime(wpUploaderInit)||wpUploaderInit.required_features&&wpUploaderInit.required_features.hasOwnProperty("send_binary_string")||(wpUploaderInit.required_features=wpUploaderInit.required_features||{},wpUploaderInit.required_features.send_binary_string=!0),uploader=new plupload.Uploader(wpUploaderInit),e("#image_resize").bind("change",(function(){var r=e(this).prop("checked");setResize(r),r?setUserSetting("upload_resize","1"):deleteUserSetting("upload_resize")})),uploader.bind("Init",(function(r){var a=e("#plupload-upload-ui");setResize(getUserSetting("upload_resize",!1)),r.features.dragdrop&&!e(document.body).hasClass("mobile")?(a.addClass("drag-drop"),e("#drag-drop-area").on("dragover.wp-uploader",(function(){a.addClass("drag-over")})).on("dragleave.wp-uploader, drop.wp-uploader",(function(){a.removeClass("drag-over")}))):(a.removeClass("drag-drop"),e("#drag-drop-area").off(".wp-uploader")),"html4"===r.runtime&&e(".upload-flash-bypass").hide()})),uploader.bind("postinit",(function(e){e.refresh()})),uploader.init(),uploader.bind("FilesAdded",(function(r,a){e("#media-upload-error").empty(),uploadStart(),plupload.each(a,(function(e){"image/heic"===e.type&&r.settings.heic_upload_error&&wpQueueError(pluploadL10n.unsupported_image),fileQueued(e)})),r.refresh(),r.start()})),uploader.bind("UploadFile",(function(e,r){fileUploading(e,r)})),uploader.bind("UploadProgress",(function(e,r){uploadProgress(e,r)})),uploader.bind("Error",(function(e,r){uploadError(r.file,r.code,r.message,e),e.refresh()})),uploader.bind("FileUploaded",(function(e,r,a){uploadSuccess(r,a.response)})),uploader.bind("UploadComplete",(function(){uploadComplete()}))},"object"==typeof wpUploaderInit&&uploader_init()}));