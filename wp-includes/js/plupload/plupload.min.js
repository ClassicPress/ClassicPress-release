!function(e,t,i){var n=e.setTimeout,r={};function s(e){var t=e.required_features,i={};function n(e,t,n){var r={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};r[e]?i[r[e]]=t:n||(i[e]=t)}return"string"==typeof t?o.each(t.split(/\s*,\s*/),(function(e){n(e,!0)})):"object"==typeof t?o.each(t,(function(e,t){n(t,e)})):!0===t&&(e.chunk_size>0&&(i.slice_blob=!0),!e.resize.enabled&&e.multipart||(i.send_binary_string=!0),o.each(e,(function(e,t){n(t,!!e,!0)}))),e.runtimes="html5,html4",i}var a,o={VERSION:"2.1.9",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,getAll:function(e){var t,i=[];"array"!==o.typeOf(e)&&(e=[e]);for(var n=e.length;n--;)(t=o.get(e[n]))&&i.push(t);return i.length?i:null},get:t.get,each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"};return e?(""+e).replace(/[<>&\"\']/g,(function(e){return t[e]?"&"+t[e]+";":e})):e},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function(e){var t,i;for(i=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;t<i.length;t+=2)e=e.replace(i[t],i[t+1]);return e=(e=e.replace(/\s+/g,"_")).replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(e,t){var i="";return o.each(t,(function(e,t){i+=(i?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)})),i&&(e+=(e.indexOf("?")>0?"&":"?")+i),e},formatSize:function(e){if(e===i||/\D/.test(e))return o.translate("N/A");function t(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}var n=Math.pow(1024,4);return e>n?t(e/n,1)+" "+o.translate("tb"):e>(n/=1024)?t(e/n,1)+" "+o.translate("gb"):e>(n/=1024)?t(e/n,1)+" "+o.translate("mb"):e>1024?Math.round(e/1024)+" "+o.translate("kb"):e+" "+o.translate("b")},parseSize:t.parseSizeStr,predictRuntime:function(e,i){var n,r;return n=new o.Uploader(e),r=t.Runtime.thatCan(n.getOption().required_features,i||e.runtimes),n.destroy(),r},addFileFilter:function(e,t){r[e]=t}};o.addFileFilter("mime_types",(function(e,t,i){e.length&&!e.regexp.test(t.name)?(this.trigger("Error",{code:o.FILE_EXTENSION_ERROR,message:o.translate("File extension error."),file:t}),i(!1)):i(!0)})),o.addFileFilter("max_file_size",(function(e,t,i){e=o.parseSize(e),undefined!==t.size&&e&&t.size>e?(this.trigger("Error",{code:o.FILE_SIZE_ERROR,message:o.translate("File size error."),file:t}),i(!1)):i(!0)})),o.addFileFilter("prevent_duplicates",(function(e,t,i){if(e)for(var n=this.files.length;n--;)if(t.name===this.files[n].name&&t.size===this.files[n].size)return this.trigger("Error",{code:o.FILE_DUPLICATE_ERROR,message:o.translate("Duplicate file error."),file:t}),void i(!1);i(!0)})),o.Uploader=function(e){var a,u,l,d,c=o.guid(),f=[],g={},p=[],h=[],_=!1;function m(){var e,t,i=0;if(this.state==o.STARTED){for(t=0;t<f.length;t++)e||f[t].status!=o.QUEUED?i++:(e=f[t],this.trigger("BeforeUpload",e)&&(e.status=o.UPLOADING,this.trigger("UploadFile",e)));i==f.length&&(this.state!==o.STOPPED&&(this.state=o.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",f))}}function b(e){e.percent=e.size>0?Math.ceil(e.loaded/e.size*100):100,R()}function R(){var e,t;for(l.reset(),e=0;e<f.length;e++)(t=f[e]).size!==i?(l.size+=t.origSize,l.loaded+=t.loaded*t.origSize/t.size):l.size=i,t.status==o.DONE?l.uploaded++:t.status==o.FAILED?l.failed++:l.queued++;l.size===i?l.percent=f.length>0?Math.ceil(l.uploaded/f.length*100):0:(l.bytesPerSec=Math.ceil(l.loaded/((+new Date-u||1)/1e3)),l.percent=l.size>0?Math.ceil(l.loaded/l.size*100):0)}function E(){var e=p[0]||h[0];return!!e&&e.getRuntime().uid}function y(){this.bind("FilesAdded FilesRemoved",(function(e){e.trigger("QueueChanged"),e.refresh()})),this.bind("CancelUpload",w),this.bind("BeforeUpload",I),this.bind("UploadFile",S),this.bind("UploadProgress",T),this.bind("StateChanged",D),this.bind("QueueChanged",R),this.bind("Error",A),this.bind("FileUploaded",F),this.bind("Destroy",P)}function v(e,i){var n=this,r=0,s=[],a={runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:g};o.each(e.runtimes.split(/\s*,\s*/),(function(t){e[t]&&(a[t]=e[t])})),e.browse_button&&o.each(e.browse_button,(function(i){s.push((function(s){var u=new t.FileInput(o.extend({},a,{accept:e.filters.mime_types,name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:i}));u.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(n.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")}),r++,p.push(this),s()},u.onchange=function(){n.addFile(this.files)},u.bind("mouseenter mouseleave mousedown mouseup",(function(n){_||(e.browse_button_hover&&("mouseenter"===n.type?t.addClass(i,e.browse_button_hover):"mouseleave"===n.type&&t.removeClass(i,e.browse_button_hover)),e.browse_button_active&&("mousedown"===n.type?t.addClass(i,e.browse_button_active):"mouseup"===n.type&&t.removeClass(i,e.browse_button_active)))})),u.bind("mousedown",(function(){n.trigger("Browse")})),u.bind("error runtimeerror",(function(){u=null,s()})),u.init()}))})),e.drop_element&&o.each(e.drop_element,(function(e){s.push((function(i){var s=new t.FileDrop(o.extend({},a,{drop_zone:e}));s.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(n.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),dragdrop:e.can("drag_and_drop")}),r++,h.push(this),i()},s.ondrop=function(){n.addFile(this.files)},s.bind("error runtimeerror",(function(){s=null,i()})),s.init()}))})),t.inSeries(s,(function(){"function"==typeof i&&i(r)}))}function z(e,n,r){var s=new t.Image;try{s.onload=function(){if(n.width>this.width&&n.height>this.height&&n.quality===i&&n.preserve_headers&&!n.crop)return this.destroy(),r(e);s.downsize(n.width,n.height,n.crop,n.preserve_headers)},s.onresize=function(){r(this.getAsBlob(e.type,n.quality)),this.destroy()},s.onerror=function(){r(e)},s.load(e)}catch(a){r(e)}}function O(e,i,n){var r=this,u=!1;function l(e,t,i){var n,s,l=a[e];switch(e){case"max_file_size":"max_file_size"===e&&(a.max_file_size=a.filters.max_file_size=t);break;case"chunk_size":(t=o.parseSize(t))&&(a[e]=t,a.send_file_name=!0);break;case"multipart":a[e]=t,t||(a.send_file_name=!0);break;case"unique_names":a[e]=t,t&&(a.send_file_name=!0);break;case"filters":"array"===o.typeOf(t)&&(t={mime_types:t}),i?o.extend(a.filters,t):a.filters=t,t.mime_types&&(a.filters.mime_types.regexp=(n=a.filters.mime_types,s=[],o.each(n,(function(e){o.each(e.extensions.split(/,/),(function(e){/^\s*\*\s*$/.test(e)?s.push("\\.*"):s.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))}))})),new RegExp("("+s.join("|")+")$","i")));break;case"resize":i?o.extend(a.resize,t,{enabled:!0}):a.resize=t;break;case"prevent_duplicates":a.prevent_duplicates=a.filters.prevent_duplicates=!!t;break;case"container":case"browse_button":case"drop_element":t="container"===e?o.get(t):o.getAll(t);case"runtimes":case"multi_selection":a[e]=t,i||(u=!0);break;default:a[e]=t}i||r.trigger("OptionChanged",e,t,l)}"object"==typeof e?o.each(e,(function(e,t){l(t,e,n)})):l(e,i,n),n?(a.required_features=s(o.extend({},a)),g=s(o.extend({},a,{required_features:!0}))):u&&(r.trigger("Destroy"),v.call(r,a,(function(e){e?(r.runtime=t.Runtime.getInfo(E()).type,r.trigger("Init",{runtime:r.runtime}),r.trigger("PostInit")):r.trigger("Error",{code:o.INIT_ERROR,message:o.translate("Init error.")})})))}function I(e,t){if(e.settings.unique_names){var i=t.name.match(/\.([^.]+)$/),n="part";i&&(n=i[1]),t.target_name=t.id+"."+n}}function S(e,i){var r,s=e.settings.url,a=e.settings.chunk_size,u=e.settings.max_retries,l=e.features,c=0;function f(){u-- >0?n(p,1e3):(i.loaded=c,e.trigger("Error",{code:o.HTTP_ERROR,message:o.translate("HTTP Error."),file:i,response:d.responseText,status:d.status,responseHeaders:d.getAllResponseHeaders()}))}function p(){var h,_,m,b={};i.status===o.UPLOADING&&e.state!==o.STOPPED&&(e.settings.send_file_name&&(b.name=i.target_name||i.name),a&&l.chunks&&r.size>a?(m=Math.min(a,r.size-c),h=r.slice(c,c+m)):(m=r.size,h=r),a&&l.chunks&&(e.settings.send_chunk_number?(b.chunk=Math.ceil(c/a),b.chunks=Math.ceil(r.size/a)):(b.offset=c,b.total=r.size)),(d=new t.XMLHttpRequest).upload&&(d.upload.onprogress=function(t){i.loaded=Math.min(i.size,c+t.loaded),e.trigger("UploadProgress",i)}),d.onload=function(){d.status>=400?f():(u=e.settings.max_retries,m<r.size?(h.destroy(),c+=m,i.loaded=Math.min(c,r.size),e.trigger("ChunkUploaded",i,{offset:i.loaded,total:r.size,response:d.responseText,status:d.status,responseHeaders:d.getAllResponseHeaders()}),"Android Browser"===t.Env.browser&&e.trigger("UploadProgress",i)):i.loaded=i.size,h=_=null,!c||c>=r.size?(i.size!=i.origSize&&(r.destroy(),r=null),e.trigger("UploadProgress",i),i.status=o.DONE,e.trigger("FileUploaded",i,{response:d.responseText,status:d.status,responseHeaders:d.getAllResponseHeaders()})):n(p,1))},d.onerror=function(){f()},d.onloadend=function(){this.destroy(),d=null},e.settings.multipart&&l.multipart?(d.open("post",s,!0),o.each(e.settings.headers,(function(e,t){d.setRequestHeader(t,e)})),_=new t.FormData,o.each(o.extend(b,e.settings.multipart_params),(function(e,t){_.append(t,e)})),_.append(e.settings.file_data_name,h),d.send(_,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:g})):(s=o.buildUrl(e.settings.url,o.extend(b,e.settings.multipart_params)),d.open("post",s,!0),d.setRequestHeader("Content-Type","application/octet-stream"),o.each(e.settings.headers,(function(e,t){d.setRequestHeader(t,e)})),d.send(h,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:g})))}i.loaded&&(c=i.loaded=a?a*Math.floor(i.loaded/a):0),r=i.getSource(),e.settings.resize.enabled&&function(e,i){if(e.ruid){var n=t.Runtime.getInfo(e.ruid);if(n)return n.can(i)}return!1}(r,"send_binary_string")&&~t.inArray(r.type,["image/jpeg","image/png"])?z.call(this,r,e.settings.resize,(function(e){r=e,i.size=e.size,p()})):p()}function T(e,t){b(t)}function D(e){if(e.state==o.STARTED)u=+new Date;else if(e.state==o.STOPPED)for(var t=e.files.length-1;t>=0;t--)e.files[t].status==o.UPLOADING&&(e.files[t].status=o.QUEUED,R())}function w(){d&&d.abort()}function F(e){R(),n((function(){m.call(e)}),1)}function A(e,t){t.code===o.INIT_ERROR?e.destroy():t.code===o.HTTP_ERROR&&(t.file.status=o.FAILED,b(t.file),e.state==o.STARTED&&(e.trigger("CancelUpload"),n((function(){m.call(e)}),1)))}function P(e){e.stop(),o.each(f,(function(e){e.destroy()})),f=[],p.length&&(o.each(p,(function(e){e.destroy()})),p=[]),h.length&&(o.each(h,(function(e){e.destroy()})),h=[]),g={},_=!1,u=d=null,l.reset()}a={runtimes:t.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0},O.call(this,e,null,!0),l=new o.QueueProgress,o.extend(this,{id:c,uid:c,state:o.STOPPED,features:{},runtime:null,files:f,settings:a,total:l,init:function(){var e,i,n=this;return"function"==typeof(e=n.getOption("preinit"))?e(n):o.each(e,(function(e,t){n.bind(t,e)})),y.call(n),o.each(["container","browse_button","drop_element"],(function(e){if(null===n.getOption(e))return i={code:o.INIT_ERROR,message:o.translate("'%' specified, but cannot be found.")},!1})),i?n.trigger("Error",i):a.browse_button||a.drop_element?void v.call(n,a,(function(e){var i=n.getOption("init");"function"==typeof i?i(n):o.each(i,(function(e,t){n.bind(t,e)})),e?(n.runtime=t.Runtime.getInfo(E()).type,n.trigger("Init",{runtime:n.runtime}),n.trigger("PostInit")):n.trigger("Error",{code:o.INIT_ERROR,message:o.translate("Init error.")})})):n.trigger("Error",{code:o.INIT_ERROR,message:o.translate("You must specify either 'browse_button' or 'drop_element'.")})},setOption:function(e,t){O.call(this,e,t,!this.runtime)},getOption:function(e){return e?a[e]:a},refresh:function(){p.length&&o.each(p,(function(e){e.trigger("Refresh")})),this.trigger("Refresh")},start:function(){this.state!=o.STARTED&&(this.state=o.STARTED,this.trigger("StateChanged"),m.call(this))},stop:function(){this.state!=o.STOPPED&&(this.state=o.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){_=arguments[0]===i||arguments[0],p.length&&o.each(p,(function(e){e.disable(_)})),this.trigger("DisableBrowse",_)},getFile:function(e){var t;for(t=f.length-1;t>=0;t--)if(f[t].id===e)return f[t]},addFile:function(e,i){var s,a=this,u=[],l=[];s=E(),function d(e){var c=t.typeOf(e);if(e instanceof t.File){if(!e.ruid&&!e.isDetached()){if(!s)return!1;e.ruid=s,e.connectRuntime(s)}d(new o.File(e))}else e instanceof t.Blob?(d(e.getSource()),e.destroy()):e instanceof o.File?(i&&(e.name=i),u.push((function(i){!function(e,i){var n=[];t.each(a.settings.filters,(function(t,i){r[i]&&n.push((function(n){r[i].call(a,t,e,(function(e){n(!e)}))}))})),t.inSeries(n,i)}(e,(function(t){t||(f.push(e),l.push(e),a.trigger("FileFiltered",e)),n(i,1)}))}))):-1!==t.inArray(c,["file","blob"])?d(new t.File(null,e)):"node"===c&&"filelist"===t.typeOf(e.files)?t.each(e.files,d):"array"===c&&(i=null,t.each(e,d))}(e),u.length&&t.inSeries(u,(function(){l.length&&a.trigger("FilesAdded",l)}))},removeFile:function(e){for(var t="string"==typeof e?e:e.id,i=f.length-1;i>=0;i--)if(f[i].id===t)return this.splice(i,1)[0]},splice:function(e,t){var n=f.splice(e===i?0:e,t===i?f.length:t),r=!1;return this.state==o.STARTED&&(o.each(n,(function(e){if(e.status===o.UPLOADING)return r=!0,!1})),r&&this.stop()),this.trigger("FilesRemoved",n),o.each(n,(function(e){e.destroy()})),r&&this.start(),n},dispatchEvent:function(e){var t,i;if(e=e.toLowerCase(),t=this.hasEventListener(e)){t.sort((function(e,t){return t.priority-e.priority})),(i=[].slice.call(arguments)).shift(),i.unshift(this);for(var n=0;n<t.length;n++)if(!1===t[n].fn.apply(t[n].scope,i))return!1}return!0},bind:function(e,t,i,n){o.Uploader.prototype.bind.call(this,e,t,n,i)},destroy:function(){this.trigger("Destroy"),a=l=null,this.unbindAll()}})},o.Uploader.prototype=t.EventTarget.instance,o.File=(a={},function(e){o.extend(this,{id:o.guid(),name:e.name||e.fileName,type:e.type||"",size:e.size||e.fileSize,origSize:e.size||e.fileSize,loaded:0,percent:0,status:o.QUEUED,lastModifiedDate:e.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var e=this.getSource().getSource();return-1!==t.inArray(t.typeOf(e),["blob","file"])?e:null},getSource:function(){return a[this.id]?a[this.id]:null},destroy:function(){var e=this.getSource();e&&(e.destroy(),delete a[this.id])}}),a[this.id]=e}),o.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},e.plupload=o}(window,mOxie),function(e,t,i){var n=e.setTimeout,r={};function s(e){var t=e.required_features,i={};function n(e,t,n){var r={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};r[e]?i[r[e]]=t:n||(i[e]=t)}return"string"==typeof t?o.each(t.split(/\s*,\s*/),(function(e){n(e,!0)})):"object"==typeof t?o.each(t,(function(e,t){n(t,e)})):!0===t&&(0<e.chunk_size&&(i.slice_blob=!0),!e.resize.enabled&&e.multipart||(i.send_binary_string=!0),o.each(e,(function(e,t){n(t,!!e,!0)}))),e.runtimes="html5,html4",i}var a,o={VERSION:"2.1.9",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,getAll:function(e){for(var t,i=[],n=(e="array"!==o.typeOf(e)?[e]:e).length;n--;)(t=o.get(e[n]))&&i.push(t);return i.length?i:null},get:t.get,each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"};return e&&(""+e).replace(/[<>&\"\']/g,(function(e){return t[e]?"&"+t[e]+";":e}))},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function(e){for(var t=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],i=0;i<t.length;i+=2)e=e.replace(t[i],t[i+1]);return(e=e.replace(/\s+/g,"_")).replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(e,t){var i="";return o.each(t,(function(e,t){i+=(i?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)})),i&&(e+=(0<e.indexOf("?")?"&":"?")+i),e},formatSize:function(e){var t;return e===i||/\D/.test(e)?o.translate("N/A"):(t=Math.pow(1024,4))<e?n(e/t,1)+" "+o.translate("tb"):e>(t/=1024)?n(e/t,1)+" "+o.translate("gb"):e>(t/=1024)?n(e/t,1)+" "+o.translate("mb"):1024<e?Math.round(e/1024)+" "+o.translate("kb"):e+" "+o.translate("b");function n(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}},parseSize:t.parseSizeStr,predictRuntime:function(e,i){var n=new o.Uploader(e);i=t.Runtime.thatCan(n.getOption().required_features,i||e.runtimes);return n.destroy(),i},addFileFilter:function(e,t){r[e]=t}};o.addFileFilter("mime_types",(function(e,t,i){e.length&&!e.regexp.test(t.name)?(this.trigger("Error",{code:o.FILE_EXTENSION_ERROR,message:o.translate("File extension error."),file:t}),i(!1)):i(!0)})),o.addFileFilter("max_file_size",(function(e,t,i){e=o.parseSize(e),void 0!==t.size&&e&&t.size>e?(this.trigger("Error",{code:o.FILE_SIZE_ERROR,message:o.translate("File size error."),file:t}),i(!1)):i(!0)})),o.addFileFilter("prevent_duplicates",(function(e,t,i){if(e)for(var n=this.files.length;n--;)if(t.name===this.files[n].name&&t.size===this.files[n].size)return this.trigger("Error",{code:o.FILE_DUPLICATE_ERROR,message:o.translate("Duplicate file error."),file:t}),void i(!1);i(!0)})),o.Uploader=function(e){var a,u,l,d,c=o.guid(),f=[],g={},p=[],h=[],_=!1;function m(){var e,t,i=0;if(this.state==o.STARTED){for(t=0;t<f.length;t++)e||f[t].status!=o.QUEUED?i++:(e=f[t],this.trigger("BeforeUpload",e)&&(e.status=o.UPLOADING,this.trigger("UploadFile",e)));i==f.length&&(this.state!==o.STOPPED&&(this.state=o.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",f))}}function b(e){e.percent=0<e.size?Math.ceil(e.loaded/e.size*100):100,R()}function R(){var e,t;for(l.reset(),e=0;e<f.length;e++)(t=f[e]).size!==i?(l.size+=t.origSize,l.loaded+=t.loaded*t.origSize/t.size):l.size=i,t.status==o.DONE?l.uploaded++:t.status==o.FAILED?l.failed++:l.queued++;l.size===i?l.percent=0<f.length?Math.ceil(l.uploaded/f.length*100):0:(l.bytesPerSec=Math.ceil(l.loaded/((+new Date-u||1)/1e3)),l.percent=0<l.size?Math.ceil(l.loaded/l.size*100):0)}function E(){var e=p[0]||h[0];return!!e&&e.getRuntime().uid}function y(e,i){var n=this,r=0,s=[],a={runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:g};o.each(e.runtimes.split(/\s*,\s*/),(function(t){e[t]&&(a[t]=e[t])})),e.browse_button&&o.each(e.browse_button,(function(i){s.push((function(s){var u=new t.FileInput(o.extend({},a,{accept:e.filters.mime_types,name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:i}));u.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(n.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")}),r++,p.push(this),s()},u.onchange=function(){n.addFile(this.files)},u.bind("mouseenter mouseleave mousedown mouseup",(function(n){_||(e.browse_button_hover&&("mouseenter"===n.type?t.addClass(i,e.browse_button_hover):"mouseleave"===n.type&&t.removeClass(i,e.browse_button_hover)),e.browse_button_active&&("mousedown"===n.type?t.addClass(i,e.browse_button_active):"mouseup"===n.type&&t.removeClass(i,e.browse_button_active)))})),u.bind("mousedown",(function(){n.trigger("Browse")})),u.bind("error runtimeerror",(function(){u=null,s()})),u.init()}))})),e.drop_element&&o.each(e.drop_element,(function(e){s.push((function(i){var s=new t.FileDrop(o.extend({},a,{drop_zone:e}));s.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(n.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),dragdrop:e.can("drag_and_drop")}),r++,h.push(this),i()},s.ondrop=function(){n.addFile(this.files)},s.bind("error runtimeerror",(function(){s=null,i()})),s.init()}))})),t.inSeries(s,(function(){"function"==typeof i&&i(r)}))}function v(e,i,n){var r=this,u=!1;function l(e,t,i){var n,s,l=a[e];switch(e){case"max_file_size":"max_file_size"===e&&(a.max_file_size=a.filters.max_file_size=t);break;case"chunk_size":(t=o.parseSize(t))&&(a[e]=t,a.send_file_name=!0);break;case"multipart":(a[e]=t)||(a.send_file_name=!0);break;case"unique_names":(a[e]=t)&&(a.send_file_name=!0);break;case"filters":"array"===o.typeOf(t)&&(t={mime_types:t}),i?o.extend(a.filters,t):a.filters=t,t.mime_types&&(a.filters.mime_types.regexp=(n=a.filters.mime_types,s=[],o.each(n,(function(e){o.each(e.extensions.split(/,/),(function(e){/^\s*\*\s*$/.test(e)?s.push("\\.*"):s.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))}))})),new RegExp("("+s.join("|")+")$","i")));break;case"resize":i?o.extend(a.resize,t,{enabled:!0}):a.resize=t;break;case"prevent_duplicates":a.prevent_duplicates=a.filters.prevent_duplicates=!!t;break;case"container":case"browse_button":case"drop_element":t="container"===e?o.get(t):o.getAll(t);case"runtimes":case"multi_selection":a[e]=t,i||(u=!0);break;default:a[e]=t}i||r.trigger("OptionChanged",e,t,l)}"object"==typeof e?o.each(e,(function(e,t){l(t,e,n)})):l(e,i,n),n?(a.required_features=s(o.extend({},a)),g=s(o.extend({},a,{required_features:!0}))):u&&(r.trigger("Destroy"),y.call(r,a,(function(e){e?(r.runtime=t.Runtime.getInfo(E()).type,r.trigger("Init",{runtime:r.runtime}),r.trigger("PostInit")):r.trigger("Error",{code:o.INIT_ERROR,message:o.translate("Init error.")})})))}function z(e,t){var i;e.settings.unique_names&&(e="part",(i=t.name.match(/\.([^.]+)$/))&&(e=i[1]),t.target_name=t.id+"."+e)}function O(e,r){var s,a=e.settings.url,u=e.settings.chunk_size,l=e.settings.max_retries,c=e.features,f=0;function p(){0<l--?n(h,1e3):(r.loaded=f,e.trigger("Error",{code:o.HTTP_ERROR,message:o.translate("HTTP Error."),file:r,response:d.responseText,status:d.status,responseHeaders:d.getAllResponseHeaders()}))}function h(){var i,_,m,b={};r.status===o.UPLOADING&&e.state!==o.STOPPED&&(e.settings.send_file_name&&(b.name=r.target_name||r.name),i=u&&c.chunks&&s.size>u?(m=Math.min(u,s.size-f),s.slice(f,f+m)):(m=s.size,s),u&&c.chunks&&(e.settings.send_chunk_number?(b.chunk=Math.ceil(f/u),b.chunks=Math.ceil(s.size/u)):(b.offset=f,b.total=s.size)),(d=new t.XMLHttpRequest).upload&&(d.upload.onprogress=function(t){r.loaded=Math.min(r.size,f+t.loaded),e.trigger("UploadProgress",r)}),d.onload=function(){400<=d.status?p():(l=e.settings.max_retries,m<s.size?(i.destroy(),f+=m,r.loaded=Math.min(f,s.size),e.trigger("ChunkUploaded",r,{offset:r.loaded,total:s.size,response:d.responseText,status:d.status,responseHeaders:d.getAllResponseHeaders()}),"Android Browser"===t.Env.browser&&e.trigger("UploadProgress",r)):r.loaded=r.size,i=_=null,!f||f>=s.size?(r.size!=r.origSize&&(s.destroy(),s=null),e.trigger("UploadProgress",r),r.status=o.DONE,e.trigger("FileUploaded",r,{response:d.responseText,status:d.status,responseHeaders:d.getAllResponseHeaders()})):n(h,1))},d.onerror=function(){p()},d.onloadend=function(){this.destroy(),d=null},e.settings.multipart&&c.multipart?(d.open("post",a,!0),o.each(e.settings.headers,(function(e,t){d.setRequestHeader(t,e)})),_=new t.FormData,o.each(o.extend(b,e.settings.multipart_params),(function(e,t){_.append(t,e)})),_.append(e.settings.file_data_name,i),d.send(_,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:g})):(a=o.buildUrl(e.settings.url,o.extend(b,e.settings.multipart_params)),d.open("post",a,!0),d.setRequestHeader("Content-Type","application/octet-stream"),o.each(e.settings.headers,(function(e,t){d.setRequestHeader(t,e)})),d.send(i,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:g})))}r.loaded&&(f=r.loaded=u?u*Math.floor(r.loaded/u):0),s=r.getSource(),e.settings.resize.enabled&&function(e,i){if(e.ruid&&(e=t.Runtime.getInfo(e.ruid)))return e.can("send_binary_string")}(s)&&~t.inArray(s.type,["image/jpeg","image/png"])?function(e,n,r){var s=new t.Image;try{s.onload=function(){if(n.width>this.width&&n.height>this.height&&n.quality===i&&n.preserve_headers&&!n.crop)return this.destroy(),r(e);s.downsize(n.width,n.height,n.crop,n.preserve_headers)},s.onresize=function(){r(this.getAsBlob(e.type,n.quality)),this.destroy()},s.onerror=function(){r(e)},s.load(e)}catch(n){r(e)}}.call(this,s,e.settings.resize,(function(e){s=e,r.size=e.size,h()})):h()}function I(e,t){b(t)}function S(e){if(e.state==o.STARTED)u=+new Date;else if(e.state==o.STOPPED)for(var t=e.files.length-1;0<=t;t--)e.files[t].status==o.UPLOADING&&(e.files[t].status=o.QUEUED,R())}function T(){d&&d.abort()}function D(e){R(),n((function(){m.call(e)}),1)}function w(e,t){t.code===o.INIT_ERROR?e.destroy():t.code===o.HTTP_ERROR&&(t.file.status=o.FAILED,b(t.file),e.state==o.STARTED&&(e.trigger("CancelUpload"),n((function(){m.call(e)}),1)))}function F(e){e.stop(),o.each(f,(function(e){e.destroy()})),f=[],p.length&&(o.each(p,(function(e){e.destroy()})),p=[]),h.length&&(o.each(h,(function(e){e.destroy()})),h=[]),_=!(g={}),u=d=null,l.reset()}a={runtimes:t.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0},v.call(this,e,null,!0),l=new o.QueueProgress,o.extend(this,{id:c,uid:c,state:o.STOPPED,features:{},runtime:null,files:f,settings:a,total:l,init:function(){var e,i=this,n=i.getOption("preinit");return"function"==typeof n?n(i):o.each(n,(function(e,t){i.bind(t,e)})),function(){this.bind("FilesAdded FilesRemoved",(function(e){e.trigger("QueueChanged"),e.refresh()})),this.bind("CancelUpload",T),this.bind("BeforeUpload",z),this.bind("UploadFile",O),this.bind("UploadProgress",I),this.bind("StateChanged",S),this.bind("QueueChanged",R),this.bind("Error",w),this.bind("FileUploaded",D),this.bind("Destroy",F)}.call(i),o.each(["container","browse_button","drop_element"],(function(t){if(null===i.getOption(t))return!(e={code:o.INIT_ERROR,message:o.translate("'%' specified, but cannot be found.")})})),e?i.trigger("Error",e):a.browse_button||a.drop_element?void y.call(i,a,(function(e){var n=i.getOption("init");"function"==typeof n?n(i):o.each(n,(function(e,t){i.bind(t,e)})),e?(i.runtime=t.Runtime.getInfo(E()).type,i.trigger("Init",{runtime:i.runtime}),i.trigger("PostInit")):i.trigger("Error",{code:o.INIT_ERROR,message:o.translate("Init error.")})})):i.trigger("Error",{code:o.INIT_ERROR,message:o.translate("You must specify either 'browse_button' or 'drop_element'.")})},setOption:function(e,t){v.call(this,e,t,!this.runtime)},getOption:function(e){return e?a[e]:a},refresh:function(){p.length&&o.each(p,(function(e){e.trigger("Refresh")})),this.trigger("Refresh")},start:function(){this.state!=o.STARTED&&(this.state=o.STARTED,this.trigger("StateChanged"),m.call(this))},stop:function(){this.state!=o.STOPPED&&(this.state=o.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){_=arguments[0]===i||arguments[0],p.length&&o.each(p,(function(e){e.disable(_)})),this.trigger("DisableBrowse",_)},getFile:function(e){for(var t=f.length-1;0<=t;t--)if(f[t].id===e)return f[t]},addFile:function(e,i){var s,a=this,u=[],l=[];s=E(),function d(e){var c=t.typeOf(e);if(e instanceof t.File){if(!e.ruid&&!e.isDetached()){if(!s)return!1;e.ruid=s,e.connectRuntime(s)}d(new o.File(e))}else e instanceof t.Blob?(d(e.getSource()),e.destroy()):e instanceof o.File?(i&&(e.name=i),u.push((function(i){var s,o,u;s=e,o=function(t){t||(f.push(e),l.push(e),a.trigger("FileFiltered",e)),n(i,1)},u=[],t.each(a.settings.filters,(function(e,t){r[t]&&u.push((function(i){r[t].call(a,e,s,(function(e){i(!e)}))}))})),t.inSeries(u,o)}))):-1!==t.inArray(c,["file","blob"])?d(new t.File(null,e)):"node"===c&&"filelist"===t.typeOf(e.files)?t.each(e.files,d):"array"===c&&(i=null,t.each(e,d))}(e),u.length&&t.inSeries(u,(function(){l.length&&a.trigger("FilesAdded",l)}))},removeFile:function(e){for(var t="string"==typeof e?e:e.id,i=f.length-1;0<=i;i--)if(f[i].id===t)return this.splice(i,1)[0]},splice:function(e,t){e=f.splice(e===i?0:e,t===i?f.length:t);var n=!1;return this.state==o.STARTED&&(o.each(e,(function(e){if(e.status===o.UPLOADING)return!(n=!0)})),n&&this.stop()),this.trigger("FilesRemoved",e),o.each(e,(function(e){e.destroy()})),n&&this.start(),e},dispatchEvent:function(e){var t,i;if(e=e.toLowerCase(),t=this.hasEventListener(e)){t.sort((function(e,t){return t.priority-e.priority})),(i=[].slice.call(arguments)).shift(),i.unshift(this);for(var n=0;n<t.length;n++)if(!1===t[n].fn.apply(t[n].scope,i))return!1}return!0},bind:function(e,t,i,n){o.Uploader.prototype.bind.call(this,e,t,n,i)},destroy:function(){this.trigger("Destroy"),a=l=null,this.unbindAll()}})},o.Uploader.prototype=t.EventTarget.instance,o.File=(a={},function(e){o.extend(this,{id:o.guid(),name:e.name||e.fileName,type:e.type||"",size:e.size||e.fileSize,origSize:e.size||e.fileSize,loaded:0,percent:0,status:o.QUEUED,lastModifiedDate:e.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var e=this.getSource().getSource();return-1!==t.inArray(t.typeOf(e),["blob","file"])?e:null},getSource:function(){return a[this.id]||null},destroy:function(){var e=this.getSource();e&&(e.destroy(),delete a[this.id])}}),a[this.id]=e}),o.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},e.plupload=o}(window,mOxie);