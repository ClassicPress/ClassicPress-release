!function(e,t){var i={};wp.media.coerce=function(e,i){return t.isUndefined(e[i])&&!t.isUndefined(this.defaults[i])?e[i]=this.defaults[i]:"true"===e[i]?e[i]=!0:"false"===e[i]&&(e[i]=!1),e[i]},wp.media.string={props:function(e,i){var n,a,d,r,s=wp.media.view.settings.defaultProps;return e=e?t.clone(e):{},i&&i.type&&(e.type=i.type),"image"===e.type&&(e=t.defaults(e||{},{align:s.align||getUserSetting("align","none"),size:s.size||getUserSetting("imgsize","medium"),url:"",classes:[]})),i?(e.title=e.title||i.title,"file"===(n=e.link||s.link||getUserSetting("urlbutton","file"))||"embed"===n?a=i.url:"post"===n?a=i.link:"custom"===n&&(a=e.linkUrl),e.linkUrl=a||"","image"===i.type?(e.classes.push("wp-image-"+i.id),d=(r=i.sizes)&&r[e.size]?r[e.size]:i,t.extend(e,t.pick(i,"align","caption","alt"),{width:d.width,height:d.height,src:d.url,captionId:"attachment_"+i.id})):"video"===i.type||"audio"===i.type?t.extend(e,t.pick(i,"title","type","icon","mime")):(e.title=e.title||i.filename,e.rel=e.rel||"attachment wp-att-"+i.id),e):e},link:function(e,t){var i;return i={tag:"a",content:(e=wp.media.string.props(e,t)).title,attrs:{href:e.linkUrl}},e.rel&&(i.attrs.rel=e.rel),wp.html.string(i)},audio:function(e,t){return wp.media.string._audioVideo("audio",e,t)},video:function(e,t){return wp.media.string._audioVideo("video",e,t)},_audioVideo:function(e,i,n){var a,d;return"embed"!==(i=wp.media.string.props(i,n)).link?wp.media.string.link(i):(a={},"video"===e&&(n.image&&-1===n.image.src.indexOf(n.icon)&&(a.poster=n.image.src),n.width&&(a.width=n.width),n.height&&(a.height=n.height)),d=n.filename.split(".").pop(),t.contains(wp.media.view.settings.embedExts,d)?(a[d]=n.url,wp.shortcode.string({tag:e,attrs:a})):wp.media.string.link(i))},image:function(e,i){var n,a,d,r,s={};return e.type="image",a=(e=wp.media.string.props(e,i)).classes||[],s.src=t.isUndefined(i)?e.url:i.url,t.extend(s,t.pick(e,"width","height","alt")),e.align&&!e.caption&&a.push("align"+e.align),e.size&&a.push("size-"+e.size),s["class"]=t.compact(a).join(" "),n={tag:"img",attrs:s,single:!0},e.linkUrl&&(n={tag:"a",attrs:{href:e.linkUrl},content:n}),r=wp.html.string(n),e.caption&&(d={},s.width&&(d.width=s.width),e.captionId&&(d.id=e.captionId),e.align&&(d.align="align"+e.align),r=wp.shortcode.string({tag:"caption",attrs:d,content:r+" "+e.caption})),r}},wp.media.embed={coerce:wp.media.coerce,defaults:{url:"",width:"",height:""},edit:function(e,i){var n,a={};return i?a.url=e.replace(/<[^>]+>/g,""):(n=wp.shortcode.next("embed",e).shortcode,a=t.defaults(n.attrs.named,this.defaults),n.content&&(a.url=n.content)),wp.media({frame:"post",state:"embed",metadata:a})},shortcode:function(e){var i,n=this;return t.each(this.defaults,(function(t,i){e[i]=n.coerce(e,i),t===e[i]&&delete e[i]})),i=e.url,delete e.url,new wp.shortcode({tag:"embed",attrs:e,content:i})}},wp.media.collection=function(e){var i={};return t.extend({coerce:wp.media.coerce,attachments:function(e){var n,a,d,r,s=e.string(),o=i[s],l=this;return delete i[s],o||(n=t.defaults(e.attrs.named,this.defaults),(a=t.pick(n,"orderby","order")).type=this.type,a.perPage=-1,undefined!==n.orderby&&(n._orderByField=n.orderby),"rand"===n.orderby&&(n._orderbyRandom=!0),n.orderby&&!/^menu_order(?: ID)?$/i.test(n.orderby)||(a.orderby="menuOrder"),n.ids?(a.post__in=n.ids.split(","),a.orderby="post__in"):n.include&&(a.post__in=n.include.split(",")),n.exclude&&(a.post__not_in=n.exclude.split(",")),a.post__in||(a.uploadedTo=n.id),r=t.omit(n,"id","ids","include","exclude","orderby","order"),t.each(this.defaults,(function(e,t){r[t]=l.coerce(r,t)})),(d=wp.media.query(a))[this.tag]=new Backbone.Model(r),d)},shortcode:function(e){var n,a,d=e.props.toJSON(),r=t.pick(d,"orderby","order");return e.type&&(r.type=e.type,delete e.type),e[this.tag]&&t.extend(r,e[this.tag].toJSON()),r.ids=e.pluck("id"),d.uploadedTo&&(r.id=d.uploadedTo),delete r.orderby,r._orderbyRandom?r.orderby="rand":r._orderByField&&"rand"!==r._orderByField&&(r.orderby=r._orderByField),delete r._orderbyRandom,delete r._orderByField,r.ids&&"post__in"===r.orderby&&delete r.orderby,r=this.setDefaults(r),n=new wp.shortcode({tag:this.tag,attrs:r,type:"single"}),(a=new wp.media.model.Attachments(e.models,{props:d}))[this.tag]=e[this.tag],i[n.string()]=a,n},edit:function(e){var i,n,a,d=wp.shortcode.next(this.tag,e),r=this.defaults.id;if(d&&d.content===e)return d=d.shortcode,t.isUndefined(d.get("id"))&&!t.isUndefined(r)&&d.set("id",r),i=this.attachments(d),(n=new wp.media.model.Selection(i.models,{props:i.props.toJSON(),multiple:!0}))[this.tag]=i[this.tag],n.more().done((function(){n.props.set({query:!1}),n.unmirror(),n.props.unset("orderby")})),this.frame&&this.frame.dispose(),a=d.attrs.named.type&&"video"===d.attrs.named.type?"video-"+this.tag+"-edit":this.tag+"-edit",this.frame=wp.media({frame:"post",state:a,title:this.editTitle,editing:!0,multiple:!0,selection:n}).open(),this.frame},setDefaults:function(e){var i=this;return t.each(this.defaults,(function(t,n){e[n]=i.coerce(e,n),t===e[n]&&delete e[n]})),e}},e)},wp.media._galleryDefaults={itemtag:"dl",icontag:"dt",captiontag:"dd",columns:"3",link:"post",size:"thumbnail",order:"ASC",id:wp.media.view.settings.post&&wp.media.view.settings.post.id,orderby:"menu_order ID"},wp.media.view.settings.galleryDefaults?wp.media.galleryDefaults=t.extend({},wp.media._galleryDefaults,wp.media.view.settings.galleryDefaults):wp.media.galleryDefaults=wp.media._galleryDefaults,wp.media.gallery=new wp.media.collection({tag:"gallery",type:"image",editTitle:wp.media.view.l10n.editGalleryTitle,defaults:wp.media.galleryDefaults,setDefaults:function(e){var i=this,n=!t.isEqual(wp.media.galleryDefaults,wp.media._galleryDefaults);return t.each(this.defaults,(function(t,a){e[a]=i.coerce(e,a),t!==e[a]||n&&t!==wp.media._galleryDefaults[a]||delete e[a]})),e}}),wp.media.featuredImage={get:function(){return wp.media.view.settings.post.featuredImageId},set:function(t){var i=wp.media.view.settings;i.post.featuredImageId=t,wp.media.post("get-post-thumbnail-html",{post_id:i.post.id,thumbnail_id:i.post.featuredImageId,_wpnonce:i.post.nonce}).done((function(t){"0"!==t?e(".inside","#postimagediv").html(t):window.alert(wp.i18n.__("Could not set that as the thumbnail image. Try a different attachment."))}))},remove:function(){wp.media.featuredImage.set(-1)},frame:function(){return this._frame?(wp.media.frame=this._frame,this._frame):(this._frame=wp.media({state:"featured-image",states:[new wp.media.controller.FeaturedImage,new wp.media.controller.EditImage]}),this._frame.on("toolbar:create:featured-image",(function(e){this.createSelectToolbar(e,{text:wp.media.view.l10n.setFeaturedImage})}),this._frame),this._frame.on("content:render:edit-image",(function(){var e=this.state("featured-image").get("selection"),t=new wp.media.view.EditImage({model:e.single(),controller:this}).render();this.content.set(t),t.loadEditor()}),this._frame),this._frame.state("featured-image").on("select",this.select),this._frame)},select:function(){var e=this.get("selection").single();wp.media.view.settings.post.featuredImageId&&wp.media.featuredImage.set(e?e.id:-1)},init:function(){e("#postimagediv").on("click","#set-post-thumbnail",(function(e){e.preventDefault(),e.stopPropagation(),wp.media.featuredImage.frame().open()})).on("click","#remove-post-thumbnail",(function(){return wp.media.featuredImage.remove(),!1}))}},e(wp.media.featuredImage.init),wp.media.editor={insert:function(e){var i,n,a=!t.isUndefined(window.tinymce),d=!t.isUndefined(window.QTags);if(n=this.activeEditor?window.wpActiveEditor=this.activeEditor:window.wpActiveEditor,window.send_to_editor)return window.send_to_editor.apply(this,arguments);if(n)a&&(i=tinymce.get(n));else if(a&&tinymce.activeEditor)i=tinymce.activeEditor,n=window.wpActiveEditor=i.id;else if(!d)return!1;if(i&&!i.isHidden()?i.execCommand("mceInsertContent",!1,e):d?QTags.insertContent(e):document.getElementById(n).value+=e,window.tb_remove)try{window.tb_remove()}catch(r){}},add:function(n,a){var d=this.get(n);return d||((d=i[n]=wp.media(t.defaults(a||{},{frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:!0}))).on("insert",(function(i){var n=d.state();(i=i||n.get("selection"))&&e.when.apply(e,i.map((function(e){var t=n.display(e).toJSON();return this.send.attachment(t,e.toJSON())}),this)).done((function(){wp.media.editor.insert(t.toArray(arguments).join("\n\n"))}))}),this),d.state("gallery-edit").on("update",(function(e){this.insert(wp.media.gallery.shortcode(e).string())}),this),d.state("playlist-edit").on("update",(function(e){this.insert(wp.media.playlist.shortcode(e).string())}),this),d.state("video-playlist-edit").on("update",(function(e){this.insert(wp.media.playlist.shortcode(e).string())}),this),d.state("embed").on("select",(function(){var e=d.state(),i=e.get("type"),n=e.props.toJSON();n.url=n.url||"","link"===i?(t.defaults(n,{linkText:n.url,linkUrl:n.url}),this.send.link(n).done((function(e){wp.media.editor.insert(e)}))):"image"===i&&(t.defaults(n,{title:n.url,linkUrl:"",align:"none",link:"none"}),"none"===n.link?n.linkUrl="":"file"===n.link&&(n.linkUrl=n.url),this.insert(wp.media.string.image(n)))}),this),d.state("featured-image").on("select",wp.media.featuredImage.select),d.setState(d.options.state),d)},id:function(e){return e||((e=window.wpActiveEditor)||t.isUndefined(window.tinymce)||!tinymce.activeEditor||(e=tinymce.activeEditor.id),e=e||"")},get:function(e){return e=this.id(e),i[e]},remove:function(e){e=this.id(e),delete i[e]},send:{attachment:function(e,i){var n,a,d=i.caption;return wp.media.view.settings.captions||delete i.caption,e=wp.media.string.props(e,i),n={id:i.id,post_content:i.description,post_excerpt:d},e.linkUrl&&(n.url=e.linkUrl),"image"===i.type?(a=wp.media.string.image(e),t.each({align:"align",size:"image-size",alt:"image_alt"},(function(t,i){e[i]&&(n[t]=e[i])}))):"video"===i.type?a=wp.media.string.video(e,i):"audio"===i.type?a=wp.media.string.audio(e,i):(a=wp.media.string.link(e),n.post_title=e.title),wp.media.post("send-attachment-to-editor",{nonce:wp.media.view.settings.nonce.sendToEditor,attachment:n,html:a,post_id:wp.media.view.settings.post.id})},link:function(e){return wp.media.post("send-link-to-editor",{nonce:wp.media.view.settings.nonce.sendToEditor,src:e.linkUrl,link_text:e.linkText,html:wp.media.string.link(e),post_id:wp.media.view.settings.post.id})}},open:function(e,t){var i;return t=t||{},e=this.id(e),this.activeEditor=e,(!(i=this.get(e))||i.options&&t.state!==i.options.state)&&(i=this.add(e,t)),wp.media.frame=i,i.open()},init:function(){e(document.body).on("click.add-media-button",".insert-media",(function(t){var i=e(t.currentTarget),n=i.data("editor"),a={frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:!0};t.preventDefault(),i.hasClass("gallery")&&(a.state="gallery",a.title=wp.media.view.l10n.createGalleryTitle),wp.media.editor.open(n,a)})),(new wp.media.view.EditorUploader).render()}},t.bindAll(wp.media.editor,"open"),e(wp.media.editor.init)}(jQuery,_);