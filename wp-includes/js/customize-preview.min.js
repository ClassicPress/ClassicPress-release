!function(e,t){var n,i,s,a,o,r=wp.customize,c={};!function(e){var n,i,s;e.replaceState&&(n=function(e){var n,i,s;return(n=document.createElement("a")).href=e,i=r.utils.parseQueryString(location.search.substr(1)),(s=r.utils.parseQueryString(n.search.substr(1))).customize_changeset_uuid=i.customize_changeset_uuid,i.customize_autosaved&&(s.customize_autosaved="on"),i.customize_theme&&(s.customize_theme=i.customize_theme),i.customize_messenger_channel&&(s.customize_messenger_channel=i.customize_messenger_channel),n.search=t.param(s),n.href},e.replaceState=(i=e.replaceState,function(t,s,a){return c=t,i.call(e,t,s,"string"==typeof a&&a.length>0?n(a):a)}),e.pushState=(s=e.pushState,function(t,i,a){return c=t,s.call(e,t,i,"string"==typeof a&&a.length>0?n(a):a)}),window.addEventListener("popstate",(function(e){c=e.state})))}(history),n=function(e,t,n){var i;return function(){var s=arguments;n=n||this,clearTimeout(i),i=setTimeout((function(){i=null,e.apply(n,s)}),t)}},r.Preview=r.Messenger.extend({initialize:function(e,i){var s=this,a=document.createElement("a");r.Messenger.prototype.initialize.call(s,e,i),a.href=s.origin(),s.add("scheme",a.protocol.replace(/:$/,"")),s.body=t(document.body),s.window=t(window),r.settings.channel&&(s.body.on("click.preview","a",(function(e){s.handleLinkClick(e)})),s.body.on("submit.preview","form",(function(e){s.handleFormSubmit(e)})),s.window.on("scroll.preview",n((function(){s.send("scroll",s.window.scrollTop())}),200)),s.bind("scroll",(function(e){s.window.scrollTop(e)})))},handleLinkClick:function(e){var n;if(n=t(e.target).closest("a"),!_.isUndefined(n.attr("href"))&&!("#"===n.attr("href").substr(0,1))&&/^https?:$/.test(n.prop("protocol"))){if(!r.isLinkPreviewable(n[0]))return wp.a11y.speak(r.settings.l10n.linkUnpreviewable),void e.preventDefault();e.preventDefault(),e.shiftKey||this.send("url",n.prop("href"))}},handleFormSubmit:function(e){var n,i;if(n=document.createElement("a"),i=t(e.target),n.href=i.prop("action"),"GET"!==i.prop("method").toUpperCase()||!r.isLinkPreviewable(n))return wp.a11y.speak(r.settings.l10n.formUnpreviewable),void e.preventDefault();e.isDefaultPrevented()||(n.search.length>1&&(n.search+="&"),n.search+=i.serialize(),this.send("url",n.href)),e.preventDefault()}}),r.addLinkPreviewing=function(){var e="a[href], area[href]";t(document.body).find(e).each((function(){r.prepareLinkPreview(this)})),"undefined"!=typeof MutationObserver?(r.mutationObserver=new MutationObserver((function(n){_.each(n,(function(n){t(n.target).find(e).each((function(){r.prepareLinkPreview(this)}))}))})),r.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0})):t(document.documentElement).on("click focus mouseover",e,(function(){r.prepareLinkPreview(this)}))},r.isLinkPreviewable=function(e,t){var n,i,s;return i=_.extend({},{allowAdminAjax:!1},t||{}),"javascript:"===e.protocol||("https:"===e.protocol||"http:"===e.protocol)&&(s=e.host.replace(/:(80|443)$/,""),n=document.createElement("a"),!!!_.isUndefined(_.find(r.settings.url.allowed,(function(t){return n.href=t,n.protocol===e.protocol&&n.host.replace(/:(80|443)$/,"")===s&&0===e.pathname.indexOf(n.pathname.replace(/\/$/,""))})))&&(!/\/wp-(login|signup)\.php$/.test(e.pathname)&&(/\/wp-admin\/admin-ajax\.php$/.test(e.pathname)?i.allowAdminAjax:!/\/wp-(admin|includes|content)(\/|$)/.test(e.pathname))))},r.prepareLinkPreview=function(e){var n,i=t(e);e.hasAttribute("href")&&(i.closest("#wpadminbar").length||"#"!==i.attr("href").substr(0,1)&&/^https?:$/.test(e.protocol)&&(r.settings.channel&&"https"===r.preview.scheme.get()&&"http:"===e.protocol&&-1!==r.settings.url.allowedHosts.indexOf(e.host)&&(e.protocol="https:"),i.hasClass("wp-playlist-caption")||(r.isLinkPreviewable(e)?(i.removeClass("customize-unpreviewable"),(n=r.utils.parseQueryString(e.search.substring(1))).customize_changeset_uuid=r.settings.changeset.uuid,r.settings.changeset.autosaved&&(n.customize_autosaved="on"),r.settings.theme.active||(n.customize_theme=r.settings.theme.stylesheet),r.settings.channel&&(n.customize_messenger_channel=r.settings.channel),e.search=t.param(n)):r.settings.channel&&i.addClass("customize-unpreviewable"))))},r.addRequestPreviewing=function(){t.ajaxPrefilter((function(e,n,i){var s,a,o,c={};(s=document.createElement("a")).href=e.url,r.isLinkPreviewable(s,{allowAdminAjax:!0})&&(a=r.utils.parseQueryString(s.search.substring(1)),r.each((function(e){e._dirty&&(c[e.id]=e.get())})),_.isEmpty(c)||("POST"!==(o=e.type.toUpperCase())&&(i.setRequestHeader("X-HTTP-Method-Override",o),a._method=o,e.type="POST"),e.data?e.data+="&":e.data="",e.data+=t.param({customized:JSON.stringify(c)})),a.customize_changeset_uuid=r.settings.changeset.uuid,r.settings.changeset.autosaved&&(a.customize_autosaved="on"),r.settings.theme.active||(a.customize_theme=r.settings.theme.stylesheet),a.customize_preview_nonce=r.settings.nonce.preview,s.search=t.param(a),e.url=s.href)}))},r.addFormPreviewing=function(){t(document.body).find("form").each((function(){r.prepareFormPreview(this)})),"undefined"!=typeof MutationObserver&&(r.mutationObserver=new MutationObserver((function(e){_.each(e,(function(e){t(e.target).find("form").each((function(){r.prepareFormPreview(this)}))}))})),r.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0}))},r.prepareFormPreview=function(e){var n,i={};e.action||(e.action=location.href),(n=document.createElement("a")).href=e.action,r.settings.channel&&"https"===r.preview.scheme.get()&&"http:"===n.protocol&&-1!==r.settings.url.allowedHosts.indexOf(n.host)&&(n.protocol="https:",e.action=n.href),"GET"===e.method.toUpperCase()&&r.isLinkPreviewable(n)?(t(e).removeClass("customize-unpreviewable"),i.customize_changeset_uuid=r.settings.changeset.uuid,r.settings.changeset.autosaved&&(i.customize_autosaved="on"),r.settings.theme.active||(i.customize_theme=r.settings.theme.stylesheet),r.settings.channel&&(i.customize_messenger_channel=r.settings.channel),_.each(i,(function(n,i){var s=t(e).find('input[name="'+i+'"]');s.length?s.val(n):t(e).prepend(t("<input>",{type:"hidden",name:i,value:n}))})),r.settings.channel&&(e.target="_self")):r.settings.channel&&t(e).addClass("customize-unpreviewable")},r.keepAliveCurrentUrl=(i=location.pathname,s=location.search.substr(1),a=null,o=["customize_theme","customize_changeset_uuid","customize_messenger_channel","customize_autosaved"],function(){var e,n;s!==location.search.substr(1)||i!==location.pathname?(e=document.createElement("a"),null===a&&(e.search=s,a=r.utils.parseQueryString(s),_.each(o,(function(e){delete a[e]}))),e.href=location.href,n=r.utils.parseQueryString(e.search.substr(1)),_.each(o,(function(e){delete n[e]})),i===location.pathname&&_.isEqual(a,n)?r.preview.send("keep-alive"):(e.search=t.param(n),e.hash="",r.settings.url.self=e.href,r.preview.send("ready",{currentUrl:r.settings.url.self,activePanels:r.settings.activePanels,activeSections:r.settings.activeSections,activeControls:r.settings.activeControls,settingValidities:r.settings.settingValidities})),a=n,s=location.search.substr(1),i=location.pathname):r.preview.send("keep-alive")}),r.settingPreviewHandlers={custom_logo:function(e){t("body").toggleClass("wp-custom-logo",!!e)},custom_css:function(e){t("#wp-custom-css").text(e)},background:function(){var e="",n={};_.each(["color","image","preset","position_x","position_y","size","repeat","attachment"],(function(e){n[e]=r("background_"+e)})),t(document.body).toggleClass("custom-background",!(!n.color()&&!n.image())),n.color()&&(e+="background-color: "+n.color()+";"),n.image()&&(e+='background-image: url("'+n.image()+'");',e+="background-size: "+n.size()+";",e+="background-position: "+n.position_x()+" "+n.position_y()+";",e+="background-repeat: "+n.repeat()+";",e+="background-attachment: "+n.attachment()+";"),t("#custom-background-css").text("body.custom-background { "+e+" }")}},t((function(){var e,n,i;r.settings=window._wpCustomizeSettings,r.settings&&(r.preview=new r.Preview({url:window.location.href,channel:r.settings.channel}),r.addLinkPreviewing(),r.addRequestPreviewing(),r.addFormPreviewing(),n=function(e,t,n){var i=r(e);i?i.set(t):(n=n||!1,i=r.create(e,t,{id:e}),n&&(i._dirty=!0))},r.preview.bind("settings",(function(e){t.each(e,n)})),r.preview.trigger("settings",r.settings.values),t.each(r.settings._dirty,(function(e,t){var n=r(t);n&&(n._dirty=!0)})),r.preview.bind("setting",(function(e){n.apply(null,e.concat(!0))})),r.preview.bind("sync",(function(e){e.settings&&e["settings-modified-while-loading"]&&_.each(_.keys(e.settings),(function(t){r.has(t)&&!e["settings-modified-while-loading"][t]&&delete e.settings[t]})),t.each(e,(function(e,t){r.preview.trigger(e,t)})),r.preview.send("synced")})),r.preview.bind("active",(function(){r.preview.send("nonce",r.settings.nonce),r.preview.send("documentTitle",document.title),r.preview.send("scroll",t(window).scrollTop())})),i=function(e){r.settings.changeset.uuid=e,t(document.body).find("a[href], area[href]").each((function(){r.prepareLinkPreview(this)})),t(document.body).find("form").each((function(){r.prepareFormPreview(this)})),history.replaceState&&history.replaceState(c,"",location.href)},r.preview.bind("changeset-uuid",i),r.preview.bind("saved",(function(e){e.next_changeset_uuid&&i(e.next_changeset_uuid),r.trigger("saved",e)})),r.preview.bind("autosaving",(function(){r.settings.changeset.autosaved||(r.settings.changeset.autosaved=!0,t(document.body).find("a[href], area[href]").each((function(){r.prepareLinkPreview(this)})),t(document.body).find("form").each((function(){r.prepareFormPreview(this)})),history.replaceState&&history.replaceState(c,"",location.href))})),r.preview.bind("changeset-saved",(function(e){_.each(e.saved_changeset_values,(function(e,t){var n=r(t);n&&_.isEqual(n.get(),e)&&(n._dirty=!1)}))})),r.preview.bind("nonce-refresh",(function(e){t.extend(r.settings.nonce,e)})),r.preview.send("ready",{currentUrl:r.settings.url.self,activePanels:r.settings.activePanels,activeSections:r.settings.activeSections,activeControls:r.settings.activeControls,settingValidities:r.settings.settingValidities}),setInterval(r.keepAliveCurrentUrl,r.settings.timeouts.keepAliveSend),r.preview.bind("loading-initiated",(function(){t("body").addClass("wp-customizer-unloading")})),r.preview.bind("loading-failed",(function(){t("body").removeClass("wp-customizer-unloading")})),e=t.map(["color","image","preset","position_x","position_y","size","repeat","attachment"],(function(e){return"background_"+e})),r.when.apply(r,e).done((function(){t.each(arguments,(function(){this.bind(r.settingPreviewHandlers.background)}))})),r("custom_logo",(function(e){r.settingPreviewHandlers.custom_logo.call(e,e.get()),e.bind(r.settingPreviewHandlers.custom_logo)})),r("custom_css["+r.settings.theme.stylesheet+"]",(function(e){e.bind(r.settingPreviewHandlers.custom_css)})),r.trigger("preview-ready"))}))}(wp,jQuery);