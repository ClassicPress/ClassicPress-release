!function(e,t){function n(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}e.Env.ie&&e.Env.ie<9||e.PluginManager.add("wptextpattern",(function(a){var r,i=e.util.VK,o=a.settings.wptextpattern||{},d=o.space||[{regExp:/^[*-]\s/,cmd:"InsertUnorderedList"},{regExp:/^1[.)]\s/,cmd:"InsertOrderedList"}],c=o.enter||[{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:">",format:"blockquote"},{regExp:/^(-){3,}$/,element:"hr"}],l=o.inline||[{delimiter:"`",format:"code"}];function f(){var i,o,d,c,f,s=a.selection.getRng(),u=s.startContainer,g=s.startOffset;if(u&&3===u.nodeType&&u.data.length&&g){var m=u.data.slice(0,g),p=u.data.charAt(g-1);e.each(l,(function(e){if(p===e.delimiter.slice(-1)){var t=n(e.delimiter),a=e.delimiter.charAt(0),r=new RegExp("(.*)"+t+".+"+t+"$"),c=m.match(r);if(c){i=c[1].length,o=g-e.delimiter.length;var l=m.charAt(i-1),f=m.charAt(i+e.delimiter.length);if(!(i&&/\S/.test(l)&&(/\s/.test(f)||l===a)||new RegExp("^[\\s"+n(a)+"]+$").test(m.slice(i,o))))return d=e,!1}}})),d&&(c=a.formatter.get(d.format))&&c[0].inline&&(a.undoManager.add(),a.undoManager.transact((function(){u.insertData(g,"\ufeff"),u=u.splitText(i),f=u.splitText(g-i),u.deleteData(0,d.delimiter.length),u.deleteData(u.data.length-d.delimiter.length,d.delimiter.length),a.formatter.apply(d.format,{},u),a.selection.setCursorLocation(f,1)})),t((function(){r="space",a.once("selectionchange",(function(){var e;f&&-1!==(e=f.data.indexOf("\ufeff"))&&f.deleteData(e,e+1)}))})))}}function s(e){var t,n=a.dom.getParent(e,"p");if(n){for(;(t=n.firstChild)&&3!==t.nodeType;)n=t;if(t)return t.data||(t=t.nextSibling&&3===t.nextSibling.nodeType?t.nextSibling:null),t}}function u(){var n,i,o=a.selection.getRng(),c=o.startContainer;c&&s(c)===c&&(n=c.parentNode,i=c.data,e.each(d,(function(e){var d=i.match(e.regExp);if(d&&o.startOffset===d[0].length)return a.undoManager.add(),a.undoManager.transact((function(){c.deleteData(0,d[0].length),n.innerHTML||n.appendChild(document.createElement("br")),a.selection.setCursorLocation(n),a.execCommand(e.cmd)})),t((function(){r="space"})),!1})))}a.on("selectionchange",(function(){r=null})),a.on("keydown",(function(n){(r&&27===n.keyCode||"space"===r&&n.keyCode===i.BACKSPACE)&&(a.undoManager.undo(),n.preventDefault(),n.stopImmediatePropagation()),i.metaKeyPressed(n)||(n.keyCode===i.ENTER?function(){var n,i,o,d=a.selection.getRng().startContainer,l=s(d),f=c.length;if(!l)return;n=l.data;for(;f--;)if(c[f].start){if(0===n.indexOf(c[f].start)){i=c[f];break}}else if(c[f].regExp&&c[f].regExp.test(n)){i=c[f];break}if(!i)return;if(l===d&&e.trim(n)===i.start)return;a.once("keyup",(function(){a.undoManager.add(),a.undoManager.transact((function(){i.format?(a.formatter.apply(i.format,{},l),l.replaceData(0,l.data.length,function(e){return e?e.replace(/^\s+/,""):""}(l.data.slice(i.start.length)))):i.element&&(o=l.parentNode&&l.parentNode.parentNode)&&o.replaceChild(document.createElement(i.element),l.parentNode)})),t((function(){r="enter"}))}))}():n.keyCode===i.SPACEBAR?t(u):n.keyCode>47&&!(n.keyCode>=91&&n.keyCode<=93)&&t(f))}),!0)}))}(window.tinymce,window.setTimeout);