!function(e){e.PluginManager.add("wpview",(function(t){function n(){}var o=window.wp;if(!o||!o.mce||!o.mce.views)return{getView:n};function i(e){return t.dom.hasClass(e,"wpview")}function a(e){function t(e,t){return"<p>"+window.decodeURIComponent(t)+"</p>"}return e&&-1!==e.indexOf(" data-wpview-")?e.replace(/<div[^>]+data-wpview-text="([^"]+)"[^>]*>(?:\.|[\s\S]+?wpview-end[^>]+>\s*<\/span>\s*)?<\/div>/g,t).replace(/<p[^>]+data-wpview-marker="([^"]+)"[^>]*>[\s\S]*?<\/p>/g,t):e}return t.on("init",(function(){var e=window.MutationObserver||window.WebKitMutationObserver;e&&new e((function(){t.fire("wp-body-class-change")})).observe(t.getBody(),{attributes:!0,attributeFilter:["class"]}),t.on("wp-body-class-change",(function(){var e=t.getBody().className;t.$('iframe[class="wpview-sandbox"]').each((function(t,n){if(!n.src||'javascript:""'===n.src)try{n.contentWindow.document.body.className=e}catch(o){}}))}))})),t.on("beforesetcontent",(function(e){var n;if(e.selection||o.mce.views.unbind(),e.content){if(!e.load&&(n=t.selection.getNode())&&n!==t.getBody()&&/^\s*https?:\/\/\S+\s*$/i.test(e.content)){if(!(n=t.dom.getParent(n,"p"))||!/^[\s\uFEFF\u00A0]*$/.test(t.$(n).text()||""))return;n.innerHTML=""}e.content=o.mce.views.setMarkers(e.content,t)}})),t.on("setcontent",(function(){o.mce.views.render()})),t.on("preprocess hide",(function(e){t.$("div[data-wpview-text], p[data-wpview-marker]",e.node).each((function(e,t){t.innerHTML="."}))}),!0),t.on("postprocess",(function(e){e.content=a(e.content)})),t.on("beforeaddundo",(function(e){var n,o=e.level.content||e.level.fragments&&e.level.fragments.join("");n=e.lastLevel?e.lastLevel.content||e.lastLevel.fragments&&e.lastLevel.fragments.join(""):t.startContent,o&&n&&-1!==o.indexOf(" data-wpview-")&&-1!==n.indexOf(" data-wpview-")&&a(n)===a(o)&&e.preventDefault()})),t.on("drop objectselected",(function(e){i(e.targetClone)&&(e.targetClone=t.getDoc().createTextNode(window.decodeURIComponent(t.dom.getAttrib(e.targetClone,"data-wpview-text"))))})),t.on("pastepreprocess",(function(t){var n=t.content;n&&(n=e.trim(n.replace(/<[^>]+>/g,"")),/^https?:\/\/\S+$/i.test(n)&&(t.content=n))})),t.on("resolvename",(function(e){i(e.target)&&(e.name=t.dom.getAttrib(e.target,"data-wpview-type")||"object")})),t.on("click keyup",(function(){var e=t.selection.getNode();i(e)&&t.dom.getAttrib(e,"data-mce-selected")&&e.setAttribute("data-mce-selected","2")})),t.addButton("wp_view_edit",{tooltip:"Edit|button",icon:"dashicon dashicons-edit",onclick:function(){var e=t.selection.getNode();i(e)&&o.mce.views.edit(t,e)}}),t.addButton("wp_view_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",onclick:function(){t.fire("cut")}}),t.once("preinit",(function(){var e;t.wp&&t.wp._createToolbar&&(e=t.wp._createToolbar(["wp_view_edit","wp_view_remove"]),t.on("wptoolbar",(function(t){!t.collapsed&&i(t.element)&&(t.toolbar=e)})))})),t.wp=t.wp||{},t.wp.getView=n,t.wp.setViewCursor=n,{getView:n}}))}(window.tinymce);