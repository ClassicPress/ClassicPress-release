!function(i,c){i.PluginManager.add("wpview",function(n){function e(){}if(!c||!c.mce||!c.mce.views)return{getView:e};function o(e){return n.dom.hasClass(e,"wpview")}function t(e){function t(e,t){return"<p>"+window.decodeURIComponent(t)+"</p>"}return e?e.replace(/<div[^>]+data-wpview-text="([^"]+)"[^>]*>(?:\.|[\s\S]+?wpview-end[^>]+>\s*<\/span>\s*)?<\/div>/g,t).replace(/<p[^>]+data-wpview-marker="([^"]+)"[^>]*>[\s\S]*?<\/p>/g,t):e}return n.on("init",function(){var e=window.MutationObserver||window.WebKitMutationObserver;e&&new e(function(){n.fire("wp-body-class-change")}).observe(n.getBody(),{attributes:!0,attributeFilter:["class"]}),n.on("wp-body-class-change",function(){var o=n.getBody().className;n.$('iframe[class="wpview-sandbox"]').each(function(e,t){if(!t.src||'javascript:""'===t.src)try{t.contentWindow.document.body.className=o}catch(n){}})})}),n.on("beforesetcontent",function(e){var t;if(e.selection||c.mce.views.unbind(),e.content){if(!e.load&&(t=n.selection.getNode())&&t!==n.getBody()&&/^\s*https?:\/\/\S+\s*$/i.test(e.content)){if(!(t=n.dom.getParent(t,"p"))||!/^[\s\uFEFF\u00A0]*$/.test(n.$(t).text()||""))return;t.innerHTML=""}e.content=c.mce.views.setMarkers(e.content,n)}}),n.on("setcontent",function(){c.mce.views.render()}),n.on("preprocess hide",function(e){n.$("div[data-wpview-text], p[data-wpview-marker]",e.node).each(function(e,t){t.innerHTML="."})},!0),n.on("postprocess",function(e){e.content=t(e.content)}),n.on("beforeaddundo",function(e){e.level.content=t(e.level.content)}),n.on("drop objectselected",function(e){o(e.targetClone)&&(e.targetClone=n.getDoc().createTextNode(window.decodeURIComponent(n.dom.getAttrib(e.targetClone,"data-wpview-text"))))}),n.on("pastepreprocess",function(e){var t=e.content;t&&(t=i.trim(t.replace(/<[^>]+>/g,"")),/^https?:\/\/\S+$/i.test(t)&&(e.content=t))}),n.on("resolvename",function(e){o(e.target)&&(e.name=n.dom.getAttrib(e.target,"data-wpview-type")||"object")}),n.on("click keyup",function(){var e=n.selection.getNode();o(e)&&n.dom.getAttrib(e,"data-mce-selected")&&e.setAttribute("data-mce-selected","2")}),n.addButton("wp_view_edit",{tooltip:"Edit|button",icon:"dashicon dashicons-edit",onclick:function(){var e=n.selection.getNode();o(e)&&c.mce.views.edit(n,e)}}),n.addButton("wp_view_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",onclick:function(){n.fire("cut")}}),n.once("preinit",function(){var t;n.wp&&n.wp._createToolbar&&(t=n.wp._createToolbar(["wp_view_edit","wp_view_remove"]),n.on("wptoolbar",function(e){!e.collapsed&&o(e.element)&&(e.toolbar=t)}))}),n.wp=n.wp||{},n.wp.getView=e,{getView:n.wp.setViewCursor=e}})}(window.tinymce,window.wp);