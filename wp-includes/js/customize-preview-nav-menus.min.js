wp.customize.navMenusPreview=wp.customize.MenusCustomizerPreview=function(e,n,t,a){"use strict";var i={data:{navMenuInstanceArgs:{}}};return"undefined"!=typeof _wpCustomizePreviewNavMenusExports&&n.extend(i.data,_wpCustomizePreviewNavMenusExports),i.init=function(){var e=this,t=!1;a.preview.bind("sync",(function(){t=!0})),a.selectiveRefresh&&(a.each((function(n){e.bindSettingListener(n)})),a.bind("add",(function(n){n.get()&&!n.get()._invalid&&e.bindSettingListener(n,{fire:t})})),a.bind("remove",(function(n){e.unbindSettingListener(n)})),a.selectiveRefresh.bind("render-partials-response",(function(t){t.nav_menu_instance_args&&n.extend(e.data.navMenuInstanceArgs,t.nav_menu_instance_args)}))),a.preview.bind("active",(function(){e.highlightControls()}))},a.selectiveRefresh&&(i.NavMenuInstancePartial=a.selectiveRefresh.Partial.extend({initialize:function(e,t){var i,r,s=this;if(!(i=e.match(/^nav_menu_instance\[([0-9a-f]{32})]$/)))throw new Error("Illegal id for nav_menu_instance partial. The key corresponds with the args HMAC.");if(r=i[1],(t=t||{}).params=n.extend({selector:'[data-customize-partial-id="'+e+'"]',navMenuArgs:t.constructingContainerContext||{},containerInclusive:!0},t.params||{}),a.selectiveRefresh.Partial.prototype.initialize.call(s,e,t),!n.isObject(s.params.navMenuArgs))throw new Error("Missing navMenuArgs");if(s.params.navMenuArgs.args_hmac!==r)throw new Error("args_hmac mismatch with id")},isRelatedSetting:function(e,t,i){var r,s,o,u,c,l,v=this;if(n.isString(e)&&(e=a(e)),(o=/^nav_menu_item\[/.test(e.id))&&n.isObject(t)&&n.isObject(i)&&(u=n.clone(t),c=n.clone(i),delete u.type_label,delete c.type_label,"https"===a.preview.scheme.get()&&((l=document.createElement("a")).href=u.url,l.protocol="https:",u.url=l.href,l.href=c.url,l.protocol="https:",c.url=l.href),t.title&&(delete c.original_title,delete u.original_title),n.isEqual(c,u)))return!1;if(v.params.navMenuArgs.theme_location){if("nav_menu_locations["+v.params.navMenuArgs.theme_location+"]"===e.id)return!0;r=a("nav_menu_locations["+v.params.navMenuArgs.theme_location+"]")}return!(s=v.params.navMenuArgs.menu)&&r&&(s=r()),!!s&&("nav_menu["+s+"]"===e.id||o&&(t&&t.nav_menu_term_id===s||i&&i.nav_menu_term_id===s))},refresh:function(){var t,i=this,r=e.Deferred();return n.isNumber(i.params.navMenuArgs.menu)?t=i.params.navMenuArgs.menu:i.params.navMenuArgs.theme_location&&a.has("nav_menu_locations["+i.params.navMenuArgs.theme_location+"]")&&(t=a("nav_menu_locations["+i.params.navMenuArgs.theme_location+"]").get()),t?a.selectiveRefresh.Partial.prototype.refresh.call(i):(i.fallback(),r.reject(),r.promise())},renderContent:function(n){var t=n.container;""===n.addedContent&&n.partial.fallback(),a.selectiveRefresh.Partial.prototype.renderContent.call(this,n)&&e(document).trigger("customize-preview-menu-refreshed",[{instanceNumber:null,wpNavArgs:n.context,wpNavMenuArgs:n.context,oldContainer:t,newContainer:n.container}])}}),a.selectiveRefresh.partialConstructor.nav_menu_instance=i.NavMenuInstancePartial,i.handleUnplacedNavMenuInstances=function(e){var t;return t=n.filter(n.values(i.data.navMenuInstanceArgs),(function(e){return!a.selectiveRefresh.partial.has("nav_menu_instance["+e.args_hmac+"]")})),!!n.findWhere(t,e)&&(a.selectiveRefresh.requestFullRefresh(),!0)},i.bindSettingListener=function(e,n){var t;return n=n||{},(t=e.id.match(/^nav_menu\[(-?\d+)]$/))?(e._navMenuId=parseInt(t[1],10),e.bind(this.onChangeNavMenuSetting),n.fire&&this.onChangeNavMenuSetting.call(e,e(),!1),!0):(t=e.id.match(/^nav_menu_item\[(-?\d+)]$/))?(e._navMenuItemId=parseInt(t[1],10),e.bind(this.onChangeNavMenuItemSetting),n.fire&&this.onChangeNavMenuItemSetting.call(e,e(),!1),!0):!!(t=e.id.match(/^nav_menu_locations\[(.+?)]/))&&(e._navMenuThemeLocation=t[1],e.bind(this.onChangeNavMenuLocationsSetting),n.fire&&this.onChangeNavMenuLocationsSetting.call(e,e(),!1),!0)},i.unbindSettingListener=function(e){e.unbind(this.onChangeNavMenuSetting),e.unbind(this.onChangeNavMenuItemSetting),e.unbind(this.onChangeNavMenuLocationsSetting)},i.onChangeNavMenuSetting=function(){var e=this;i.handleUnplacedNavMenuInstances({menu:e._navMenuId}),a.each((function(n){n._navMenuThemeLocation&&e._navMenuId===n()&&i.handleUnplacedNavMenuInstances({theme_location:n._navMenuThemeLocation})}))},i.onChangeNavMenuItemSetting=function(e,n){var t;(t=a("nav_menu["+String((e||n).nav_menu_term_id)+"]"))&&i.onChangeNavMenuSetting.call(t)},i.onChangeNavMenuLocationsSetting=function(){i.handleUnplacedNavMenuInstances({theme_location:this._navMenuThemeLocation}),!!n.findWhere(n.values(i.data.navMenuInstanceArgs),{theme_location:this._navMenuThemeLocation})||a.selectiveRefresh.requestFullRefresh()}),i.highlightControls=function(){a.settings.channel&&e(document).on("click",".menu-item",(function(n){var t;n.shiftKey&&(t=e(this).attr("class").match(/(?:^|\s)menu-item-(-?\d+)(?:\s|$)/))&&(n.preventDefault(),n.stopPropagation(),a.preview.send("focus-nav-menu-item-control",parseInt(t[1],10)))}))},a.bind("preview-ready",(function(){i.init()})),i}(jQuery,_,wp,wp.customize);