!function(e,t,n){t.wp=t.wp||{},t.wp.heartbeat=new function(){var n,a,r,i,o=e(document),c={suspend:!1,suspendEnabled:!0,screenId:"",url:"",lastTick:0,queue:{},mainInterval:60,tempInterval:0,originalInterval:0,minimalInterval:0,countdown:0,connecting:!1,connectionError:!1,errorcount:0,hasConnected:!1,hasFocus:!0,userActivity:0,userActivityEvents:!1,checkFocusTimer:0,beatTimer:0};function s(){return(new Date).getTime()}function u(e){var n,a=e.src;if(a&&/^https?:\/\//.test(a)&&(n=t.location.origin?t.location.origin:t.location.protocol+"//"+t.location.host,0!==a.indexOf(n)))return!1;try{if(e.contentWindow.document)return!0}catch(r){}return!1}function l(){c.hasFocus&&!document.hasFocus()?h():!c.hasFocus&&document.hasFocus()&&p()}function m(e,t){var n;if(e){switch(e){case"abort":break;case"timeout":n=!0;break;case"error":if(503===t&&c.hasConnected){n=!0;break}case"parsererror":case"empty":case"unknown":c.errorcount++,c.errorcount>2&&c.hasConnected&&(n=!0)}n&&!f()&&(c.connectionError=!0,o.trigger("heartbeat-connection-lost",[e,t]),wp.hooks.doAction("heartbeat.connection-lost",e,t))}}function d(){var n,a;c.connecting||c.suspend||(c.lastTick=s(),a=e.extend({},c.queue),c.queue={},o.trigger("heartbeat-send",[a]),wp.hooks.doAction("heartbeat.send",a),n={data:a,interval:c.tempInterval?c.tempInterval/1e3:c.mainInterval/1e3,_nonce:"object"==typeof t.heartbeatSettings?t.heartbeatSettings.nonce:"",action:"heartbeat",screen_id:c.screenId,has_focus:c.hasFocus},"customize"===c.screenId&&(n.wp_customize="on"),c.connecting=!0,c.xhr=e.ajax({url:c.url,type:"post",timeout:3e4,data:n,dataType:"json"}).always((function(){c.connecting=!1,v()})).done((function(e,n,a){var r;e?(c.hasConnected=!0,f()&&(c.errorcount=0,c.connectionError=!1,o.trigger("heartbeat-connection-restored"),wp.hooks.doAction("heartbeat.connection-restored")),e.nonces_expired&&(o.trigger("heartbeat-nonces-expired"),wp.hooks.doAction("heartbeat.nonces-expired")),e.heartbeat_interval&&(r=e.heartbeat_interval,delete e.heartbeat_interval),e.heartbeat_nonce&&"object"==typeof t.heartbeatSettings&&(t.heartbeatSettings.nonce=e.heartbeat_nonce,delete e.heartbeat_nonce),e.rest_nonce&&"object"==typeof t.wpApiSettings&&(t.wpApiSettings.nonce=e.rest_nonce),o.trigger("heartbeat-tick",[e,n,a]),wp.hooks.doAction("heartbeat.tick",e,n,a),r&&w(r)):m("empty")})).fail((function(e,t,n){m(t||"unknown",e.status),o.trigger("heartbeat-error",[e,t,n]),wp.hooks.doAction("heartbeat.error",e,t,n)})))}function v(){var e=s()-c.lastTick,n=c.mainInterval;c.suspend||(c.hasFocus?c.countdown>0&&c.tempInterval&&(n=c.tempInterval,c.countdown--,c.countdown<1&&(c.tempInterval=0)):n=12e4,c.minimalInterval&&n<c.minimalInterval&&(n=c.minimalInterval),t.clearTimeout(c.beatTimer),e<n?c.beatTimer=t.setTimeout((function(){d()}),n-e):d())}function h(){c.hasFocus=!1}function p(){c.userActivity=s(),c.suspend=!1,c.hasFocus||(c.hasFocus=!0,v())}function b(){c.userActivityEvents=!1,o.off(".wp-heartbeat-active"),e("iframe").each((function(t,n){u(n)&&e(n.contentWindow).off(".wp-heartbeat-active")})),p()}function I(){var t=c.userActivity?s()-c.userActivity:0;t>3e5&&c.hasFocus&&h(),(c.suspendEnabled&&t>6e5||t>36e5)&&(c.suspend=!0),c.userActivityEvents||(o.on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",(function(){b()})),e("iframe").each((function(t,n){u(n)&&e(n.contentWindow).on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",(function(){b()}))})),c.userActivityEvents=!0)}function f(){return c.connectionError}function w(e,t){var n,a=c.tempInterval?c.tempInterval:c.mainInterval;if(e){switch(e){case"fast":case 5:n=5e3;break;case 15:n=15e3;break;case 30:n=3e4;break;case 60:n=6e4;break;case 120:n=12e4;break;case"long-polling":return c.mainInterval=0,0;default:n=c.originalInterval}c.minimalInterval&&n<c.minimalInterval&&(n=c.minimalInterval),5e3===n?(t=(t=parseInt(t,10)||30)<1||t>30?30:t,c.countdown=t,c.tempInterval=n):(c.countdown=0,c.tempInterval=0,c.mainInterval=n),n!==a&&v()}return c.tempInterval?c.tempInterval/1e3:c.mainInterval/1e3}return"string"==typeof t.pagenow&&(c.screenId=t.pagenow),"string"==typeof t.ajaxurl&&(c.url=t.ajaxurl),"object"==typeof t.heartbeatSettings&&(n=t.heartbeatSettings,!c.url&&n.ajaxurl&&(c.url=n.ajaxurl),n.interval&&(c.mainInterval=n.interval,c.mainInterval<15?c.mainInterval=15:c.mainInterval>120&&(c.mainInterval=120)),n.minimalInterval&&(n.minimalInterval=parseInt(n.minimalInterval,10),c.minimalInterval=n.minimalInterval>0&&n.minimalInterval<=600?n.minimalInterval:0),c.minimalInterval&&c.mainInterval<c.minimalInterval&&(c.mainInterval=c.minimalInterval),c.screenId||(c.screenId=n.screenId||"front"),"disable"===n.suspension&&(c.suspendEnabled=!1)),c.mainInterval=1e3*c.mainInterval,c.originalInterval=c.mainInterval,c.minimalInterval&&(c.minimalInterval=1e3*c.minimalInterval),"undefined"!=typeof document.hidden?(a="hidden",i="visibilitychange",r="visibilityState"):"undefined"!=typeof document.msHidden?(a="msHidden",i="msvisibilitychange",r="msVisibilityState"):"undefined"!=typeof document.webkitHidden&&(a="webkitHidden",i="webkitvisibilitychange",r="webkitVisibilityState"),a&&(document[a]&&(c.hasFocus=!1),o.on(i+".wp-heartbeat",(function(){"hidden"===document[r]?(h(),t.clearInterval(c.checkFocusTimer)):(p(),document.hasFocus&&(c.checkFocusTimer=t.setInterval(l,1e4)))}))),document.hasFocus&&(c.checkFocusTimer=t.setInterval(l,1e4)),e(t).on("unload.wp-heartbeat",(function(){c.suspend=!0,c.xhr&&4!==c.xhr.readyState&&c.xhr.abort()})),t.setInterval(I,3e4),e((function(){c.lastTick=s(),v()})),{hasFocus:function(){return c.hasFocus},connectNow:function(){c.lastTick=0,v()},disableSuspend:function(){c.suspendEnabled=!1},interval:w,hasConnectionError:f,enqueue:function(e,t,n){return!!e&&((!n||!this.isQueued(e))&&(c.queue[e]=t,!0))},dequeue:function(e){e&&delete c.queue[e]},isQueued:function(e){if(e)return c.queue.hasOwnProperty(e)},getQueuedItem:function(e){if(e)return this.isQueued(e)?c.queue[e]:undefined}}}}(jQuery,window);