!function(e,n,t){n.wp=n.wp||{},n.wp.heartbeat=new function(){var t,a,r,i,o=e(document),c={suspend:!1,suspendEnabled:!0,screenId:"",url:"",lastTick:0,queue:{},mainInterval:60,tempInterval:0,originalInterval:0,minimalInterval:0,countdown:0,connecting:!1,connectionError:!1,errorcount:0,hasConnected:!1,hasFocus:!0,userActivity:0,userActivityEvents:!1,checkFocusTimer:0,beatTimer:0};function u(){return(new Date).getTime()}function s(e){var t,a=e.src;if(a&&/^https?:\/\//.test(a)&&(t=n.location.origin?n.location.origin:n.location.protocol+"//"+n.location.host,0!==a.indexOf(t)))return!1;try{if(e.contentWindow.document)return!0}catch(r){}return!1}function l(){c.hasFocus&&!document.hasFocus()?h():!c.hasFocus&&document.hasFocus()&&p()}function m(e,n){var t;if(e){switch(e){case"abort":break;case"timeout":t=!0;break;case"error":if(503===n&&c.hasConnected){t=!0;break}case"parsererror":case"empty":case"unknown":c.errorcount++,c.errorcount>2&&c.hasConnected&&(t=!0)}t&&!b()&&(c.connectionError=!0,o.trigger("heartbeat-connection-lost",[e,n]))}}function d(){var t,a;c.connecting||c.suspend||(c.lastTick=u(),a=e.extend({},c.queue),c.queue={},o.trigger("heartbeat-send",[a]),t={data:a,interval:c.tempInterval?c.tempInterval/1e3:c.mainInterval/1e3,_nonce:"object"==typeof n.heartbeatSettings?n.heartbeatSettings.nonce:"",action:"heartbeat",screen_id:c.screenId,has_focus:c.hasFocus},"customize"===c.screenId&&(t.wp_customize="on"),c.connecting=!0,c.xhr=e.ajax({url:c.url,type:"post",timeout:3e4,data:t,dataType:"json"}).always((function(){c.connecting=!1,v()})).done((function(e,n,t){var a;e?(c.hasConnected=!0,b()&&(c.errorcount=0,c.connectionError=!1,o.trigger("heartbeat-connection-restored")),e.nonces_expired&&o.trigger("heartbeat-nonces-expired"),e.heartbeat_interval&&(a=e.heartbeat_interval,delete e.heartbeat_interval),o.trigger("heartbeat-tick",[e,n,t]),a&&w(a)):m("empty")})).fail((function(e,n,t){m(n||"unknown",e.status),o.trigger("heartbeat-error",[e,n,t])})))}function v(){var e=u()-c.lastTick,t=c.mainInterval;c.suspend||(c.hasFocus?c.countdown>0&&c.tempInterval&&(t=c.tempInterval,c.countdown--,c.countdown<1&&(c.tempInterval=0)):t=12e4,c.minimalInterval&&t<c.minimalInterval&&(t=c.minimalInterval),n.clearTimeout(c.beatTimer),e<t?c.beatTimer=n.setTimeout((function(){d()}),t-e):d())}function h(){c.hasFocus=!1}function p(){c.userActivity=u(),c.suspend=!1,c.hasFocus||(c.hasFocus=!0,v())}function I(){c.userActivityEvents=!1,o.off(".wp-heartbeat-active"),e("iframe").each((function(n,t){s(t)&&e(t.contentWindow).off(".wp-heartbeat-active")})),p()}function f(){var n=c.userActivity?u()-c.userActivity:0;n>3e5&&c.hasFocus&&h(),(c.suspendEnabled&&n>6e5||n>36e5)&&(c.suspend=!0),c.userActivityEvents||(o.on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",(function(){I()})),e("iframe").each((function(n,t){s(t)&&e(t.contentWindow).on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",(function(){I()}))})),c.userActivityEvents=!0)}function b(){return c.connectionError}function w(e,n){var t,a=c.tempInterval?c.tempInterval:c.mainInterval;if(e){switch(e){case"fast":case 5:t=5e3;break;case 15:t=15e3;break;case 30:t=3e4;break;case 60:t=6e4;break;case 120:t=12e4;break;case"long-polling":return c.mainInterval=0,0;default:t=c.originalInterval}c.minimalInterval&&t<c.minimalInterval&&(t=c.minimalInterval),5e3===t?(n=(n=parseInt(n,10)||30)<1||n>30?30:n,c.countdown=n,c.tempInterval=t):(c.countdown=0,c.tempInterval=0,c.mainInterval=t),t!==a&&v()}return c.tempInterval?c.tempInterval/1e3:c.mainInterval/1e3}return"string"==typeof n.pagenow&&(c.screenId=n.pagenow),"string"==typeof n.ajaxurl&&(c.url=n.ajaxurl),"object"==typeof n.heartbeatSettings&&(t=n.heartbeatSettings,!c.url&&t.ajaxurl&&(c.url=t.ajaxurl),t.interval&&(c.mainInterval=t.interval,c.mainInterval<15?c.mainInterval=15:c.mainInterval>120&&(c.mainInterval=120)),t.minimalInterval&&(t.minimalInterval=parseInt(t.minimalInterval,10),c.minimalInterval=t.minimalInterval>0&&t.minimalInterval<=600?1e3*t.minimalInterval:0),c.minimalInterval&&c.mainInterval<c.minimalInterval&&(c.mainInterval=c.minimalInterval),c.screenId||(c.screenId=t.screenId||"front"),"disable"===t.suspension&&(c.suspendEnabled=!1)),c.mainInterval=1e3*c.mainInterval,c.originalInterval=c.mainInterval,"undefined"!=typeof document.hidden?(a="hidden",i="visibilitychange",r="visibilityState"):"undefined"!=typeof document.msHidden?(a="msHidden",i="msvisibilitychange",r="msVisibilityState"):"undefined"!=typeof document.webkitHidden&&(a="webkitHidden",i="webkitvisibilitychange",r="webkitVisibilityState"),a&&(document[a]&&(c.hasFocus=!1),o.on(i+".wp-heartbeat",(function(){"hidden"===document[r]?(h(),n.clearInterval(c.checkFocusTimer)):(p(),document.hasFocus&&(c.checkFocusTimer=n.setInterval(l,1e4)))}))),document.hasFocus&&(c.checkFocusTimer=n.setInterval(l,1e4)),e(n).on("unload.wp-heartbeat",(function(){c.suspend=!0,c.xhr&&4!==c.xhr.readyState&&c.xhr.abort()})),n.setInterval(f,3e4),o.ready((function(){c.lastTick=u(),v()})),{hasFocus:function(){return c.hasFocus},connectNow:function(){c.lastTick=0,v()},disableSuspend:function(){c.suspendEnabled=!1},interval:w,hasConnectionError:b,enqueue:function(e,n,t){return!!e&&((!t||!this.isQueued(e))&&(c.queue[e]=n,!0))},dequeue:function(e){e&&delete c.queue[e]},isQueued:function(e){if(e)return c.queue.hasOwnProperty(e)},getQueuedItem:function(e){if(e)return this.isQueued(e)?c.queue[e]:undefined}}}}(jQuery,window);