!function(k,F,e){F.wp=F.wp||{},F.wp.heartbeat=new function(){var i=k(document),o={suspend:!1,suspendEnabled:!0,screenId:"",url:"",lastTick:0,queue:{},mainInterval:60,tempInterval:0,originalInterval:0,minimalInterval:0,countdown:0,connecting:!1,connectionError:!1,errorcount:0,hasConnected:!1,hasFocus:!0,userActivity:0,userActivityEvents:!1,checkFocusTimer:0,beatTimer:0};function r(){return(new Date).getTime()}function t(e){var n,t=e.src;if(t&&/^https?:\/\//.test(t)&&(n=F.location.origin?F.location.origin:F.location.protocol+"//"+F.location.host,0!==t.indexOf(n)))return!1;try{if(e.contentWindow.document)return!0}catch(a){}return!1}function c(){o.hasFocus&&!document.hasFocus()?l():!o.hasFocus&&document.hasFocus()&&m()}function u(e,n){var t;if(e){switch(e){case"abort":break;case"timeout":t=!0;break;case"error":if(503===n&&o.hasConnected){t=!0;break}case"parsererror":case"empty":case"unknown":o.errorcount++,2<o.errorcount&&o.hasConnected&&(t=!0)}t&&!h()&&(o.connectionError=!0,i.trigger("heartbeat-connection-lost",[e,n]))}}function a(){var e,n;o.connecting||o.suspend||(o.lastTick=r(),n=k.extend({},o.queue),o.queue={},i.trigger("heartbeat-send",[n]),e={data:n,interval:o.tempInterval?o.tempInterval/1e3:o.mainInterval/1e3,_nonce:"object"==typeof F.heartbeatSettings?F.heartbeatSettings.nonce:"",action:"heartbeat",screen_id:o.screenId,has_focus:o.hasFocus},"customize"===o.screenId&&(e.wp_customize="on"),o.connecting=!0,o.xhr=k.ajax({url:o.url,type:"post",timeout:3e4,data:e,dataType:"json"}).always(function(){o.connecting=!1,s()}).done(function(e,n,t){var a;e?(function r(){o.hasConnected=!0,h()&&(o.errorcount=0,o.connectionError=!1,i.trigger("heartbeat-connection-restored"))}(),e.nonces_expired&&i.trigger("heartbeat-nonces-expired"),e.heartbeat_interval&&(a=e.heartbeat_interval,delete e.heartbeat_interval),i.trigger("heartbeat-tick",[e,n,t]),a&&f(a)):u("empty")}).fail(function(e,n,t){u(n||"unknown",e.status),i.trigger("heartbeat-error",[e,n,t])}))}function s(){var e=r()-o.lastTick,n=o.mainInterval;o.suspend||(o.hasFocus?0<o.countdown&&o.tempInterval&&(n=o.tempInterval,o.countdown--,o.countdown<1&&(o.tempInterval=0)):n=12e4,o.minimalInterval&&n<o.minimalInterval&&(n=o.minimalInterval),F.clearTimeout(o.beatTimer),e<n?o.beatTimer=F.setTimeout(function(){a()},n-e):a())}function l(){o.hasFocus=!1}function m(){o.userActivity=r(),o.suspend=!1,o.hasFocus||(o.hasFocus=!0,s())}function v(){o.userActivityEvents=!1,i.off(".wp-heartbeat-active"),k("iframe").each(function(e,n){t(n)&&k(n.contentWindow).off(".wp-heartbeat-active")}),m()}function d(){var e=o.userActivity?r()-o.userActivity:0;3e5<e&&o.hasFocus&&l(),(o.suspendEnabled&&6e5<e||36e5<e)&&(o.suspend=!0),o.userActivityEvents||(i.on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",function(){v()}),k("iframe").each(function(e,n){t(n)&&k(n.contentWindow).on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",function(){v()})}),o.userActivityEvents=!0)}function h(){return o.connectionError}function f(e,n){var t,a=o.tempInterval?o.tempInterval:o.mainInterval;if(e){switch(e){case"fast":case 5:t=5e3;break;case 15:t=15e3;break;case 30:t=3e4;break;case 60:t=6e4;break;case 120:t=12e4;break;case"long-polling":return o.mainInterval=0;default:t=o.originalInterval}o.minimalInterval&&t<o.minimalInterval&&(t=o.minimalInterval),5e3===t?(n=(n=parseInt(n,10)||30)<1||30<n?30:n,o.countdown=n,o.tempInterval=t):(o.countdown=0,o.tempInterval=0,o.mainInterval=t),t!==a&&s()}return o.tempInterval?o.tempInterval/1e3:o.mainInterval/1e3}return function p(){var e,n,t,a;"string"==typeof F.pagenow&&(o.screenId=F.pagenow),"string"==typeof F.ajaxurl&&(o.url=F.ajaxurl),"object"==typeof F.heartbeatSettings&&(e=F.heartbeatSettings,!o.url&&e.ajaxurl&&(o.url=e.ajaxurl),e.interval&&(o.mainInterval=e.interval,o.mainInterval<15?o.mainInterval=15:120<o.mainInterval&&(o.mainInterval=120)),e.minimalInterval&&(e.minimalInterval=parseInt(e.minimalInterval,10),o.minimalInterval=0<e.minimalInterval&&e.minimalInterval<=600?1e3*e.minimalInterval:0),o.minimalInterval&&o.mainInterval<o.minimalInterval&&(o.mainInterval=o.minimalInterval),o.screenId||(o.screenId=e.screenId||"front"),"disable"===e.suspension&&(o.suspendEnabled=!1)),o.mainInterval=1e3*o.mainInterval,o.originalInterval=o.mainInterval,"undefined"!=typeof document.hidden?(n="hidden",a="visibilitychange",t="visibilityState"):"undefined"!=typeof document.msHidden?(n="msHidden",a="msvisibilitychange",t="msVisibilityState"):"undefined"!=typeof document.webkitHidden&&(n="webkitHidden",a="webkitvisibilitychange",t="webkitVisibilityState"),n&&(document[n]&&(o.hasFocus=!1),i.on(a+".wp-heartbeat",function(){"hidden"===document[t]?(l(),F.clearInterval(o.checkFocusTimer)):(m(),document.hasFocus&&(o.checkFocusTimer=F.setInterval(c,1e4)))})),document.hasFocus&&(o.checkFocusTimer=F.setInterval(c,1e4)),k(F).on("unload.wp-heartbeat",function(){o.suspend=!0,o.xhr&&4!==o.xhr.readyState&&o.xhr.abort()}),F.setInterval(d,3e4),i.ready(function(){o.lastTick=r(),s()})}(),{hasFocus:function e(){return o.hasFocus},connectNow:function n(){o.lastTick=0,s()},disableSuspend:function I(){o.suspendEnabled=!1},interval:f,hasConnectionError:h,enqueue:function b(e,n,t){return!(!e||t&&this.isQueued(e)||(o.queue[e]=n,0))},dequeue:function w(e){e&&delete o.queue[e]},isQueued:function g(e){if(e)return o.queue.hasOwnProperty(e)},getQueuedItem:function y(e){if(e)return this.isQueued(e)?o.queue[e]:void 0}}}}(jQuery,window);